<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://www.sysctl.me').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","width":320,"display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="文件系统部分提供了有关文件系统结构和维护，Btrfs技术预览以及Red Hat完全支持的文件系统的信息:: ext3, ext4, GFS2, XFS, NFS, and FS-Cache. Note Btrfs is available as a Technology Preview feature in Red Hat Enterprise Linux 7 but has been depre">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux文件系统管理">
<meta property="og:url" content="https://www.sysctl.me/2017/12/10/Linux/storage/filesystem/index.html">
<meta property="og:site_name" content="Sysctl">
<meta property="og:description" content="文件系统部分提供了有关文件系统结构和维护，Btrfs技术预览以及Red Hat完全支持的文件系统的信息:: ext3, ext4, GFS2, XFS, NFS, and FS-Cache. Note Btrfs is available as a Technology Preview feature in Red Hat Enterprise Linux 7 but has been depre">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog-image.nos-eastchina1.126.net/bB9d6a5FD8.png?imageslim">
<meta property="article:published_time" content="2017-12-10T05:02:00.000Z">
<meta property="article:modified_time" content="2020-01-22T14:35:24.179Z">
<meta property="article:author" content="Goooo">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Filesystem">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog-image.nos-eastchina1.126.net/bB9d6a5FD8.png?imageslim">

<link rel="canonical" href="https://www.sysctl.me/2017/12/10/Linux/storage/filesystem/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>Linux文件系统管理 | Sysctl</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Sysctl" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Sysctl</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Too young, too simple. Sometimes, naive & stupid</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/xth0331" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.sysctl.me/2017/12/10/Linux/storage/filesystem/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/img.png">
      <meta itemprop="name" content="Goooo">
      <meta itemprop="description" content="真正的粉丝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sysctl">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Linux文件系统管理
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-12-10 13:02:00" itemprop="dateCreated datePublished" datetime="2017-12-10T13:02:00+08:00">2017-12-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-22 22:35:24" itemprop="dateModified" datetime="2020-01-22T22:35:24+08:00">2020-01-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/12/10/Linux/storage/filesystem/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/10/Linux/storage/filesystem/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>文件系统部分提供了有关文件系统结构和维护，Btrfs技术预览以及Red Hat完全支持的文件系统的信息:: ext3, ext4, GFS2, XFS, NFS, and FS-Cache.</p>
<p><strong>Note</strong></p>
<p>Btrfs is available as a Technology Preview feature in Red Hat Enterprise Linux 7 but has been deprecated since the Red Hat Enterprise Linux 7.4 release. It will be removed in a future major release of Red Hat Enterprise Linux.</p>
<p>XFS is the default file system in Red Hat Enterprise Linux 7 and Red Hat, and Red Hat recommends you to use XFS unless you have a strong reason to use another file system.<br><a id="more"></a></p>
<h1 id="文件系统的结构和维护"><a href="#文件系统的结构和维护" class="headerlink" title="文件系统的结构和维护"></a>文件系统的结构和维护</h1><p>文件系统结构是操作系统中最基本的组织结构。操作系统与用户，应用程序和安全模型的交互方式几乎总是取决于操作系统如何组织存储设备上的文件。提供通用的文件系统结构，确保用户和程序可以访问和写入文件。</p>
<p>文件系统将文件分解成两个逻辑类别：</p>
<ul>
<li>共享 vs.非共享</li>
<li>变量 vs. 静态文件</li>
</ul>
<p><em>可共享</em> 文件 可以在本地访问，也可以由远程主机访问; <em>非共享</em> 文件只可本地使用。<em>变量</em>文件, 例如文档, 可随时更改; 如果没有系统管理员的操作； <em>静态</em> 文件,  (例如二进制文件),不会更改。</p>
<p>以这种方式分类文件有助于将每个文件的功能与分配给保存它们的目录的权限相关联。操作系统及其用户如何与文件进行交互，可以确定放置文件的目录，该目录是以只读还是读/写权限挂载，以及每个用户对该文件的访问级别。这个组织的最高层至关重要; 可以限制对底层目录的访问，否则如果从顶层向下访问规则不遵守严格的结构，则可能会出现安全问题。</p>
<h2 id="文件系统层次结构标准（FHS）概述"><a href="#文件系统层次结构标准（FHS）概述" class="headerlink" title="文件系统层次结构标准（FHS）概述"></a>文件系统层次结构标准（FHS）概述</h2><p>Linux 使用  <em>文件系统层次结构标准</em> (<em>FHS</em>) 文件系统结构, 它定义了许多文件类型和目录的名称，位置和权限.</p>
<p>FHS文档是对任何符合FHS的文件系统的权威参考，但该标准留下了许多未定义或可扩展的区域。本节概述了标准未涉及的文件系统部分的标准和描述。</p>
<p>FHS合规性的两个最重要的要素是:</p>
<ul>
<li>与其他符合FHS的系统兼容</li>
<li>能够将 <code>/usr/</code> 分区挂载为只读. 这是特别重要的, 因为 <code>/usr/</code> 包含通用的可执行文件，不应该被用户改变. 此外, 由于 <code>/usr/</code> 它是以只读方式挂载的, 因此它应该可以从CD-ROM驱动器或另一台机器通过只读NFS安装进行安装.</li>
</ul>
<h3 id="FHS-组织"><a href="#FHS-组织" class="headerlink" title="FHS 组织"></a>FHS 组织</h3><p>这里提到的目录和文件是由FHS文件指定的一小部分。有关最全面的信息，请参阅最新的FHS文档。</p>
<p><strong>Note</strong></p>
<p>可用的目录取决于任何给定系统上安装的内容。下面的列表只是可能发现的一个例子。</p>
<p>收集文件系统信息</p>
<p> <code>df</code> 命令报告系统的磁盘空间使用情况。其输出看起来类似于以下内容:</p>
<p><strong>df Command Output</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Filesystem           1K-blocks      Used Available Use% Mounted on</span><br><span class="line">/dev/mapper/VolGroup00-LogVol00</span><br><span class="line">                       11675568   6272120   4810348  57% / /dev/sda1</span><br><span class="line">	                 100691      9281     86211  10% /boot</span><br><span class="line">none                     322856         0    322856   0% /dev/shm</span><br></pre></td></tr></table></figure>
<p>默认情况下, <code>df</code> 以1千字节块显示分区大小，以千字节为单位显示已用和可用磁盘空间量。要查看以兆字节和千兆字节为单位的信息，请使用该命令,  <code>df -h</code>.  <code>-h</code> argument stands for “human-readable” format. 输出<code>df -h</code> 看起来类似于以下内容:</p>
<p><strong>df -h Command Output</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Filesystem            Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/VolGroup00-LogVol00</span><br><span class="line">                        12G  6.0G  4.6G  57% / /dev/sda1</span><br><span class="line">			99M  9.1M   85M  10% /boot </span><br><span class="line">none 			316M     0  316M   0% /dev/shm</span><br></pre></td></tr></table></figure>
<p><strong>Note</strong></p>
<p>在上面的例子中，挂载的分区 <code>/dev/shm</code>表示系统的虚拟内存文件系统.</p>
<p><code>du</code> 命令显示目录中文件使用的估计空间量，显示每个子目录的磁盘使用情况。输出中的最后一行 <code>du</code> 显示目录的总磁盘使用情况; 仅以可读的格式查看目录的总磁盘使用情况，请使用 <code>du -hs</code>. 有关更多选项，请参阅 <code>man du</code>.</p>
<p>要以图形格式查看系统的分区和磁盘空间使用情况，请通过单击 <strong>System Monitor</strong> by clicking on <strong>Applications</strong> → <strong>System Tools</strong> → <strong>System Monitor</strong> 或使用命令来使用 <code>gnome-system-monitor</code>. 选择 <strong>File Systems</strong> 选项卡查看系统的分区。</p>
<h4 id="boot-目录"><a href="#boot-目录" class="headerlink" title="/boot/ 目录"></a><code>/boot/</code> 目录</h4><p>The <code>/boot/</code> 目录包含启动系统所需的静态文件，例如Linux内核。这些文件对系统正常启动是必不可少的。</p>
<p><strong>Warning</strong></p>
<p>不要删除 <code>/boot/</code> 目录。这样做会导致系统无法启动。</p>
<h4 id="dev-目录"><a href="#dev-目录" class="headerlink" title="/dev/ 目录"></a><code>/dev/</code> 目录</h4><p><code>/dev/</code>目录包含代表以下设备类型的设备节点：</p>
<ul>
<li>连接到系统的设备;</li>
<li>内核提供的虚拟设备。</li>
</ul>
<p>这些设备节点对系统正常运行至关重要.  <code>udevd</code> 守护进程根据需要创建和删除在设备节点<code>/dev/</code>.</p>
<p> <code>/dev/</code> 目录和子目录中的 设备被定义为任一 <em>character</em> (仅提供输入和输出的串行流，例如鼠标或键盘) 或者 <em>block</em>(可随机访问，如硬盘驱动器或软盘驱动). 如果安装了GNOME或KDE，则在连接（例如使用USB）或插入（如CD或DVD驱动器）时会自动检测到某些存储设备，并显示一个弹出窗口，显示内容。.</p>
<p><strong> <code>/dev/</code>目录中的文件的示例</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">File</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">/dev/hda</td>
<td style="text-align:center">主IDE通道上的主设备.</td>
</tr>
<tr>
<td style="text-align:center">/dev/hdb</td>
<td style="text-align:center">主要IDE通道上的从属设备.</td>
</tr>
<tr>
<td style="text-align:center">/dev/tty0</td>
<td style="text-align:center">第一个虚拟控制台.</td>
</tr>
<tr>
<td style="text-align:center">/dev/tty1</td>
<td style="text-align:center">第二个虚拟控制台.</td>
</tr>
<tr>
<td style="text-align:center">/dev/sda</td>
<td style="text-align:center">主SCSI或SATA通道上的第一个设备.</td>
</tr>
<tr>
<td style="text-align:center">/dev/lp0</td>
<td style="text-align:center">第一个并行端口.</td>
</tr>
</tbody>
</table>
</div>
<p>有效的块设备可以是两种类型的条目之一：</p>
<ul>
<li><p>映射的设备</p>
<p>卷组中的逻辑卷，例如, <code>/dev/mapper/VolGroup00-LogVol02</code>.</p>
</li>
<li><p>一个静态设备</p>
<p>例如，传统的存储卷，其中sdb是存储设备名称，X是分区号 。<code>/dev/*sdb**X*</code>,  <code>/dev/sdb*X*</code> 也可以是<code>/dev/disk/by-id/*WWID*</code>,或<code>/dev/disk/by-uuid/*UUID*</code>.</p>
</li>
</ul>
<h4 id="etc-目录"><a href="#etc-目录" class="headerlink" title="/etc/ 目录"></a><code>/etc/</code> 目录</h4><p><code>/etc/</code>目录保留给机器本地的配置文件。 它不应该包含二进制文件; 任何二进制文件应该移动到 <code>/usr/bin/</code> 或 <code>/usr/sbin/</code>.</p>
<p>例如,  <code>/etc/skel/</code> 目录存储 用户文件”框架” , 用于在首次创建用户时填充主目录。 应用程序还将其配置文件存储在此目录中，并在执行时引用它们. The <code>/etc/exports</code>文件控制哪些文件系统导出到远程主机。</p>
<h4 id="mnt-目录"><a href="#mnt-目录" class="headerlink" title="/mnt/ 目录"></a><code>/mnt/</code> 目录</h4><p>The <code>/mnt/</code> 目录保留用于临时挂载的文件系统， 如NFS文件系统挂载. 对于所有可移动存储介质, 请使用 <code>/media/</code> 目录. 自动检测到的可移动媒体将被安装在 <code>/media</code> 目录中。.</p>
<p><strong>重要</strong></p>
<p> <code>/mnt</code> 目录不能被安装程序使用.</p>
<h4 id="opt-目录"><a href="#opt-目录" class="headerlink" title="/opt/ 目录"></a><code>/opt/</code> 目录</h4><p> <code>/opt/</code>目录通常保留给不属于默认安装的软件和附加软件包. 安装程序包以 <code>/opt/</code> 创建名称的目录, 例如, <code>/opt/*packagename*/</code>. 在大多数情况下, 这样的包遵循可预测的子目录结构; 大多数存储他们的二进制文件和他们的页面中 <code>/opt/*packagename*/bin/</code> and 他们的 <code>man</code> 手册在 <code>/opt/*packagename*/man/</code>中.</p>
<h4 id="proc-目录"><a href="#proc-目录" class="headerlink" title="/proc/ 目录"></a><code>/proc/</code> 目录</h4><p> <code>/proc/</code> 目录包含从内核中提取信息或向其发送信息的特殊文件. 这些信息的例子包括系统内存，CPU信息和硬件配置. </p>
<h4 id="srv-目录"><a href="#srv-目录" class="headerlink" title="/srv/ 目录"></a><code>/srv/</code> 目录</h4><p> <code>/srv/</code> 目录 包含由Linux系统提供的特定于站点的数据， 该目录为用户提供特定服务, 例如 （FTP, WWW, or CVS.）的数据文件的位置 ，只与特定用户有关的数据应该放在 <code>/home/</code>目录中.</p>
<h4 id="sys-目录"><a href="#sys-目录" class="headerlink" title="/sys/ 目录"></a><code>/sys/</code> 目录</h4><p><code>/sys/</code> 目录利用 <code>sysfs</code> 特定于内核的新虚拟文件系统。 随着对内核中热插拔硬件设备的支持的增加, <code>/sys/</code> 目录包含类似于所持有的信息 <code>/proc/</code>, 但显示特定于热插拔设备的设备信息的分层视图.</p>
<h4 id="usr-目录"><a href="#usr-目录" class="headerlink" title="/usr/ 目录"></a><code>/usr/</code> 目录</h4><p><code>/usr/</code> 目录适用于可以在多台计算机上共享的文件.  <code>/usr/</code>目录通常在自己的分区上，并以只读方式挂载. 至少, <code>/usr/</code>应包含以下子目录：</p>
<ul>
<li><p><code>/usr/bin</code></p>
<p>该目录用于二进制文件.</p>
</li>
<li><p><code>/usr/etc</code></p>
<p>该目录用于系统范围的配置文件.</p>
</li>
<li><p><code>/usr/games</code></p>
<p>这个目录存储游戏.</p>
</li>
<li><p><code>/usr/include</code></p>
<p>该目录用于  C 头文件.</p>
</li>
<li><p><code>/usr/kerberos</code></p>
<p>此目录用于与Kerberos相关的二进制文件和文件。</p>
</li>
<li><p><code>/usr/lib</code></p>
<p>这个目录用于不被shell脚本或用户直接使用的目标文件和库.从RHEL7开始,  <code>/lib/</code> 目录已经被合并 <code>/usr/lib</code>. 现在还包含在执行的二进制文件所需的库 <code>/usr/bin/</code> 和 <code>/usr/sbin/</code>. 这些共享库图像用于引导系统或在根文件系统中执行命令.</p>
</li>
<li><p><code>/usr/libexec</code></p>
<p>该目录包含由其他程序调用的小型帮助程序.</p>
</li>
<li><p><code>/usr/sbin</code></p>
<p>从RHEL7开始, <code>/sbin</code> 已经转移到 <code>/usr/sbin</code>. 这意味着它包含所有系统管理二进制文件，包括引导，恢复，恢复或修复系统所必需的二进制文件。二进制文件<code>/usr/sbin/</code> 需要root权限才能使用.</p>
</li>
<li><p><code>/usr/share</code></p>
<p>该目录存储不是特定于体系结构的文件.</p>
</li>
<li><p><code>/usr/src</code></p>
<p>这个目录存储源代码.</p>
</li>
<li><p><code>/usr/tmp</code> 链接到 <code>/var/tmp</code></p>
<p>该目录存储临时文件.</p>
</li>
</ul>
<p><code>/usr/</code> 目录 还应该包含一个 <code>/local/</code> 子目录. 根据 FHS, 系统管理员在本地安装软件时使用此子目录, 并且在系统更新期间应该安全地被覆盖.  <code>/usr/local</code> 目录具有类似的结构 <code>/usr/</code>, 并包含以下子目录 :</p>
<ul>
<li><code>/usr/local/bin</code></li>
<li><code>/usr/local/etc</code></li>
<li><code>/usr/local/games</code></li>
<li><code>/usr/local/include</code></li>
<li><code>/usr/local/lib</code></li>
<li><code>/usr/local/libexec</code></li>
<li><code>/usr/local/sbin</code></li>
<li><code>/usr/local/share</code></li>
<li><code>/usr/local/src</code></li>
</ul>
<p>红帽企业Linux的使用 <code>/usr/local/</code>与FHS略有不同. FHS指出 <code>/usr/local/</code> 应该用来存储应该保持安全的系统软件升级的软件. 由于<strong>RPM Package Manager</strong> 可以安全地执行软件升级，因此不需要通过存储文件来保护<code>/usr/local/</code>的文件 </p>
<p>相反, 红帽企业Linux使用 <code>/usr/local/</code> 本地软件. 例如, 如果 <code>/usr/</code> 目录 是从远程主机挂载为只读NFS共享的,则仍然可以在 <code>/usr/local/</code> 目录下安装程序包或程序.</p>
<h4 id="var-目录"><a href="#var-目录" class="headerlink" title="/var/ 目录"></a><code>/var/</code> 目录</h4><p>由于FHS 要求Linux以只读方式挂载<code>/usr/</code> , 因此任何编写日志文件或需要的目录 <code>spool/</code> 或 <code>lock/</code> 目录都应将其写入 <code>/var/</code> 目录. FHS<code>/var/</code> 用于可变数据, 包含卷目录和文件,记录数据，瞬态和临时文件.</p>
<p>以下是目录中的一些<code>/var/</code> 目录:</p>
<ul>
<li><code>/var/account/</code></li>
<li><code>/var/arpwatch/</code></li>
<li><code>/var/cache/</code></li>
<li><code>/var/crash/</code></li>
<li><code>/var/db/</code></li>
<li><code>/var/empty/</code></li>
<li><code>/var/ftp/</code></li>
<li><code>/var/gdm/</code></li>
<li><code>/var/kerberos/</code></li>
<li><code>/var/lib/</code></li>
<li><code>/var/local/</code></li>
<li><code>/var/lock/</code></li>
<li><code>/var/log/</code></li>
<li><code>/var/mail</code> linked to <code>/var/spool/mail/</code></li>
<li><code>/var/mailman/</code></li>
<li><code>/var/named/</code></li>
<li><code>/var/nis/</code></li>
<li><code>/var/opt/</code></li>
<li><code>/var/preserve/</code></li>
<li><code>/var/run/</code></li>
<li><code>/var/spool/</code></li>
<li><code>/var/tmp/</code></li>
<li><code>/var/tux/</code></li>
<li><code>/var/www/</code></li>
<li><code>/var/yp/</code></li>
</ul>
<p><strong>重要</strong></p>
<p><code>/var/run/media/*user*</code>包含用作可移动介质（如USB存储介质，DVD，CD-ROM和Zip磁盘）的挂载点的子目录 请注意，以前，<code>/media/</code> 目录用于此。</p>
<p>系统日志文件, 如 <code>messages</code> and <code>lastlog</code>, 进入 <code>/var/log/</code> 目录. <code>/var/lib/rpm/</code>目录包含 RPM 系统数据库. 锁定文件在 <code>/var/lock/</code>目录, 通常在使用该文件的程序的目录中. <code>/var/spool/</code> 目录具有存储某些程序的数据文件的子目录。这些子目录包括:</p>
<ul>
<li><code>/var/spool/at/</code></li>
<li><code>/var/spool/clientmqueue/</code></li>
<li><code>/var/spool/cron/</code></li>
<li><code>/var/spool/cups/</code></li>
<li><code>/var/spool/exim/</code></li>
<li><code>/var/spool/lpd/</code></li>
<li><code>/var/spool/mail/</code></li>
<li><code>/var/spool/mailman/</code></li>
<li><code>/var/spool/mqueue/</code></li>
<li><code>/var/spool/news/</code></li>
<li><code>/var/spool/postfix/</code></li>
<li><code>/var/spool/repackage/</code></li>
<li><code>/var/spool/rwho/</code></li>
<li><code>/var/spool/samba/</code></li>
<li><code>/var/spool/squid/</code></li>
<li><code>/var/spool/squirrelmail/</code></li>
<li><code>/var/spool/up2date/</code></li>
<li><code>/var/spool/uucp/</code></li>
<li><code>/var/spool/uucppublic/</code></li>
<li><code>/var/spool/vbox/</code></li>
</ul>
<h2 id="特殊的红帽企业Linux文件位置"><a href="#特殊的红帽企业Linux文件位置" class="headerlink" title="特殊的红帽企业Linux文件位置"></a>特殊的红帽企业Linux文件位置</h2><p>红帽企业Linux稍微扩展了FHS结构以适应特殊文件.</p>
<p>大多数与RPM相关的文件都保存在 <code>/var/lib/rpm/</code> 目录中. 有关RPM的更多信息，请参阅 <code>man rpm</code>.</p>
<p><code>/var/cache/yum/</code> 目录包含 <strong>Package Updater</strong>, 使用的文件. 包括系统的RPM头信息。这个位置也可以用来临时存储下载的RPMs，同时更新系统。</p>
<p>红帽企业Linux特定的另一个位置是<code>/etc/sysconfig/</code> 目录. 这个目录存储了各种配置信息。许多在启动时运行的脚本都使用这个目录中的文件.</p>
<h3 id="proc-虚拟文件系统"><a href="#proc-虚拟文件系统" class="headerlink" title="/proc 虚拟文件系统"></a>/proc 虚拟文件系统</h3><p>与大多数文件系统不同, <code>/proc</code> 它不包含文本或二进制文件,相反，它包含 <em>virtual files</em>; 如此, <code>/proc</code> 通常被称为虚拟文件系统. 这些虚拟文件的大小通常是零字节，即使它们包含大量的信息。</p>
<p><code>/proc</code>文件系统不用于存储. 其主要目的是为硬件，内存，运行进程和其他系统组件提供一个基于文件的界面。通过查看相应的 <code>/proc</code> file. 可以在许多系统组件上检索实时信息。其中的一些文件 <code>/proc</code> 也可以被用户和应用程序操作来配置内核.</p>
<p>以下 <code>/proc</code> 文件与管理和监视系统存储相关:</p>
<ul>
<li><p>/proc/devices</p>
<p>显示当前配置的各种字符和块设备.</p>
</li>
<li><p>/proc/filesystems</p>
<p>列出内核当前支持的所有文件系统类型.</p>
</li>
<li><p>/proc/mdstat</p>
<p>包含系统上多磁盘或RAID配置的最新信息（如果存在）.</p>
</li>
<li><p>/proc/mounts</p>
<p>列出系统当前使用的所有挂载.</p>
</li>
<li><p>/proc/partitions</p>
<p>包含分区块分配信息.</p>
</li>
</ul>
<h3 id="Discard-Unused-Blocks"><a href="#Discard-Unused-Blocks" class="headerlink" title="Discard Unused Blocks"></a>Discard Unused Blocks</h3><p>批量丢弃和联机丢弃操作是挂载文件系统的功能，丢弃文件系统未使用的块。它们对于固态驱动器和精简配置存储都很有用.</p>
<ul>
<li><em>批处理丢弃操作</em> 由用户通过 <code>fstrim</code>命令显式地运行. 该命令放弃文件系统中符合用户标准的所有未使用的块.</li>
<li><em>在线丢弃操作</em> 是在挂载时指定的, 可以将 <code>-o discard</code>选项作为 <code>mount</code> 命令的一部分，也可以使用文件中的 <code>discard</code> 选项在 <code>/etc/fstab</code> 文件中. 他们在没有用户干预的情况下实时运行。在线丢弃操作只丢弃正在使用的空闲块.</li>
</ul>
<p>Both operation types are supported for use with ext4 file systems as of Red Hat Enterprise Linux 6.2 and later and with XFS file systems since Red Hat Enterprise Linux 6.4. Also, the block device underlying the file system must support physical discard operations. Physical discard operations are supported if the value stored in the <code>/sys/block/*device*/queue/discard_max_bytes</code> file is not zero.</p>
<p>Red Hat recommends batch discard operations unless the system’s workload is such that batch discard is not feasible, or online discard operations are necessary to maintain performance.</p>
<h1 id="XFS-文件系统"><a href="#XFS-文件系统" class="headerlink" title="XFS 文件系统"></a>XFS 文件系统</h1><p>XFS是一个高度可扩展的高性能文件系统，最初是在Silicon Graphics，Inc.设计的。XFS是Red Hat Enterprise Linux 7的默认文件系统.</p>
<ul>
<li><p>主要特点</p>
<p>XFS 支持 <em>元数据日志记录</em>, 这有助于更快的崩溃恢复。XFS文件系统也可以在安装和激活时进行碎片整理和放大。另外，红帽企业版Linux 7支持特定于XFS的备份和恢复实用程序。</p>
</li>
<li><p>分配功能</p>
<p>XFS 具有以下分配方案:</p>
<ul>
<li>Extent-based allocation</li>
<li>Stripe-aware allocation policies</li>
<li>Delayed allocation</li>
<li>Space pre-allocation</li>
</ul>
<p>延迟分配和其他性能优化会以与ext4相同的方式影响XFS。也就是说，除非程序 <code>fsync()</code> 后发出调用，否则程序对XFS文件系统的写入不能保证在磁盘上.</p>
</li>
</ul>
<p>其他 XFS 功能</p>
<p>XFS文件系统还支持以下内容:</p>
<ul>
<li><p><em>扩展属性</em> (<code>xattr</code>)</p>
<p>这允许系统为每个文件关联几个附加的名称/值对。它是默认启用的.</p>
</li>
<li><p><em>配额日记</em></p>
<p>这样可以避免在崩溃后需要进行冗长的配额一致性检查.</p>
</li>
<li><p><em>项目/目录配额</em></p>
<p>这允许在目录树上进行配额限制.</p>
</li>
<li><p><em>秒时间戳</em></p>
<p>这允许时间戳到秒.</p>
</li>
</ul>
<p>默认<code>atime</code>行为是 <code>relatime</code></p>
<p><code>Relatime</code>对于XFS默认是打开的。相比之下，它几乎没有任何开销 <code>noatime</code> 同时仍然保持理智的 <code>atime</code> 值.</p>
<h2 id="创建一个XFS文件系统"><a href="#创建一个XFS文件系统" class="headerlink" title="创建一个XFS文件系统"></a>创建一个XFS文件系统</h2><p>创建一个XFS文件系统, 使用 <code>mkfs.xfs /dev/*device*</code> 命令. 一般来说，默认选项是常用的最佳选择.</p>
<p>在 <code>mkfs.xfs</code> 包含现有文件系统的块设备上使用时， 使用 <code>-f</code>选项强制覆盖该文件系统.</p>
<p><strong>  mkfs.xfs Command Output</strong></p>
<p>以下是<code>mkfs.xfs</code>命令的输出示例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">meta-data=/dev/device            isize=256    agcount=4, agsize=3277258 blks</span><br><span class="line">=                       sectsz=512   attr=2</span><br><span class="line">data     =                       bsize=4096   blocks=13109032, imaxpct=25</span><br><span class="line">=                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0</span><br><span class="line"><span class="built_in">log</span>      =internal <span class="built_in">log</span>           bsize=4096   blocks=6400, version=2</span><br><span class="line">=                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong></p>
<p>A在创建XFS文件系统之后，其大小不能减小. 但是，使用 <code>xfs_growfs</code>命令仍然可以扩大.</p>
<p>对于条带块设备（例如RAID5阵列），可以在创建文件系统时指定条带几何。使用适当的条带几何可以极大地提高XFS文件系统的性能.</p>
<p>在LVM或MD卷上创建文件系统时, <code>mkfs.xfs</code> 选择最佳几何体。在某些将几何信息导出到操作系统的硬件RAID上，这也可能是正确的.</p>
<p>如果设备导出条带几何信息, <code>mkfs</code> (for ext3, ext4, and xfs) 将自动使用此几何。如果条纹几何体没有被mkfs检测到，并且即使存储器实际上具有条纹几何体，也可以使用以下选项在mkfs时间手动指定它:</p>
<ul>
<li><p>su=<em>value</em></p>
<p>指定条带单位或RAID块大小. The <code>*value*</code> m必须以字节为单位指定, 具有可选的 <code>k</code>, <code>m</code>, 或 <code>g</code> 后缀.</p>
</li>
<li><p>sw=<em>value</em></p>
<p>指定RAID设备中的数据磁盘数量，或条带中的条带单元数量.</p>
</li>
</ul>
<p>The following example specifies a chunk size of 64k on a RAID device containing 4 stripe units:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkfs.xfs -d su=64k,sw=4 /dev/device</span></span><br></pre></td></tr></table></figure>
<h2 id="挂载-XFS-文件系统"><a href="#挂载-XFS-文件系统" class="headerlink" title="挂载  XFS 文件系统"></a>挂载  XFS 文件系统</h2><p>以下示例在包含4个条带单元的RAID设备上指定64k的块大小:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount /dev/device /mount/point</span></span><br></pre></td></tr></table></figure>
<p>红帽企业版Linux 7的默认值是inode64.</p>
<p><strong>注意</strong></p>
<p>与mke2fs不同，mkfs.xfs不使用配置文件; 它们都在命令行中指定.</p>
<h2 id="Write-Barriers"><a href="#Write-Barriers" class="headerlink" title="Write Barriers"></a>Write Barriers</h2><p>默认情况下, XFS 使用 write barriers 来确保文件系统完整性，即使启用了写入缓存的设备断电时也是如此。对于没有写入缓存的设备，或使用电池支持写入缓存的设备，请使用以下 <code>nobarrier</code> 选项禁用Write Barriers:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount -o nobarrier /dev/device /mount/point</span></span><br></pre></td></tr></table></figure>
<h3 id="Direct-Access-技术预览"><a href="#Direct-Access-技术预览" class="headerlink" title="Direct Access 技术预览"></a>Direct Access 技术预览</h3><p>从红帽企业版Linux 7.3开始, <code>Direct Access</code> (DAX) 作为ext4和XFS文件系统上的技术预览版提供了应用程序将持久内存直接映射到其地址空间的方法。要使用DAX，系统必须具有某种形式的持久性内存，通常以一个或多个非易失性双列直插式内存模块（NVDIMM）的形式提供，并且必须在NVDIMM上创建支持DAX的文件系统（ S）。此外，文件系统必须使用 <code>dax</code> 挂载选项进行安装。然后， <code>mmap</code> 挂载在dax上的文件系统上的一个文件将导致存储直接映射到应用程序的地址空间.</p>
<h2 id="XFS配额管理"><a href="#XFS配额管理" class="headerlink" title="XFS配额管理"></a>XFS配额管理</h2><p>XFS配额子系统管理磁盘空间 (blocks) 和文件 (inode) 使用的限制. XFS配额控制或报告这些项目在用户，组或目录或项目级别上的使用情况。另请注意，尽管用户，组和项目配额是独立启用的，但组和项目配额是互斥的.</p>
<p>在按目录或按项目进行管理时，XFS管理与特定项目关联的目录层次结构的磁盘使用情况。在这样做的过程中，XFS认可项目之间的跨组织“组”边界。这提供了比为用户或组管理配额时可用的控制级别更广的级别.</p>
<p>XFS配额在安装时启用，具有特定的挂载选项。每个安装选项也可以指定为 <code>noenforce</code>; 这将允许使用报告而不强制任何限制。有效的配额挂载选项是:</p>
<ul>
<li><code>uquota</code>/<code>uqnoenforce</code> - 用户配额</li>
<li><code>gquota</code>/<code>gqnoenforce</code> - 组配额</li>
<li><code>pquota</code>/<code>pqnoenforce</code> - 项目配额</li>
</ul>
<p>一旦启用配额 <code>xfs_quota</code> 工具可用于设置限制并报告磁盘使用情况。默认情况下, <code>xfs_quota</code> 以交互方式运行，并处于基本模式。基本模式子命令只是报告使用情况，并可供所有用户使用。基本的 <code>xfs_quota</code> 子命令包括:</p>
<ul>
<li><p>quota <em>username/userID</em></p>
<p>显示给定 <code>*username*</code>或数字的用法和限制 <code>*userID*</code></p>
</li>
<li><p>df</p>
<p>显示块和inode的空闲和使用计数.</p>
</li>
</ul>
<p>相比之下, <code>xfs_quota</code> 也有一个专家模式。该模式的子命令允许实际配置限制，并且仅对具有提升特权的用户可用。要交互使用专家模式子命令，请运行 <code>xfs_quota -x</code>. 专家模式子命令包括:</p>
<ul>
<li><p>report <em>/path</em></p>
<p>报告特定文件系统的配额信息.</p>
</li>
<li><p>limit</p>
<p>修改配额限制.</p>
</li>
</ul>
<p>有关基本或专家模式的子命令的完整列表，请使用子命令<code>help</code>.</p>
<p>所有子命令也可以使用该 <code>-c</code>选项直接从命令行运行，也可以使用 <code>-x</code> 专家子命令.</p>
<p><strong>显示样本配额报告</strong></p>
<p>例如，要显示 <code>/home</code> (on <code>/dev/blockdevice</code>), 的示例配额报告，请使用该命令 <code>xfs_quota -x -c &#39;report -h&#39; /home</code>. 这将显示类似于以下内容的输出:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">User quota on /home (/dev/blockdevice)</span><br><span class="line">Blocks              </span><br><span class="line">User ID      Used   Soft   Hard Warn/Grace   </span><br><span class="line">---------- --------------------------------- </span><br><span class="line">root            0      0      0  00 [------]</span><br><span class="line">testuser   103.4G      0      0  00 [------]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>要为用户 <code>john</code> (其主目录是 <code>/home/john</code>), 分别设置500和700的软硬节点数限制，请使用以下命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xfs_quota -x -c 'limit isoft=500 ihard=700 john' /home/</span></span><br></pre></td></tr></table></figure>
<p>在这种情况下，传递 <em>mount_point</em> 这是挂载的xfs文件系统.</p>
<p>默认情况下，<code>limit</code> 子命令将目标识别为用户。在配置组的限制时，使用 <code>-g</code> 如上例）。同样, use <code>-p</code> 用于项目.</p>
<p>软和硬块限制也可以使用 <code>bsoft</code> 或<code>bhard</code>代替<code>isoft</code> 或<code>ihard</code>.</p>
<p><strong>设置一个软和硬块限制</strong></p>
<p>例如，要分别为 <code>accounting</code> 在 <code>/target/path</code>文 件系统上设置1000m和1200m的软硬件块限制:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xfs_quota -x -c 'limit -g bsoft=1000m bhard=1200m accounting' /target/path</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong></p>
<p>命令 <code>bsoft</code> and <code>bhard</code> 字节计数.</p>
<p><strong>重要</strong></p>
<p>虽然在设置配额时，实时块 (<code>rtbhard</code>/<code>rtbsoft</code>) 被描述<code>man xfs_quota</code> 为有效单位, 但此版本中未启用实时子卷。因此， <code>rtbhard</code> and <code>rtbsoft</code> 选项是不适用的.</p>
<h2 id="设置项目限制"><a href="#设置项目限制" class="headerlink" title="设置项目限制"></a>设置项目限制</h2><p>在为项目控制的目录配置限制之前，先将它们添加到<code>/etc/projects</code>。可以添加项目名称<code>/etc/projectid</code>以将项目ID映射到项目名称。项目添加完成后<code>/etc/projects</code>，使用以下命令初始化项目目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xfs_quota -x -c 'project -s projectname' project_path</span></span><br></pre></td></tr></table></figure>
<p>初始化目录的项目的配额然后可以配置，：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xfs_quota -x -c 'limit -p bsoft=1000m bhard=1200m projectname'</span></span><br></pre></td></tr></table></figure>
<p>通用配额配置工具（quota，repquota，和edquota例如）也可以用于操纵XFS配额。但是，这些工具不能用于XFS项目配额。</p>
<p><strong>重要</strong></p>
<p>红帽推荐使用<code>xfs_quota</code> 和其他所有可用的工具。</p>
<p>有关设置XFS配额的更多信息, 请参阅 <code>man xfs_quota</code>, <code>man projid(5)</code>,和<code>man projects(5)</code>.</p>
<h2 id="增加XFS文件系统的大小"><a href="#增加XFS文件系统的大小" class="headerlink" title="增加XFS文件系统的大小"></a>增加XFS文件系统的大小</h2><p>使用以下 <code>xfs_growfs</code> 命令挂载XFS文件系统:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xfs_growfs /mount/point -D size</span></span><br></pre></td></tr></table></figure>
<p> <code>-D *size*</code>选项使文件系统增长到指定的<code>*size*</code> (以文件系统块表示). 如果没有选项 <code>-D *size*</code> 选项， <code>xfs_growfs</code> 则会将文件系统增大到设备支持的最大大小.</p>
<p>在生成XFS文件系统之前 <code>-D *size*</code>, 请确保基础块设备具有适当的大小以便稍后保存文件系统. 为受影响的块设备使用适当的调整大小的方法.</p>
<p><strong>注意</strong></p>
<p>虽然XFS文件系统可以在挂载时进行扩容，但是它们的大小根本无法缩小.</p>
<h2 id="修复XFS文件系统"><a href="#修复XFS文件系统" class="headerlink" title="修复XFS文件系统"></a>修复XFS文件系统</h2><p>要修复XFS文件系统，请使用 <code>xfs_repair</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xfs_repair /dev/device</span></span><br></pre></td></tr></table></figure>
<p> <code>xfs_repair</code> 用程序具有高度的可扩展性，能够有效地修复具有多个inode的超大型文件系统。与其他Linux文件系统不同, <code>xfs_repair</code> 即使在XFS文件系统未完全卸载的情况下，也不会在启动时运行, 在不清洁的情况下，<code>xfs_repair</code> 只需在安装时重播日志，确保一致的文件系统。</p>
<p><strong>警告</strong></p>
<p> <code>xfs_repair</code>实用程序无法修复具有脏日志的XFS文件系统。要清除日志，请挂载和卸载XFS文件系统。如果日志损坏且无法重播，请使用-L选项（“强制日志清零”）清除日志，即。请注意，这可能会导致进一步的损坏或数据丢失。, <code>xfs_repair -L */dev/device*</code>. 这可能会导致进一步的损坏或数据丢失.</p>
<h2 id="暂停XFS文件系统"><a href="#暂停XFS文件系统" class="headerlink" title="暂停XFS文件系统"></a>暂停XFS文件系统</h2><p>要暂停或恢复对文件系统的写入活动, 请使用 <code>xfs_freeze</code>. 暂停写入活动允许基于硬件的设备快照以一致的状态捕获文件系统.</p>
<p><strong>注意</strong></p>
<p><code>xfs_freeze</code>实用程序由 <code>xfsprogs</code> 程序包提供, 仅在x86_64上可用.</p>
<p>要暂停（即冻结）XFS文件系统，请使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xfs_freeze -f /mount/point</span></span><br></pre></td></tr></table></figure>
<p>要解冻XFS文件系统，请使用:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xfs_freeze -u /mount/point</span></span><br></pre></td></tr></table></figure>
<p>在创建LVM快照时，不需要先使用 <code>xfs_freeze</code> 挂起文件系统。相反，LVM管理工具将在拍摄快照之前自动挂起XFS文件系统.</p>
<h2 id="XFS文件系统的备份和恢复"><a href="#XFS文件系统的备份和恢复" class="headerlink" title="XFS文件系统的备份和恢复"></a>XFS文件系统的备份和恢复</h2><p>XFS文件系统备份和恢复涉及两个实用程序: <code>xfsdump</code> 和 <code>xfsrestore</code>.<br>要备份或转储XFS文件系统，请使用 <code>xfsdump</code> 实用程序. 红帽企业版Linux 7支持备份到磁带驱动器或常规文件映像，并允许将多个转储写入同一个磁带.  <code>xfsdump</code> 实用程序实用程序还允许转储跨越多个磁带，但只能将一个转储写入常规文件。此外.<code>xfsdump</code> 支持增量备份，并且可以使用大小，子树或inode标志从备份中排除文件以对其进行过滤.</p>
<p>为了支持增量备份, <code>xfsdump</code> 使用 <em>dump levels</em> 来确定特定转储相对于的基本转储.  <code>-l</code> 选项指定转储级别 (<em>0-9</em>). 要执行完整备份，请在文件系统上执行 <em>level 0</em> 转储 (<code>*/path/to/filesystem*</code>), 例如:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xfsdump -l 0 -f /dev/device /path/to/filesystem</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong></p>
<p> <code>-f</code> 选项指定备份的目标.例如, <code>/dev/st0</code>目标通常用于磁带驱动器. 一个 <code>xfsdump</code> 目标可以是磁带机, 常规文件，或远程磁带设备.</p>
<p>相比之下，增量备份只会转储自上次<em>第0级</em>转储以来发生更改的文件。1 <em>级</em>转储是完全转储后的第一个增量转储; 下一次增量转储将是<em>级别2</em>，依此类推，最大值为<em>9级</em>。因此，要执行到磁带驱动器的<em>1级</em>转储：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xfsdump -l 1 -f /dev/st0 /path/to/filesystem</span></span><br></pre></td></tr></table></figure>
<p>相反，该<code>xfsrestore</code>实用程序还原由生成的转储文件系统<code>xfsdump</code>。该<code>xfsrestore</code>实用程序有两种模式：默认<em>简单</em>模式和<em>累积</em>模式。特定转储由<em>会话标识</em>或<em>会话标签标识</em>。因此，恢复转储需要相应的会话ID或标签。要显示所有转储（包括完整和增量）的会话ID和标签，请使用以下<code>-I</code>选项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xfsrestore -I</span></span><br></pre></td></tr></table></figure>
<p>这将提供类似于以下的输出:</p>
<p><strong>会话ID和所有转储的标签</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">file system 0:</span><br><span class="line">fs id:		45e9af35-efd2-4244-87bc-4762e476cbab</span><br><span class="line">session 0:</span><br><span class="line">mount point:	bear-05:/mnt/<span class="built_in">test</span></span><br><span class="line">device:		bear-05:/dev/sdb2</span><br><span class="line">time:		Fri Feb 26 16:55:21 2010</span><br><span class="line">session label:	<span class="string">"my_dump_session_label"</span></span><br><span class="line">session id:	b74a3586-e52e-4a4a-8775-c3334fa8ea2c</span><br><span class="line">level:		0</span><br><span class="line">resumed:	NO</span><br><span class="line">subtree:	NO</span><br><span class="line">streams:	1</span><br><span class="line">stream 0:</span><br><span class="line">pathname:	/mnt/test2/backup</span><br><span class="line">start:		ino 0 offset 0</span><br><span class="line">end:		ino 1 offset 0</span><br><span class="line">interrupted:	NO</span><br><span class="line">media files:	1</span><br><span class="line">media file 0:</span><br><span class="line">mfile index:	0</span><br><span class="line">mfile <span class="built_in">type</span>:	data</span><br><span class="line">mfile size:	21016</span><br><span class="line">mfile start:	ino 0 offset 0</span><br><span class="line">mfile end:	ino 1 offset 0</span><br><span class="line">media label:	<span class="string">"my_dump_media_label"</span></span><br><span class="line">media id:	4a518062-2a8f-4f17-81fd-bb1eb2e3cb4f</span><br><span class="line">xfsrestore: Restore Status: SUCCESS</span><br></pre></td></tr></table></figure>
<h2 id="简单模式-xfsrestore"><a href="#简单模式-xfsrestore" class="headerlink" title="简单模式 xfsrestore"></a>简单模式 <code>xfsrestore</code></h2><p>在 <em>simple</em> mode 允许用户从恢复整个文件系统 <em>level 0</em> 转储. 在识别 <em>level 0</em> 转储会话 ID (<code>*session-ID*</code>), 之后完全恢复为 <code>*/path/to/destination*</code> 使用:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xfsrestore -f /dev/st0 -S session-ID /path/to/destination</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong></p>
<p>该<code>-f</code>选项指定转储的位置，而<code>-S</code>or <code>-L</code>选项指定要恢复的特定转储。该<code>-S</code>选项用于指定会话标识，而该<code>-L</code>选项用于会话标签。该<code>-I</code>选项显示每个转储的会话标签和ID</p>
<h2 id="累计模式-xfsrestore"><a href="#累计模式-xfsrestore" class="headerlink" title="累计模式 xfsrestore"></a>累计模式 <code>xfsrestore</code></h2><p>The <em>累计</em> 模式 <code>xfsrestore</code> 允许文件系统恢复来自一个特定的增量备份，例如 <em>level 1</em> to <em>level 9</em>. 要从增量备份还原文件系统，只需添加 <code>-r</code> 选项:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xfsrestore -f /dev/st0 -S session-ID -r /path/to/destination</span></span><br></pre></td></tr></table></figure>
<h2 id="交互式操作"><a href="#交互式操作" class="headerlink" title="交互式操作"></a>交互式操作</h2><p><code>xfsrestore</code> 实用程序还允许从转储中提取，添加或删除特定文件. 使用<code>xfsrestore</code> 交互使用, 使用<code>-i</code> 选项, 如下所示:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xfsrestore -f /dev/st0 -i /destination/directory</span></span><br></pre></td></tr></table></figure>
<p> <code>xfsrestore</code> 完成读取指定的设备 后，交互式对话将开始。在这次对话可用的命令包括 <code>cd</code>, <code>ls</code>, <code>add</code>, <code>delete</code>, and <code>extract</code>; 要获得完整的命令列表，请使用 <code>help</code>.</p>
<h2 id="从磁带恢复备份时的信息性消息"><a href="#从磁带恢复备份时的信息性消息" class="headerlink" title="从磁带恢复备份时的信息性消息"></a>从磁带恢复备份时的信息性消息</h2><p>从具有多个文件系统备份的磁带恢复备份时,  <code>xfsrestore</code> 实用程序可能会发出消息。这些消息通知您 <code>xfsrestore</code> 在按顺序检查磁带上的每个备份时是否找到请求的备份的匹配。例如:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xfsrestore: preparing drive</span><br><span class="line">xfsrestore: examining media file 0</span><br><span class="line">xfsrestore: inventory session uuid (8590224e-3c93-469c-a311-fc8f23029b2a) does not match the media header<span class="string">'s session uuid (7eda9f86-f1e9-4dfd-b1d4-c50467912408)</span></span><br><span class="line"><span class="string">xfsrestore: examining media file 1</span></span><br><span class="line"><span class="string">xfsrestore: inventory session uuid (8590224e-3c93-469c-a311-fc8f23029b2a) does not match the media header'</span>s session uuid (7eda9f86-f1e9-4dfd-b1d4-c50467912408)</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<p>信息性消息一直出现，直到找到匹配的备份.</p>
<p>有关转储和恢复XFS文件系统的更多信息，请参阅,  <code>man xfsdump</code>和 <code>man xfsrestore</code>.</p>
<h2 id="配置错误行为"><a href="#配置错误行为" class="headerlink" title="配置错误行为"></a>配置错误行为</h2><p>在 I/O操作过程中发生错误时 , XFS驱动程序采用以下两种方式之一进行响应:</p>
<ul>
<li>继续重试，直到:<ul>
<li>I/O操作成功，或者</li>
<li>超出I/O 操作重试计数或时间限制.</li>
</ul>
</li>
<li>考虑永久性的错误并暂停系统.</li>
</ul>
<p>XFS目前认识到以下错误情况，您可以专门配置所需的行为:</p>
<ul>
<li><code>EIO</code>:尝试写入设备时出错</li>
<li><code>ENOSPC</code>: 设备上没有剩余空间</li>
<li><code>ENODEV</code>: 设备找不到</li>
</ul>
<p>所有其他可能的错误条件（没有定义特定的处理程序）共享一个全局配置.</p>
<p>您可以设置XFS认为错误永久的条件，包括最大重试次数和最长时间（以秒为单位）。当满足任何一个条件时，XFS将停止重试.</p>
<p>无论是否有其他配置，还可以选择在卸载文件系统时立即取消重试。这使得卸载操作即使在持续错误的情况下也能成功.</p>
<h3 id="特定和未定义条件的配置文件"><a href="#特定和未定义条件的配置文件" class="headerlink" title="特定和未定义条件的配置文件"></a>特定和未定义条件的配置文件</h3><p>控制错误行为的配置文件位于<code>/sys/fs/xfs/device/error/</code>目录.</p>
<p>该目录包含每个特定错误条件的子目录：<code>/sys/fs/xfs/*device*/error/metadata/</code></p>
<ul>
<li><code>/sys/fs/xfs/*device*/error/metadata/EIO/</code> 为 <code>EIO</code> 错误情况</li>
<li><code>/sys/fs/xfs/*device*/error/metadata/ENODEV/</code>为 <code>ENODEV</code> 错误情况</li>
<li><code>/sys/fs/xfs/*device*/error/metadata/ENOSPC/</code>为 <code>ENOSPC</code> 错误情况</li>
</ul>
<p>每一个 都包含以下配置文件’:</p>
<ul>
<li><code>/sys/fs/xfs/*device*/error/metadata/*condition*/max_retries</code>: 控制XFS重试操作的最大次数.</li>
<li><code>/sys/fs/xfs/*device*/error/metadata/*condition*/retry_timeout_seconds</code>: XFS将停止重试操作的时间限制（以秒为单位）</li>
</ul>
<p>所有其他可能出现的错误情况，除了上一节中描述的情况之外，在这些文件中共享一个通用配置:</p>
<ul>
<li><code>/sys/fs/xfs/*device*/error/default/max_retries</code>: 控制最大重试次数</li>
<li><code>/sys/fs/xfs/*device*/error/default/retry_timeout_seconds</code>: 控制重试的时间限制</li>
</ul>
<h3 id="设置特定和未定义条件的文件系统行为"><a href="#设置特定和未定义条件的文件系统行为" class="headerlink" title="设置特定和未定义条件的文件系统行为"></a>设置特定和未定义条件的文件系统行为</h3><p>要设置最大重试次数，请将所需的编号写入 <code>max_retries</code> 文件中.</p>
<ul>
<li>对于特定的条件:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo value &gt; /sys/fs/xfs/device/error/metadata/condition/max_retries</span></span><br></pre></td></tr></table></figure>
<ul>
<li>对于未定义的条件:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo value &gt; /sys/fs/xfs/device/error/default/max_retries</span></span><br></pre></td></tr></table></figure>
<p>值是1到int的最大可能值之间的一个数字，即C有符号整数类型。这是64位Linux上的2147483647。</p>
<p>要设置时间限制，请将所需的秒数写入 <code>retry_timeout_seconds</code>文件.</p>
<ul>
<li>对于特定的条件:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo value &gt; /sys/fs/xfs/device/error/metadata/condition/retry_timeout_seconds</span></span><br></pre></td></tr></table></figure>
<ul>
<li>对于未定义的条件:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo value &gt; /sys/fs/xfs/device/error/default/retry_timeout_seconds</span></span><br></pre></td></tr></table></figure>
<p><em>value</em> 是 <code>-1</code> 和 <code>86400</code>中的数字, 这是一天中的秒数.</p>
<p>在 <code>max_retries</code> 和<code>retry_timeout_seconds</code> 选项中, <code>-1</code> 意味着永远重试， <code>0</code> 立即停止.</p>
<p><em>device</em> 设备的名称, 如 <code>/dev/</code> 目录中所示; 例如, <code>sda</code>.</p>
<p><strong>注意</strong></p>
<p>每个错误条件的默认行为取决于错误上下文。有些错误，比如 <code>ENODEV</code>, 被认为是致命的，无法恢复，不管重试次数如何，所以它们的默认值是 <code>0</code>.</p>
<h3 id="设置卸载行为"><a href="#设置卸载行为" class="headerlink" title="设置卸载行为"></a>设置卸载行为</h3><p>如果 <code>fail_at_unmount</code> 设置了该选项，则文件系统将在卸载过程中覆盖所有其他错误配置，并立即在不重试I / O操作的情况下提升文件系统。这使得卸载操作即使在持续错误的情况下也能成功.</p>
<p>设置卸载行为:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> value &gt; /sys/fs/xfs/device/error/fail_at_unmount</span><br></pre></td></tr></table></figure>
<p><em>value</em> 的值 <code>1</code>或<code>0</code>:</p>
<ul>
<li><code>1</code> 意味着如果发现错误，立即取消重试.</li>
<li><code>0</code>意味着尊重 <code>max_retries</code> 和 <code>retry_timeout_seconds</code>的选择.</li>
</ul>
<p><em>device</em>是设备的名称, 如 <code>/dev/</code>目录中所示; 例如, <code>sda</code>.</p>
<p><strong>重要</strong></p>
<p><code>fail_at_unmount</code>在尝试卸载文件系统之前，必须根据需要设置 该选项。卸载操作启动后，配置文件和目录可能不可用.</p>
<h2 id="其他XFS文件系统实用程序"><a href="#其他XFS文件系统实用程序" class="headerlink" title="其他XFS文件系统实用程序"></a>其他XFS文件系统实用程序</h2><p>红帽企业Linux 7还提供了其他用于管理XFS文件系统的实用程序:</p>
<ul>
<li><p>xfs_fsr</p>
<p>用于对挂载的XFS文件系统进行碎片整理。在没有参数的情况下调用时, <code>xfs_fsr</code> 对所有已挂载的XFS文件系统中的所有常规文件进行碎片整理。此实用程序还允许用户在指定的时间暂停碎片整理，并在以后停止的地方恢复.</p>
<p>另外, <code>xfs_fsr</code> 还允许只对一个文件进行碎片整理, 如 <code>xfs_fsr*/path/to/file*</code>. 红帽建议不要定期对整个文件系统进行碎片整理，因为XFS默认避免碎片。系统范围的碎片整理可能会导致自由空间碎片的副作用.</p>
</li>
<li><p>xfs_bmap</p>
<p>打印XFS文件系统中文件使用的磁盘块映射。该映射列出了指定文件使用的每个范围，以及文件中没有对应块（即孔）的区域.</p>
</li>
<li><p>xfs_info</p>
<p>打印XFS文件系统信息.</p>
</li>
<li><p>xfs_admin</p>
<p>更改XFS文件系统的参. <code>xfs_admin</code> ，实用程序只能修改未安装的设备或文件系统的参数.</p>
</li>
<li><p>xfs_copy</p>
<p>将整个XFS文件系统的内容并行复制到一个或多个目标.</p>
</li>
</ul>
<p>以下实用程序在调试和分析XFS文件系统时也很有用:</p>
<ul>
<li><p>xfs_metadump</p>
<p>将XFS文件系统元数据复制到文件。红帽只支持使用<code>xfs_metadump</code>实用程序来复制未安装的文件系统或只读安装的文件系统; 否则，生成的转储可能被损坏或不一致.</p>
</li>
<li><p>xfs_mdrestore</p>
<p>将XFS metadump映像 (使用生成的 <code>xfs_metadump</code>) 恢复到文件系统映像.</p>
</li>
<li><p>xfs_db</p>
<p>调试XFS文件系统.</p>
</li>
</ul>
<p>有关这些实用程序的更多信息，请参阅各自的 <code>man</code> 页面.</p>
<h3 id="从-XFS迁移到EXT4"><a href="#从-XFS迁移到EXT4" class="headerlink" title="从 XFS迁移到EXT4"></a>从 XFS迁移到EXT4</h3><p>从红帽企业Linux 7.0开始，XFS是默认的文件系统，而不是ext4。本节重点介绍使用或管理XFS文件系统时的差异.</p>
<p>红帽企业版Linux 7中仍然完全支持ext4文件系统，可以在安装时进行选择。虽然可以从ext4迁移到XFS，但并不是必需的.</p>
<h3 id="Ext3-4-与XFS的区别"><a href="#Ext3-4-与XFS的区别" class="headerlink" title="Ext3/4 与XFS的区别"></a>Ext3/4 与XFS的区别</h3><ul>
<li><p>文件系统修复</p>
<p>Ext3 / 4 <code>e2fsck</code>在启动时在用户空间运行，以根据需要恢复日志。相比之下，XFS在挂载时在内核空间执行日志恢复。提供了一个<code>fsck.xfs</code>shell脚本，但没有执行任何有用的操作，因为它只是满足initscript要求。</p>
<p>当请求XFS文件系统修复或检查时，请使用该<code>xfs_repair</code>命令。使用该<code>-n</code>选项进行只读检查。</p>
<p>该<code>xfs_repair</code>命令不会在具有脏日志的文件系统上运行。要修复这样的文件系统<code>mount</code>，<code>unmount</code>必须首先执行重播日志。如果日志损坏且无法重播，则<code>-L</code>可以使用该选项在日志中将其清零</p>
</li>
<li><p>元数据错误行为</p>
<p>遇到元数据错误时，ext3/4文件系统具有可配置的行为，默认情况下只是继续。当XFS遇到不可恢复的元数据错误时，将关闭文件系统并返回<code>EFSCORRUPTED</code>错误。系统日志将包含所遇到的错误的详细信息，<code>xfs_repair</code>如果有必要，将建议运行。</p>
</li>
<li><p>配额</p>
<p>XFS配额不是可重新安装的选项。<code>-o quota</code>必须在初始安装中指定该选项才能使配额生效。</p>
<p>尽管配额包中的标准工具可以执行基本的配额管理任务（诸如<strong>setquota</strong>和<strong>repquota</strong>之<strong>类的</strong>工具），但<strong>xfs_quota</strong>工具可用于特定于XFS的功能，例如“项目配额管理”。</p>
<p>该<code>quotacheck</code>命令对XFS文件系统没有影响。第一次配额会计开启XFS在<code>quotacheck</code>内部自动执行。因为XFS配额元数据是头等级的日志元数据对象，所以配额系统将始终保持一致，直到手动关闭配额为止</p>
</li>
<li><p>调整文件系统大小</p>
<p>XFS文件系统没有实用程序来缩小文件系统。XFS文件系统可以通过<code>xfs_growfs</code>命令在线增长</p>
</li>
<li><p>Inode numbers</p>
<p>对于文件系统大于1 TB（256字节inode）或大于2 TB（512字节inode）的文件系统，XFS索引节点数可能会超过2^32。如此大的inode编号会导致32位统计调用失败，并返回EOVERFLOW值。使用默认的红帽企业版Linux 7配置时可能会出现上述问题：不带有四个分配组的条带。自定义配置（例如文件系统扩展或更改XFS文件系统参数）可能会导致不同的行为.</p>
<p>应用程序通常会正确处理这种更大的inode编号 如果需要，使用<code>-o inode32</code>参数来挂载XFS文件系统，以实施低于2 ^ 32的索引节点号。请注意，使用<code>inode32</code>不会影响已用64位数分配的inode</p>
</li>
<li><p>预分配</p>
<p>当文件被写入时， XFS使用<em>推测预分配</em>来分配经过EOF的块。这避免了由于NFS服务器上的并发流式写入工作负载而导致的文件碎片。默认情况下，这个预分配随着文件的大小而增加，并在“du”输出中显而易见。如果具有推测预分配的文件在五分钟内未被弄脏，则预分配将被丢弃。如果inode在该时间之前从高速缓存中循环，那么当inode被回收时，预分配将被丢弃。</p>
<p>如果由于预测性预分配而导致ENOSPC过早出现问题，则可以使用挂载选项来指定固定的预分配量。 <code>-o allocsize=*amount*</code></p>
</li>
<li><p>碎片相关的工具</p>
<p>由于启发式和行为（如延迟分配和推测预分配），碎片在XFS文件系统中很少成为一个重要问题。但是，存在用于测量文件系统碎片以及碎片整理文件系统的工具。他们的使用是不鼓励的。</p>
<p>该<code>xfs_db frag</code>命令会尝试将所有文件系统分配提取到单个碎片编号中，以百分比表示。命令的输出需要大量的专业知识来理解其含义。例如，75％的碎片因子意味着每个文件只有平均4个范围。出于这个原因，xfs_db的frag的输出不被认为是有用的，并且推荐对所有碎片问题进行更仔细的分析.</p>
<p>ext3 、ext4与 XFS的命令比较</p>
</li>
</ul>
<p>下表将ext3和ext4中使用的常用命令与特定于XFS的对应项进行了比较。.</p>
<p><strong>ext3 、ext4与 XFS的命令比</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>任务</th>
<th>ext3/4</th>
<th>XFS</th>
</tr>
</thead>
<tbody>
<tr>
<td>创建一个文件系统</td>
<td><code>mkfs.ext4</code> or <code>mkfs.ext3</code></td>
<td><code>mkfs.xfs</code></td>
</tr>
<tr>
<td>文件系统检查</td>
<td><code>e2fsck</code></td>
<td><code>xfs_repair</code></td>
</tr>
<tr>
<td>调整文件系统的大小</td>
<td><code>resize2fs</code></td>
<td><code>xfs_growfs</code></td>
</tr>
<tr>
<td>保存文件系统的图像</td>
<td><code>e2image</code></td>
<td><code>xfs_metadump</code> and <code>xfs_mdrestore</code></td>
</tr>
<tr>
<td>标记或调整文件系统</td>
<td><code>tune2fs</code></td>
<td><code>xfs_admin</code></td>
</tr>
<tr>
<td>备份文件系统</td>
<td><code>dump</code> and <code>restore</code></td>
<td><code>xfsdump</code> and <code>xfsrestore</code></td>
</tr>
</tbody>
</table>
</div>
<p>下表列出了在XFS文件系统上运行的通用工具，但XFS版本具有更多特定的功能，因此建议使用这些工具.</p>
<p><strong>用于ext4 和 XFS的工具</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Task</th>
<th>ext4</th>
<th>XFS</th>
</tr>
</thead>
<tbody>
<tr>
<td>定额</td>
<td><code>quota</code></td>
<td><code>xfs_quota</code></td>
</tr>
<tr>
<td>文件映射</td>
<td><code>filefrag</code></td>
<td><code>xfs_bmap</code></td>
</tr>
</tbody>
</table>
</div>
<h1 id="EXT3文件系统"><a href="#EXT3文件系统" class="headerlink" title="EXT3文件系统"></a>EXT3文件系统</h1><p>ext3文件系统本质上是ext2文件系统的增强版本。这些改进提供了以下优点:</p>
<ul>
<li><p>可用性</p>
<p>在发生意外的电源故障或系统崩溃（也称为<em>不清洁的系统关闭</em>）之后，必须通过<code>e2fsck</code>程序检查机器上每个安装的ext2文件系统的一致性。这是一个耗时的过程，可以显着延迟系统启动时间，特别是对于包含大量文件的大卷而言。在此期间，卷上的任何数据都无法访问。</p>
<p>可以<code>fsck -n</code>在一个活的文件系统上运行。但是，如果遇到部分写入的元数据，则不会做出任何更改并可能导致误导结果。</p>
<p>如果在堆栈中使用LVM，则另一个选择是取得文件系统的LVM快照并<code>fsck</code>在其上运行。</p>
<p>最后，可以选择以只读方式重新挂载文件系统。所有挂起的元数据更新（和写入）然后在重新装入之前强制到磁盘。这确保文件系统处于一致的状态，只要没有以前的损坏。现在可以运行了<code>fsck -n</code>。</p>
<p>ext3文件系统提供的日志功能意味着在系统不正常关闭后，不再需要这种文件系统检查。使用ext3进行一致性检查的唯一时间是在某些罕见的硬件故障情况下，例如硬盘故障。系统不正常关闭后恢复ext3文件系统的时间不取决于文件系统的大小或文件的数量; 相反，这取决于用来保持一致性的<em>日志</em>的大小。根据硬件的速度，默认的日志大小需要大约一秒的恢复时间.</p>
</li>
<li><p>数据的完整性</p>
<p>ext3文件系统防止发生不洁系统关闭时丢失数据完整性。ext3文件系统允许您选择数据收到的保护类型和级别。关于文件系统的状态，ext3卷默认配置为保持高水平的数据一致性.</p>
</li>
<li><p>速度</p>
<p>尽管多次写入一些数据，ext3在大多数情况下比ext2具有更高的吞吐量，因为ext3的日志优化了硬盘驱动器的磁头运动。您可以从三种日志模式中进行选择以优化速度，但是如果系统出现故障，则意味着在数据完整性方面进行权衡.</p>
</li>
</ul>
<ul>
<li><p>轻松过渡</p>
<p>从ext2迁移到ext3非常容易，并且无需重新格式化即可从强大的日志文件系统中获益。有关如何执行此任务的更多信息。</p>
</li>
</ul>
<h2 id="创建-Ext3-文件系统"><a href="#创建-Ext3-文件系统" class="headerlink" title="创建 Ext3 文件系统"></a>创建 Ext3 文件系统</h2><p>安装之后，有时需要创建一个新的ext3文件系统。例如，如果将新的磁盘驱动器添加到系统中，则可能需要对驱动器进行分区并使用ext3文件系统.</p>
<p>  创建一个ext3文件系统的步骤如下:</p>
<p><strong>创建一个ext3文件系统</strong></p>
<p>1.使用<code>mkfs.ext3</code>格式化分区ext3文件系统或LVM卷 .</p>
<ol>
<li>使用 <code>e2label</code>标签文件系统.</li>
</ol>
<p>也可以为文件系统设置特定的UUID。要在创建文件系统时指定UUID，请使用以下<code>-U</code>选项:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkfs.ext3 -U UUID /dev/device</span></span><br></pre></td></tr></table></figure>
<p>将<em>UUID</em>替换为您要设置的UUID ,例如<code>7cd65de3-e0be-41d9-b66d-96d749c02da7</code>。将设备替换为<code>ext3</code>件系统以添加UUID：例如<code>sda8</code></p>
<h2 id="转换为EXT3文件系统"><a href="#转换为EXT3文件系统" class="headerlink" title="转换为EXT3文件系统"></a>转换为EXT3文件系统</h2><p><code>tune2fs</code> 命令将 <code>ext2</code> 文件系统转换为 <code>ext3</code>.</p>
<p><strong>注意</strong></p>
<p>要将ext2转换为ext3 ,请始终使用该<code>e2fsck</code> 实用程序在使用前后检查文件系统 <code>tune2fs</code>. 在尝试将ext2转换为ext3之前, 备份所有文件系统以防发生任何错误.</p>
<p>另外，Red Hat建议创建一个新的ext3文件系统并将数据迁移到它，而不是从ext2转换为ext3.</p>
<p>要将 <code>ext2</code> 文件系统转换为 <code>ext3</code>,请以root用户身份登录，然后在终端中键入以下命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tune2fs -j block_device</span></span><br></pre></td></tr></table></figure>
<p><em>block_device</em> 包含要转换的ext2文件系统.</p>
<p> <code>df</code> 命令以显示已安装的文件系统.</p>
<h2 id="恢复到EXT2文件系统"><a href="#恢复到EXT2文件系统" class="headerlink" title="恢复到EXT2文件系统"></a>恢复到EXT2文件系统</h2><p>为了恢复到ext2文件系统，请使用以下步骤.</p>
<p>为简单起见，本节中的示例命令对块设备使用以下值:</p>
<p><code>/dev/mapper/VolGroup00-LogVol02</code></p>
<p><strong>从ext3恢复到ext2</strong></p>
<ol>
<li>以root身份登录并键入以下命令卸载分区:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># umount /dev/mapper/VolGroup00-LogVol02</span></span><br></pre></td></tr></table></figure>
<ol>
<li>通过输入以下命令将文件系统类型更改为ext2:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tune2fs -O ^has_journal /dev/mapper/VolGroup00-LogVol02</span></span><br></pre></td></tr></table></figure>
<ol>
<li>输入以下命令来检查分区是否有错误:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># e2fsck -y /dev/mapper/VolGroup00-LogVol02</span></span><br></pre></td></tr></table></figure>
<ol>
<li>然后通过键入以下命令再次将分区挂载为ext2文件系统:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount -t ext2 /dev/mapper/VolGroup00-LogVol02 /mount/point</span></span><br></pre></td></tr></table></figure>
<p>   在上述命令中, 将 <em>/mount/point</em> 替换为分区的挂载点.</p>
<p>   <strong>注意</strong></p>
<p>   如果 <code>.journal</code>文件存在于分区的根目录下，请将其删除.</p>
<p>要将分区永久更改为 ext2, 请记住更新该 <code>/etc/fstab</code> 文件, 则将在引导后恢复.</p>
<h1 id="EXT4文件系统"><a href="#EXT4文件系统" class="headerlink" title="EXT4文件系统"></a>EXT4文件系统</h1><p>ext4文件系统是ext3文件系统的可扩展扩展。使用红帽企业版Linux 7，它可以支持最大单个文件大小为16 TB，文件系统最大支持50 TB，而红帽企业版Linux 6仅支持高达16 TB的文件系统。它也支持无限数量的子目录（ext3文件系统最多只支持32,000个），但是一旦链接数量超过了65,000，它将重置为1，不再增加。bigalloc功能目前不支持.</p>
<p><strong>注意</strong></p>
<p>和ext3一样，一个ext4卷必须被卸载才能执行<code>fsck</code>.</p>
<ul>
<li><p>主要特点</p>
<p>Ext4使用扩展（与ext2和ext3使用的传统块映射方案相反），这可以提高使用大型文件时的性能，并减少大型文件的元数据开销。此外，ext4还会相应地标记未分配的块组和inode表段，这样可以在文件系统检查过程中跳过它们。这使得文件系统检查更快，随着文件系统规模的扩大，这种检查变得更加有利</p>
</li>
<li><p>分配功能</p>
<p>ext4文件系统具有以下分配方案：<br>持续的预分配<br>延迟分配<br>多块分配<br>条纹感知分配<br>由于延迟分配和其他性能优化，ext4将文件写入磁盘的行为与ext3不同。在ext4中，当程序写入文件系统时，除非程序<code>fsync()</code>发起调用，否则不能保证在磁盘上</p>
</li>
</ul>
<p>默认情况下，即使没有，ext3也会立即强制新建文件到磁盘<br><code>fsync()</code>。这种行为隐藏了一些程序中没有<code>fsync()</code>用来确保写入数据在磁盘上的错误。另一方面，ext4文件系统通常会等待几秒钟才能写出对磁盘的更改，从而允许它对写入进行组合和重新排序以获得比ext3更好的磁盘性能.</p>
<p>与ext3不同，ext4文件系统在事务提交时不强制数据到磁盘。因此，将缓冲的写入刷新到磁盘需要更长的时间。与任何文件系统一样，使用数据完整性调用<code>fsync()</code>来确保将数据写入永久存储.</p>
<ul>
<li><p>其他Ext4功能</p>
<p>ext4文件系统还支持以下内容:<br>扩展属性（xattr） - 这允许系统为每个文件关联几个附加的名称和值对。<br>配额日志 - 这可避免在崩溃后需要进行冗长的配额一致性检查。</p>
</li>
</ul>
<h2 id="创建一个Ext4文件系统"><a href="#创建一个Ext4文件系统" class="headerlink" title="创建一个Ext4文件系统"></a>创建一个Ext4文件系统</h2><p>要创建一个ext4文件系统，请使用<code>mkfs.ext4</code> 命令。一般来说，默认选项对于大多数使用情况是最佳的:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkfs.ext4 /dev/device</span></span><br></pre></td></tr></table></figure>
<p>以下是此命令的输出示例，它显示了生成的文件系统几何图形和特征:</p>
<p><strong>mkfs.ext4 Command Output</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext4 /dev/sdb1</span><br><span class="line">mke2fs 1.41.12 (17-May-2010)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS <span class="built_in">type</span>: Linux</span><br><span class="line">Block size=4096 (<span class="built_in">log</span>=2)d</span><br><span class="line">Fragment size=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">245280 inodes, 979456 blocks</span><br><span class="line">48972 blocks (5.00%) reserved <span class="keyword">for</span> the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=1006632960</span><br><span class="line">30 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8176 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line"> 32768, 98304, 163840, 229376, 294912, 819200, 884736</span><br><span class="line"></span><br><span class="line">Writing inode tables: <span class="keyword">done</span>                            </span><br><span class="line">Creating journal (16384 blocks): <span class="keyword">done</span></span><br><span class="line">Writing superblocks and filesystem accounting information: <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>对于条带块设备（例如RAID5阵列），可以在创建文件系统时指定条带几何。使用适当的条纹几何形状极大地提高了ext4文件系统的性能.</p>
<p>  在LVM或MD卷上创建文件系统时, <code>mkfs.ext4</code> 选择最佳几何体。在将几何信息输出到操作系统的某些硬件RAID上，这也可能是正确的.</p>
<p>要指定条状结构,使用<code>-E</code> ,<code>mkfs.ext4</code>（即，扩展文件系统选项）具有以下子选项</p>
<ul>
<li><p>stride=<em>value</em></p>
<p>指定RAID块大小.</p>
</li>
<li><p>stripe-width=<em>value</em></p>
<p>指定RAID设备中的数据磁盘数量，或条带中的条带单元数量.</p>
</li>
</ul>
<p>对于这两个子选项, <code>*value*</code> 必须在文件系统块单位中指定. 例如，要在4k块文件系统上创建一个带有64k步长（即16 x 4096）的文件系统，请使用以下命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkfs.ext4 -E stride=16,stripe-width=64 /dev/device</span></span><br></pre></td></tr></table></figure>
<p><strong>重要</strong></p>
<p>可以使用 <code>tune2fs</code> 在ext3文件系统上开启某些ext4功能. 但是,  <code>tune2fs</code> 以这种方式使用还没有经过充分的测试，因此在红帽企业版Linux 7中不支持。因此，红帽无法保证通过使用转换或挂载的ext3文件系统的一致性能和可预测的行为 <code>tune2fs</code>.</p>
<p>It is also possible to set a specific UUID for a file system. To specify a UUID when creating a file system, use the <code>-U</code> option:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mkfs.ext4 -U UUID &#x2F;dev&#x2F;device</span><br></pre></td></tr></table></figure>
<p>将<em>UUID</em>替换为您要设置的UUID,例如 <code>7cd65de3-e0be-41d9-b66d-96d749c02da7</code>. 将<em>设备</em>替换为 ext4文件系统以添加UUID：例如, <code>sda8</code>.</p>
<h2 id="挂载EXT4文件系统"><a href="#挂载EXT4文件系统" class="headerlink" title="挂载EXT4文件系统"></a>挂载EXT4文件系统</h2><p>一个ext4文件系统可以挂载，没有额外的选项。例如:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount /dev/device /mount/point</span></span><br></pre></td></tr></table></figure>
<p>ext4文件系统也支持多个挂载选项来影响行为。例如，<code>acl</code>参数启用访问控制列表，而<code>user_xattr</code>参数启用用户扩展属性。要启用这两个选项，请使用它们各自的参数<code>-o</code>，如下所示:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount -o acl,user_xattr /dev/device /mount/point</span></span><br></pre></td></tr></table></figure>
<p>和ext3一样，<code>data_err=abort</code>如果在文件数据中发生错误，该选项可以用来中止日志.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount -o data_err=abort /dev/device /mount/point</span></span><br></pre></td></tr></table></figure>
<p>该<code>tune2fs</code>实用程序还允许管理员在文件系统超级块中设置默认挂载选项。有关这方面的更多信息，请参阅<code>man tune2fs</code>.</p>
<h3 id="写屏障"><a href="#写屏障" class="headerlink" title="写屏障"></a>写屏障</h3><p>默认情况下，ext4使用写入屏障来确保文件系统完整性，即使启用写入缓存的设备断电也是如此。对于没有写入缓存的设备或使用电池供电的写入缓存，请使用<code>nobarrier</code>选项禁用屏障，如下所示:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount -o nobarrier /dev/device /mount/point</span></span><br></pre></td></tr></table></figure>
<h2 id="直接访问"><a href="#直接访问" class="headerlink" title="直接访问"></a>直接访问</h2><p>从红帽企业版Linux 7.3开始，<code>Direct Access</code>（DAX）作为ext4和XFS文件系统上的技术预览版提供了应用程序将持久内存直接映射到其地址空间的方法。要使用DAX，系统必须具有某种形式的持久性内存，通常以一个或多个非易失性双列直插式内存模块（NVDIMM）的形式提供，并且必须在NVDIMM上创建支持DAX的文件系统（ S）。此外，文件系统必须使用<code>dax</code>安装选项进行安装。然后，<code>mmap</code>安装在dax上的文件系统上的一个文件将导致存储直接映射到应用程序的地址空间.</p>
<h2 id="调整EXT4文件系统的大小"><a href="#调整EXT4文件系统的大小" class="headerlink" title="调整EXT4文件系统的大小"></a>调整EXT4文件系统的大小</h2><p>在扩展ext4文件系统之前，请确保底层的块设备具有适当的大小以便稍后保存文件系统。为受影响的块设备使用适当的调整大小的方法.</p>
<p>ext4文件系统可以在使用以下<code>resize2fs</code>命令挂载时扩展:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># resize2fs /mount/device size</span></span><br></pre></td></tr></table></figure>
<p>该<code>resize2fs</code>命令还可以减小<em>未挂载的</em> ext4文件系统的大小:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># resize2fs /dev/device size</span></span><br></pre></td></tr></table></figure>
<p>在调整ext4文件系统<code>resize2fs</code>的大小时，实用程序将以文件系统块大小为单位读取大小，除非使用了指定特定单元的后缀。以下后缀表示特定单位:</p>
<ul>
<li><code>s</code> —  512字节的扇区</li>
<li><code>K</code> — 千字节</li>
<li><code>M</code> — 兆字节</li>
<li><code>G</code> — 千兆字节</li>
</ul>
<p><strong>注意</strong></p>
<p>size参数在扩展时是可选的（通常是冗余的）。所述<code>resize2fs</code>自动膨胀以填充所述容器的所有可用空间，通常是一个逻辑卷或分区。</p>
<p>有关调整ext4文件系统大小的更多信息，请参阅 <code>man resize2fs</code>.</p>
<h2 id="备份-ext2-3-4-文件系统"><a href="#备份-ext2-3-4-文件系统" class="headerlink" title="备份 ext2/3/4 文件系统"></a>备份 ext2/3/4 文件系统</h2><p><strong>备份 ext2/3/4 **</strong>文件系统备份的一个例子**</p>
<ol>
<li>在尝试进行任何类型的恢复操作之前，必须备份所有数据。数据备份应该定期进行。除了数据之外，还有应该保存的配置信息，包括<code>/etc/fstab</code>和输出<code>fdisk -l</code>。运行sosreport/sysreport将会捕获这些信息，强烈推荐</li>
<li>.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/fstab</span></span><br><span class="line">LABEL=/            /               ext3    defaults        1 1</span><br><span class="line">LABEL=/boot1       /boot           ext3    defaults        1 2</span><br><span class="line">LABEL=/data        /data           ext3    defaults        0 0</span><br><span class="line">tmpfs              /dev/shm        tmpfs   defaults        0 0</span><br><span class="line">devpts             /dev/pts        devpts  gid=5,mode=620  0 0</span><br><span class="line">sysfs              /sys            sysfs   defaults        0 0</span><br><span class="line">proc               /proc           proc    defaults        0 0</span><br><span class="line">LABEL=SWAP-sda5    swap            swap    defaults        0 0</span><br><span class="line">/dev/sda6          /backup-files   ext3    defaults        0 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># fdisk -l</span></span><br><span class="line">   Device Boot    Start      End    Blocks      Id  System</span><br><span class="line">/dev/sda1 *           1       13    104391      83  Linux</span><br><span class="line">/dev/sda2            14      1925   15358140    83  Linux</span><br><span class="line">/dev/sda3          1926      3200   10241437+   83  Linux</span><br><span class="line">/dev/sda4          3201      4864   13366080    5   Extended</span><br><span class="line">/dev/sda5          3201      3391   1534176     82  Linux swap / Solaris</span><br><span class="line">/dev/sda6          3392      4864   11831841    83  Linux</span><br></pre></td></tr></table></figure>
<p>   在这个例子中，我们将使用<code>/dev/sda6</code>分区来保存备份文件，我们假设它<code>/dev/sda6</code>被挂载<code>/backup-files</code>.</p>
<ol>
<li>如果要备份的分区是操作系统分区，请将系统启动到单用户模式。正常的数据分区不需要这一步.</li>
<li>使用<code>dump</code>备份分区的内容:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dump -0uf /backup-files/sda1.dump /dev/sda1</span></span><br><span class="line"><span class="comment"># dump -0uf /backup-files/sda2.dump /dev/sda2</span></span><br><span class="line"><span class="comment"># dump -0uf /backup-files/sda3.dump /dev/sda3</span></span><br></pre></td></tr></table></figure>
<p>   <strong>注意</strong></p>
<p>   如果系统已经运行了很长时间，建议<code>e2fsck</code>在备份之前在分区上运行.</p>
<p>   <strong>重要</strong></p>
<p>   备份操作系统分区时，必须卸载该分区。</p>
<p>尽管挂载时可以备份普通数据分区，但建议尽可能将其卸载。尝试备份安装的数据分区的结果可能是不可预知的。</p>
<p>如果您需要备份使用的挂载文件系统<code>dump</code>，请在文件系统不负载较重的情况下进行备份。备份时文件系统上发生的活动越多，备份损坏的风险就越高。</p>
<p>   如果你想做远程备份，你可以同时使用ssh或者配置非密码登录:</p>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dump -0u -f - /dev/sda1 | ssh root@remoteserver.example.com dd of=/tmp/sda1.dump</span></span><br></pre></td></tr></table></figure>
<p>   <strong>注意</strong></p>
<p>   如果使用标准重定向，该<code>-f</code>选项必须单独传递。</p>
<h2 id="恢复ext2-3-4-文件系统"><a href="#恢复ext2-3-4-文件系统" class="headerlink" title="恢复ext2/3/4 文件系统"></a>恢复ext2/3/4 文件系统</h2><p><strong> ext2/3/4 </strong>文件系统恢复示例<em>**</em></p>
<ol>
<li><p>如果您要还原操作系统分区，请将系统引导至Rescue Mode（救援模式）。普通数据分区不需要这一步。</p>
</li>
<li><p>使用  <code>fdisk</code> 命令重建sda1/sda2/sda3/sda4/sda5 by using the.</p>
<p><strong>注意</strong></p>
<p>如有必要，创建分区以包含还原的文件系统。新的分区必须足够大以包含还原的数据。开始和结束数字是正确的。这些是分区的起始和结束扇区号。</p>
</li>
<li><p>使用 <code>mkfs</code> 命令, 格式化目标分区，如下所示.</p>
<p><strong>重要</strong></p>
<p>不要格式化 <code>/dev/sda6</code>  因为它保存了备份文件.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkfs.ext3 /dev/sda1</span></span><br><span class="line"><span class="comment"># mkfs.ext3 /dev/sda2</span></span><br><span class="line"><span class="comment"># mkfs.ext3 /dev/sda3</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果创建新的分区，重新标记所有分区，以便它们匹配 <code>fstab</code>文件. 如果没有重新创建分区，则不需要执行此步骤.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># e2label /dev/sda1 /boot1</span></span><br><span class="line"><span class="comment"># e2label /dev/sda2 /</span></span><br><span class="line"><span class="comment"># e2label /dev/sda3 /data</span></span><br><span class="line"><span class="comment"># mkswap -L SWAP-sda5 /dev/sda5</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>准备工作目录.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkdir /mnt/sda1</span></span><br><span class="line"><span class="comment"># mount -t ext3 /dev/sda1 /mnt/sda1</span></span><br><span class="line"><span class="comment"># mkdir /mnt/sda2</span></span><br><span class="line"><span class="comment"># mount -t ext3 /dev/sda2 /mnt/sda2</span></span><br><span class="line"><span class="comment"># mkdir /mnt/sda3</span></span><br><span class="line"><span class="comment"># mount -t ext3 /dev/sda3 /mnt/sda3</span></span><br><span class="line"><span class="comment"># mkdir /backup-files</span></span><br><span class="line"><span class="comment"># mount -t ext3 /dev/sda6 /backup-files</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>恢复数据.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /mnt/sda1</span></span><br><span class="line"><span class="comment"># restore -rf /backup-files/sda1.dump</span></span><br><span class="line"><span class="comment"># cd /mnt/sda2</span></span><br><span class="line"><span class="comment"># restore -rf /backup-files/sda2.dump</span></span><br><span class="line"><span class="comment"># cd /mnt/sda3</span></span><br><span class="line"><span class="comment"># restore -rf /backup-files/sda3.dump</span></span><br></pre></td></tr></table></figure>
<p>如果要从远程主机进行还原或从远程主机上的备份文件进行还原，则可以使用ssh或rsh。您将需要为以下示例配置无密码登录:</p>
<p>登录到10.0.0.87，并从本地sda1.dump文件恢复sda1:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ssh 10.0.0.87 "cd /mnt/sda1 &amp;&amp; cat /backup-files/sda1.dump | restore -rf -"</span></span><br></pre></td></tr></table></figure>
<p>登录到10.0.0.87，并从远程10.66.0.124 sda1.dump文件恢复sda1:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ssh 10.0.0.87 "cd /mnt/sda1 &amp;&amp; RSH=/usr/bin/ssh restore -r -f 10.66.0.124:/tmp/sda1.dump"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Reboot.</p>
</li>
</ol>
<h2 id="其他EXT4文件系统工具"><a href="#其他EXT4文件系统工具" class="headerlink" title="其他EXT4文件系统工具"></a>其他EXT4文件系统工具</h2><p>红帽企业版Linux 7还提供了用于管理ext4文件系统的其他实用程序:</p>
<ul>
<li><p>e2fsck</p>
<p>用于修复ext4文件系统。这个工具比ext3更有效地检查和修复ext4文件系统，这要归功于ext4磁盘结构的更新.</p>
</li>
<li><p>e2label</p>
<p>更改ext4文件系统上的标签。这个工具也适用于ext2和ext3文件系统.</p>
</li>
<li><p>quota</p>
<p>控制和报告ext4文件系统上用户和组的磁盘空间（块）和文件（inode）使用情况.</p>
</li>
<li><p>fsfreeze</p>
<p>要暂停对文件系统的访问，请使用该命令将其冻结并解冻。这会暂停对文件系统的访问，并在磁盘上创建一个稳定的映像。 <code># fsfreeze -f *mount-point*``# fsfreeze -u *mount-point*</code>.</p>
<p>​</p>
</li>
</ul>
<p>该<code>tune2fs</code>实用程序还可以调整ext2，ext3和ext4文件系统的可配置文件系统参数。另外，以下工具在调试和分析ext4文件系统时也很有用：:</p>
<ul>
<li><p>debugfs</p>
<p>调试ext2，ext3或ext4文件系统.</p>
</li>
<li><p>e2image</p>
<p>调试ext2，ext3或ext4文件系统.</p>
</li>
</ul>
<p>有关这些实用程序的更多信息，请参阅各自的<code>man</code>页面.</p>
<h1 id="BTRFS（技术预览）"><a href="#BTRFS（技术预览）" class="headerlink" title="BTRFS（技术预览）"></a>BTRFS（技术预览）</h1><p><strong>注意</strong></p>
<p>Btrfs在红帽企业版Linux 7中作为技术预览功能提供，但自从红帽企业版Linux 7.4发行版以来已经被弃用了。它将在未来的红帽企业Linux主要版本中被删除.</p>
<p>Btrfs是下一代Linux文件系统，提供先进的管理，可靠性和可扩展性功能。它在提供快照，压缩和集成设备管理方面是独一无二的。</p>
<h2 id="创建一个btrfs文件系统"><a href="#创建一个btrfs文件系统" class="headerlink" title="创建一个btrfs文件系统"></a>创建一个btrfs文件系统</h2><p>为了建立一个基本的btrfs文件系统，使用下面的命令:</p>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkfs.btrfs /dev/device</span></span><br></pre></td></tr></table></figure>
<h2 id="挂载一个BTRFS文件系统"><a href="#挂载一个BTRFS文件系统" class="headerlink" title="挂载一个BTRFS文件系统"></a>挂载一个BTRFS文件系统</h2><p>要在btrfs文件系统中安装任何设备，请使用以下命令:</p>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount /dev/device /mount-point</span></span><br></pre></td></tr></table></figure>
<p>其他有用的安装选项包括:</p>
<ul>
<li><p>device=/<em>dev</em>/<em>name</em></p>
<p>将此选项附加到mount命令会告诉btrfs为指定的设备扫描btrfs卷。这用于确保挂载将成功，因为尝试挂载不是btrfs的设备将导致挂载失败。</p>
</li>
<li><p>max_inline=<em>number</em></p>
<p>使用此选项可设置可用于在元数据B树叶中内联数据的最大空间量（以字节为单位）。默认是8192字节。对于4k页面，由于需要适合叶子的附加头文件，它被限制为3900字节</p>
</li>
<li><p>alloc_start=<em>number</em></p>
<p>使用此选项可以设置磁盘分配的起始位置。</p>
</li>
<li><p>thread_pool=<em>number</em></p>
<p>使用此选项分配分配的工作线程数。</p>
</li>
<li><p>discard</p>
<p>使用此选项可以释放释放块上的TRIM。</p>
</li>
<li><p>noacl</p>
<p>使用此选项禁用ACL的使用。</p>
</li>
<li><p>space_cache</p>
<p>使用此选项将可用空间数据存储在磁盘上，以便更快地缓存块组。这是一个持久的变化，可以安全地引导到旧的内核。</p>
</li>
<li><p>nospace_cache</p>
<p>使用此选项可禁用上述功能<code>space_cache</code>。</p>
</li>
<li><p>clear_cache</p>
<p>在安装过程中使用此选项清除所有可用空间缓存。这是一个安全的选项，但会触发空间缓存重建。因此，请保持文件系统安装，以便重建过程完成。此安装选项旨在仅在问题出现在可用空间后才能使用。</p>
</li>
<li><p>enospc_debug</p>
<p>这个选项用于调试“没有剩余空间”的问题。</p>
</li>
<li><p>recovery</p>
<p>使用此选项可以在安装时启用自动恢复。</p>
</li>
</ul>
<h2 id="调整BTRFS文件系统的大小"><a href="#调整BTRFS文件系统的大小" class="headerlink" title="调整BTRFS文件系统的大小"></a>调整BTRFS文件系统的大小</h2><p>无法调整btrfs文件系统的大小，但可以调整其使用的每个设备的大小。如果只有一个设备正在使用，那么这与调整文件系统的大小相同。如果有多个设备正在使用，则必须手动调整大小以达到预期的效果。</p>
<p><strong>注意</strong></p>
<p>单位大小不是特定的情况; 它接受两者<code>G</code>或<code>g</code>GiB。</p>
<p>该命令不接受<code>t</code>千兆字节或千兆<code>p</code>字节。它只接受<code>k</code>，<code>m</code>和<code>g</code>。</p>
<h2 id="扩大btrfs文件系统"><a href="#扩大btrfs文件系统" class="headerlink" title="扩大btrfs文件系统"></a>扩大btrfs文件系统</h2><p>To enlarge the file system on a single device, use the command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem resize amount /mount-point</span></span><br></pre></td></tr></table></figure>
<p>For example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem resize +200M /btrfssingle</span></span><br><span class="line">Resize <span class="string">'/btrfssingle'</span> of <span class="string">'+200M'</span></span><br></pre></td></tr></table></figure>
<p>要放大多设备文件系统，必须指定要放大的设备。首先，显示具有指定挂载点的btrfs文件系统的所有设备：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem show /mount-point</span></span><br></pre></td></tr></table></figure>
<p>For example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem show /btrfstest</span></span><br><span class="line">Label: none  uuid: 755b41b7-7a20-4a24-abb3-45fdbed1ab39</span><br><span class="line">	Total devices 4 FS bytes used 192.00KiB</span><br><span class="line">	devid    1 size 1.00GiB used 224.75MiB path /dev/vdc</span><br><span class="line">	devid    2 size 524.00MiB used 204.75MiB path /dev/vdd</span><br><span class="line">	devid    3 size 1.00GiB used 8.00MiB path /dev/vde</span><br><span class="line">	devid    4 size 1.00GiB used 8.00MiB path /dev/vdf</span><br><span class="line"></span><br><span class="line">Btrfs v3.16.2</span><br></pre></td></tr></table></figure>
<p>然后，在识别<code>devid</code>要放大的设备之后，使用以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem resize devid:amount /mount-point</span></span><br></pre></td></tr></table></figure>
<p>For example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem resize 2:+200M /btrfstest</span></span><br><span class="line">Resize <span class="string">'/btrfstest/'</span> of <span class="string">'2:+200M'</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong></p>
<p> <em>amount</em> 也可以是 <code>max</code> 代替特定量。这将使用设备上剩余的所有空间。</p>
<h2 id="缩小btrfs文件系统"><a href="#缩小btrfs文件系统" class="headerlink" title="缩小btrfs文件系统"></a>缩小btrfs文件系统</h2><p>要在单个设备上缩小文件系统，请使用以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem resize amount /mount-point</span></span><br></pre></td></tr></table></figure>
<p>For example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem resize -200M /btrfssingle</span></span><br><span class="line">Resize <span class="string">'/btrfssingle'</span> of <span class="string">'-200M'</span></span><br></pre></td></tr></table></figure>
<p>要缩小多设备文件系统，必须指定要收缩的设备。首先，显示具有指定挂载点的btrfs文件系统的所有设备：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem show /mount-point</span></span><br></pre></td></tr></table></figure>
<p>For example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem show /btrfstest</span></span><br><span class="line">Label: none  uuid: 755b41b7-7a20-4a24-abb3-45fdbed1ab39</span><br><span class="line">	Total devices 4 FS bytes used 192.00KiB</span><br><span class="line">	devid    1 size 1.00GiB used 224.75MiB path /dev/vdc</span><br><span class="line">	devid    2 size 524.00MiB used 204.75MiB path /dev/vdd</span><br><span class="line">	devid    3 size 1.00GiB used 8.00MiB path /dev/vde</span><br><span class="line">	devid    4 size 1.00GiB used 8.00MiB path /dev/vdf</span><br><span class="line"></span><br><span class="line">Btrfs v3.16.2</span><br></pre></td></tr></table></figure>
<p>然后，在识别<code>devid</code>要缩小的设备之后，使用以下命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem resize devid:amount /mount-point</span></span><br></pre></td></tr></table></figure>
<p>For example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem resize 2:-200M /btrfstest</span></span><br><span class="line">Resize <span class="string">'/btrfstest'</span> of <span class="string">'2:-200M'</span></span><br></pre></td></tr></table></figure>
<h2 id="设置文件系统大小"><a href="#设置文件系统大小" class="headerlink" title="设置文件系统大小"></a>设置文件系统大小</h2><p>要在单个设备上将文件系统设置为特定大小，请使用以下命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem resize amount /mount-point</span></span><br></pre></td></tr></table></figure>
<p>For example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem resize 700M /btrfssingle</span></span><br><span class="line">Resize <span class="string">'/btrfssingle'</span> of <span class="string">'700M'</span></span><br></pre></td></tr></table></figure>
<p>要设置多设备文件系统的文件系统大小，必须指定要更改的设备。首先，显示在指定的挂载点上具有btrfs文件系统的所有设备</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem show /mount-point</span></span><br></pre></td></tr></table></figure>
<p>For example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem show /btrfstest</span></span><br><span class="line">Label: none  uuid: 755b41b7-7a20-4a24-abb3-45fdbed1ab39</span><br><span class="line">	Total devices 4 FS bytes used 192.00KiB</span><br><span class="line">	devid    1 size 1.00GiB used 224.75MiB path /dev/vdc</span><br><span class="line">	devid    2 size 724.00MiB used 204.75MiB path /dev/vdd</span><br><span class="line">	devid    3 size 1.00GiB used 8.00MiB path /dev/vde</span><br><span class="line">	devid    4 size 1.00GiB used 8.00MiB path /dev/vdf</span><br><span class="line"></span><br><span class="line">Btrfs v3.16.2</span><br></pre></td></tr></table></figure>
<p>然后，在识别出<code>devid</code>要更改的设备后，使用以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem resize devid:amount /mount-point</span></span><br></pre></td></tr></table></figure>
<p>For example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem resize 2:300M /btrfstest</span></span><br><span class="line">Resize <span class="string">'/btrfstest'</span> of <span class="string">'2:300M'</span></span><br></pre></td></tr></table></figure>
<h2 id="多个设备的集成卷管理"><a href="#多个设备的集成卷管理" class="headerlink" title="多个设备的集成卷管理"></a>多个设备的集成卷管理</h2><p>可以在许多设备上创建btrfs文件系统，在创建文件系统之后可以添加更多的设备。默认情况下，元数据将在两台设备之间镜像，数据将在所有设备上进行分条，但是如果只有一台设备，元数据将在该设备上复制。</p>
<h2 id="使用多个设备创建文件系统"><a href="#使用多个设备创建文件系统" class="headerlink" title="使用多个设备创建文件系统"></a>使用多个设备创建文件系统</h2><p>The <code>mkfs.btrfs</code> 命令接受数据选项和元数据选项。有效的规格是： <code>-d</code> for data, and <code>-m</code> for metadata. 有效的规格是:</p>
<ul>
<li><code>raid0</code></li>
<li><code>raid1</code></li>
<li><code>raid10</code></li>
<li><code>dup</code></li>
<li><code>single</code></li>
</ul>
<p>该<code>-m single</code>选项指示不会重复元数据。这在使用硬件RAID时可能是需要的。</p>
<p><strong>注意</strong></p>
<p>RAID 10至少需要四台设备才能正常运行。</p>
<p><strong>创建一个RAID 10 btrfs文件系统</strong></p>
<p>在四个设备上创建一个文件系统（元数据镜像，数据条带化）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkfs.btrfs /dev/device1 /dev/device2 /dev/device3 /dev/device4</span></span><br></pre></td></tr></table></figure>
<p>在不镜像的情况下分割元数据。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkfs.btrfs -m raid0 /dev/device1 /dev/device2</span></span><br></pre></td></tr></table></figure>
<p>将raid10用于数据和元数据。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkfs.btrfs -m raid10 -d raid10 /dev/device1 /dev/device2 /dev/device3 /dev/device4</span></span><br></pre></td></tr></table></figure>
<p>不要在单个驱动器上复制元数据。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkfs.btrfs -m single /dev/device</span></span><br></pre></td></tr></table></figure>
<p><code>single</code>当驱动器大小不同时， 使用该选项可以使用每个驱动器的全部容量。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkfs.btrfs -d single /dev/device1 /dev/device2 /dev/device3</span></span><br></pre></td></tr></table></figure>
<p>要将新设备添加到已创建的多设备文件系统，请使用以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs device add /dev/device1 /mount-point</span></span><br></pre></td></tr></table></figure>
<p>在重新启动或重新加载btrfs模块之后，使用该<code>btrfs device scan</code>命令来发现所有多设备文件系统。</p>
<h3 id="扫描btrfs设备"><a href="#扫描btrfs设备" class="headerlink" title="扫描btrfs设备"></a>扫描btrfs设备</h3><p>使用<code>btrfs device scan</code>扫描下的所有块设备<code>/dev</code>和探测BTRFS卷。如果使用文件系统中的多个设备运行，则必须在加载btrfs模块后执行此操作。</p>
<p>要扫描所有设备，请使用以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs device scan</span></span><br></pre></td></tr></table></figure>
<p>要扫描单个设备，请使用以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs device scan /dev/device</span></span><br></pre></td></tr></table></figure>
<h3 id="将新设备添加到btrfs文件系统"><a href="#将新设备添加到btrfs文件系统" class="headerlink" title="将新设备添加到btrfs文件系统"></a>将新设备添加到btrfs文件系统</h3><p>使用该<code>btrfs filesystem show</code>命令列出所有btrfs文件系统以及它们包含的设备。</p>
<p>该<code>btrfs device add</code>命令用于将新设备添加到已安装的文件系统。</p>
<p>该<code>btrfs filesystem balance</code>命令在所有现有设备之间平衡（重新分配）分配的盘区。</p>
<p>所有这些命令一起添加新设备的示例如下：</p>
<p><strong>添加新设备到btrfs文件系统</strong></p>
<p>首先，创建并挂载一个btrfs文件系统。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkfs.btrfs /dev/device1</span></span><br><span class="line"><span class="comment"># mount /dev/device1</span></span><br></pre></td></tr></table></figure>
<p>接下来，将第二个设备添加到已安装的btrfs文件系统。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># btrfs device add &#x2F;dev&#x2F;device2 &#x2F;mount-point</span><br></pre></td></tr></table></figure>
<p>这些设备上的元数据和数据仍然只存储在 <code>/dev/*device1*</code>. 现在必须平衡分布在所有设备上。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem balance /mount-point</span></span><br></pre></td></tr></table></figure>
<p>平衡文件系统需要一些时间，因为它读取文件系统的所有数据和元数据，并在新设备上重写。</p>
<h3 id="转换一个btrfs文件系统"><a href="#转换一个btrfs文件系统" class="headerlink" title="转换一个btrfs文件系统"></a>转换一个btrfs文件系统</h3><p>要将非raid文件系统转换为raid，请添加设备并运行更改块分配配置文件的平衡过滤器。</p>
<p><strong>转换一个btrfs文件系统</strong></p>
<p>要将现有的单个设备系统（<code>/dev/sdb1</code>在这种情况下）转换为两个设备raid1系统以防止单个磁盘发生故障，请使用以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount /dev/sdb1 /mnt</span></span><br><span class="line"><span class="comment"># btrfs device add /dev/sdc1 /mnt</span></span><br><span class="line"><span class="comment"># btrfs balance start -dconvert=raid1 -mconvert=raid1 /mnt</span></span><br></pre></td></tr></table></figure>
<p><strong>重要</strong></p>
<p>如果元数据未从单一设备默认转换，则保持为DUP。这并不保证块的副本位于不同的设备上。如果数据未被转换，则根本没有任何多余的副本。</p>
<h4 id="删除btrfs设备"><a href="#删除btrfs设备" class="headerlink" title="删除btrfs设备"></a>删除btrfs设备</h4><p>使用该<code>btrfs device delete</code>命令删除在线设备。它将任何正在使用的扩展区重新分配给文件系统中的其他设备，以便安全地删除。</p>
<p><strong>删除btrfs文件系统上的设备</strong></p>
<p>首先创建并安装几个btrfs文件系统。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkfs.btrfs /dev/sdb /dev/sdc /dev/sdd /dev/sde</span></span><br><span class="line"><span class="comment"># mount /dev/sdb /mnt</span></span><br></pre></td></tr></table></figure>
<p>将一些数据添加到文件系统。</p>
<p>最后，移除所需的设备。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs device delete /dev/sdc /mnt</span></span><br></pre></td></tr></table></figure>
<h4 id="替换btrfs文件系统上的失败设备"><a href="#替换btrfs文件系统上的失败设备" class="headerlink" title="替换btrfs文件系统上的失败设备"></a>替换btrfs文件系统上的失败设备</h4><p>如果仍然可以读取超级块，则可以删除brtfs设备呢哦来删除发生故障的设备。但是，如果设备丢失或超级块损坏，文件系统将需要以降级模式进行挂载：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkfs.btrfs -m raid1 /dev/sdb /dev/sdc /dev/sdd /dev/sde</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  ssd is destroyed or removed, use -o degraded to force the mount</span><br><span class="line">  to ignore missing devices</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># mount -o degraded /dev/sdb /mnt</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="string">'missing'</span> is a special device name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># btrfs device delete missing /mnt</span></span><br></pre></td></tr></table></figure>
<p>该命令<code>btrfs device delete missing</code>将删除由文件系统元数据描述的第一个设备，但在装入文件系统时不会显示该设备。</p>
<p><strong>重要</strong></p>
<ol>
<li><p>这是不可能的，低于特定raid布局所需的最低设备数量，甚至包括缺少的设备。可能需要添加新设备才能删除失败的设备。</p>
<p>例如，对于具有两个设备的raid1布局，如果设备出现故障，则需要：</p>
<ol>
<li>以降级模式挂载，</li>
<li>添加一个新的设备，</li>
<li>并删除丢失的设备。</li>
</ol>
</li>
</ol>
<h3 id="在-etc-fstab文件中注册一个btrfs文件系统"><a href="#在-etc-fstab文件中注册一个btrfs文件系统" class="headerlink" title="在 /etc/fstab文件中注册一个btrfs文件系统"></a>在 <code>/etc/fstab</code>文件中注册一个btrfs文件系统</h3><p>如果您没有安装<code>initrd</code>或不执行btrfs设备扫描，则可以<code>btrfs</code>通过将文件系统中的所有设备明确传递到<code>mount</code>命令来安装多卷文件系统。</p>
<p><strong> /etc/fstab 条目</strong></p>
<p>一个合适的<code>/etc/fstab</code>条目的例子是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;dev&#x2F;sdb    &#x2F;mnt    btrfs    device&#x3D;&#x2F;dev&#x2F;sdb,device&#x3D;&#x2F;dev&#x2F;sdc,device&#x3D;&#x2F;dev&#x2F;sdd,device&#x3D;&#x2F;dev&#x2F;sde    0</span><br></pre></td></tr></table></figure>
<p>请注意，使用通用唯一标识符（UUID）也可以工作，并且比使用设备路径更稳定。</p>
<h2 id="SSD优化"><a href="#SSD优化" class="headerlink" title="SSD优化"></a>SSD优化</h2><p>使用btrfs文件系统可以优化SSD。有两种方法可以完成。</p>
<p>第一种方法是当单个指定设备的 <code>/sys/block/*device*/queue/rotational</code>为零时， <code>mkfs.btrfs</code> 在单个设备上关闭元数据复制。 这相当于在命令行上指定<code>-m single</code>。 可以通过提供<code>-m dup</code>选项来覆盖它并复制元数据。 由于SSD固件可能会丢失两个副本，所以不需要复制。 这浪费空间并且是性能成本。</p>
<p>第二种方式是通过一组SSD挂载选项: <code>ssd</code>, <code>nossd</code>, and <code>ssd_spread</code>.</p>
<p> <code>ssd</code> 选项有几个作用:</p>
<ul>
<li>它允许更大的元数据集群分配。</li>
<li>它尽可能按顺序分配数据。</li>
<li>它禁用btree叶重写匹配键和块顺序。</li>
<li>它提交日志片段而不分批处理多个进程。</li>
</ul>
<p><strong>注意</strong></p>
<p>在<code>ssd</code>安装选项不但可以让SSD选项。使用该<code>nossd</code>选项来禁用它。</p>
<p>一些固态硬盘在经常重复使用块编号时性能最好，而另一些则在聚类严格分配大量未使用空间时性能更好。默认情况下，<code>mount -o ssd</code>将查找有多个空闲块的块的分组，这些空闲块可能已经分配了混合块。该命令<code>mount -o ssd_spread</code>确保没有混合分配的块。这样可以提高低端SSD的性能。</p>
<p><strong>注意</strong></p>
<p>该<code>ssd_spread</code>选项启用<code>ssd</code>和<code>ssd_spread</code>选项。使用<code>nossd</code>来禁用这两个选项。</p>
<p><code>ssd_spread</code>如果没有提供任何ssd选项并且任何设备不旋转，则 该选项永远不会自动设置。</p>
<p>这些选项都需要使用特定的版本进行测试，以查看它们的使用是否改善或降低了性能，因为SSD固件和应用程序负载的每个组合都不相同。</p>
<h2 id="BTRFS参考"><a href="#BTRFS参考" class="headerlink" title="BTRFS参考"></a>BTRFS参考</h2><p>手册页<code>btrfs(8)</code>涵盖了所有重要的管理命令。具体包括：</p>
<ul>
<li>所有用于管理快照的子卷命令。</li>
<li><code>device</code>管理设备 的命令。</li>
<li>的<code>scrub</code>，<code>balance</code>和<code>defragment</code>命令。</li>
</ul>
<p>手册页<code>mkfs.btrfs(8)</code>包含有关创建btrfs文件系统的信息，包括与之相关的所有选项。</p>
<p><code>btrfsck(8)</code>有关<code>fsck</code>btrfs系统信息 的手册页。</p>
<h1 id="GFS2"><a href="#GFS2" class="headerlink" title="GFS2"></a>GFS2</h1><p>GFS2 是直接与Linux内核文件系统接口（VFS层）接口的本地文件系统。作为集群文件系统实施时，GFS2采用分布式元数据和多个日志。</p>
<p>GFS2基于64位体系结构，理论上可以容纳8字节的文件系统。但是，当前支持的最大GFS2文件系统大小为100 TB。如果系统要求GFS2文件系统大于100 TB，请联系您的红帽服务代表。</p>
<p>在确定文件系统的大小时，请考虑其恢复需求。<code>fsck</code>在非常大的文件系统上运行该命令可能需要很长时间并消耗大量的内存。此外，如果发生磁盘或磁盘子系统故障，恢复时间受限于备份介质的速度。</p>
<p>在Red Hat Cluster Suite中进行配置时，可以使用Red Hat Cluster Suite配置和管理工具来配置和管理Red Hat GFS2节点。然后，红帽GFS2在红帽集群中的GFS2节点之间提供数据共享，并在GFS2节点之间提供一个统一的文件系统名称空间视图。这允许不同节点上的进程以相同的方式共享GFS2文件，即同一节点上的进程可以共享本地文件系统上的文件，而不会有明显的差异。有关红帽群集套件的信息，请参阅“红帽<em>群集管理</em>指南”。</p>
<p>GFS2必须构建在线性或镜像卷的逻辑卷（使用LVM创建）上。使用LVM在Red Hat集群套件中创建的逻辑卷由CLVM守护进程启用<code>clvmd</code>并在Red Hat Cluster Suite集群中运行的CLVM（集群范围的LVM实现）进行管理。守护进程可以使用LVM2来管理集群中的逻辑卷，从而允许集群中的所有节点共享逻辑卷。</p>
<p>该<code>gfs2.ko</code>内核模块实现了GFS2文件系统，并装载在GFS2集群节点。</p>
<h1 id="网络文件系统（NFS）"><a href="#网络文件系统（NFS）" class="headerlink" title="网络文件系统（NFS）"></a>网络文件系统（NFS）</h1><p>一个<em>网络文件系统</em>（<em>NFS</em>）允许远程主机通过网络挂载文件系统并与那些文件系统，就好像它们是本地安装的互动。这使得系统管理员可以将资源整合到网络上的中央服务器上。</p>
<p>本章重点介绍NFS的基本概念和补充信息。</p>
<h2 id="NFS简介"><a href="#NFS简介" class="headerlink" title="NFS简介"></a>NFS简介</h2><p>目前，Red Hat Enterprise Linux中包含两个主要的NFS版本。NFS版本3（NFSv3）支持安全异步写入，并且在错误处理方面比以前的NFSv2更强大; 它还支持64位文件大小和偏移量，允许客户端访问超过2 GB的文件数据。NFSv4通过防火墙和Internet工作，不再需要<code>rpcbind</code>服务，支持ACL并利用有状态的操作。</p>
<p>红帽企业版Linux 7增加了对NFS版本4.1（NFSv4.1）的支持，该版本提供了许多性能和安全增强功能，包括对并行NFS（pNFS）的客户端支持。NFSv4.1不再需要单独的TCP连接进行回调，即使无法联系客户端（例如，当NAT或防火墙干扰），也允许NFS服务器授予委派。此外，NFSv4.1现在提供了真正的一次语义（重启操作除外），防止了以前的问题，即如果回复丢失并且操作被发送了两次，某些操作可能返回不准确的结果。</p>
<p>红帽企业版Linux 7支持NFSv3，NFSv4.0和NVSv4.1客户端。NFS客户端默认尝试使用NFSv4.0进行挂载，如果挂载操作不成功，NFS客户端将回退到NFSv3。</p>
<p><strong>注意</strong></p>
<p>Red Hat不再支持NFS版本2（NFSv2）。</p>
<p>NFS的所有版本都可以使用通过IP网络运行的<em>传输控制协议</em>（<em>TCP</em>），而NFSv4则需要它。NFSv3可以使用通过IP网络运行的<em>用户数据报协议</em>（UDP）来提供客户端和服务器之间的无状态网络连接。</p>
<p>在UDP中使用NFSv3时，无状态UDP连接（正常情况下）的协议开销比TCP少。这可以转化为非常干净，非拥塞的网络上更好的性能。但是，因为UDP是无状态的，所以如果服务器意外关闭，那么UDP客户端继续使用服务器的请求来饱和网络。另外，当使用UDP丢失一个帧时，整个RPC请求必须被重新传输。与TCP，只有丢失的帧需要重新发送。由于这些原因，在连接到NFS服务器时，TCP是首选协议。</p>
<p>安装和锁定协议已被纳入NFSv4协议。服务器也监听众所周知的TCP端口2049这样上，NFSv4的不需要与之交互<code>rpcbind</code> ，<code>lockd</code>和<code>rpc.statd</code>守护程序。该<code>rpc.mountd</code>守护程序仍需要在NFS服务器上设置了出口，但不参与任何过度的线操作。</p>
<p><strong>注意</strong></p>
<p>TCP是红帽企业版Linux下NFS版本3的默认传输协议。可以根据需要将UDP用于兼容目的，但不建议将其用于广泛的用途。NFSv4需要TCP。</p>
<p>所有RPC / NFS守护进程都有一个<code>&#39;-p&#39;</code>可以设置端口的命令行选项，使得防火墙配置更容易。</p>
<p>在TCP封装器授予对客户端的访问权后，NFS服务器引用<code>/etc/exports</code>配置文件以确定是否允许客户端访问任何导出的文件系统。一旦验证完成，所有的文件和目录操作都可供用户使用。</p>
<p><strong>重要</strong></p>
<p>为了让NFS在启用了防火墙的情况下使用Red Hat Enterprise Linux的默认安装，请使用默认的TCP端口2049配置IPTables。如果没有正确的IPTables配置，NFS将无法正常运行。</p>
<p>NFS初始化脚本和<code>rpc.nfsd</code>进程现在允许在系统启动期间绑定到任何指定的端口。但是，如果端口不可用，或者与另一个守护进程发生冲突，则可能会出现错误。</p>
<h3 id="必需的服务"><a href="#必需的服务" class="headerlink" title="必需的服务"></a>必需的服务</h3><p>红帽企业Linux使用内核级支持和守护进程的组合来提供NFS文件共享。所有NFS版本都依赖于客户端和服务器之间的<em>远程过程调用</em>（<em>RPC</em>）。Red Hat Enterprise Linux 7下的RPC服务由<code>rpcbind</code>服务控制。要共享或安装NFS文件系统，下列服务可以协同工作，具体取决于实施的NFS版本：</p>
<p><strong>注意</strong></p>
<p>该<code>portmap</code>服务用于在早期版本的红帽企业版Linux中将RPC程序编号映射到IP地址端口号组合。<code>rpcbind</code>红帽企业版Linux 7 现在取代了这项服务，以支持IPv6。</p>
<ul>
<li><p>NFS</p>
<p><code>systemctl start nfs</code> 启动NFS服务器和相应的RPC进程来处理共享NFS文件系统的请求。</p>
</li>
<li><p>nfslock</p>
<p><code>systemctl start nfs-lock</code> 激活一个强制服务，启动相应的RPC进程，允许NFS客户端锁定服务器上的文件。</p>
</li>
<li><p>RPCBIND</p>
<p><code>rpcbind</code>接受来自本地RPC服务的端口保留。这些端口然后可用（或通告），以便相应的远程RPC服务可以访问它们。<code>rpcbind</code>响应对RPC服务的请求，并建立到请求的RPC服务的连接。这不用于NFSv4。</p>
</li>
</ul>
<p>以下RPC过程便于NFS服务：</p>
<ul>
<li><p>rpc.mountd</p>
<p>NFS服务器使用此进程来处理<code>MOUNT</code>来自NFSv3客户端的请求。它检查所请求的NFS共享当前是否由NFS服务器导出，并允许客户端访问它。如果允许安装请求，则rpc.mountd服务器将回复一个<code>Success</code>状态，并将<code>File-Handle</code>此NFS共享提供给NFS客户端。</p>
</li>
<li><p>rpc.nfsd</p>
<p><code>rpc.nfsd</code>允许服务器通告的明确的NFS版本和协议被定义。它与Linux内核一起工作，以满足NFS客户端的动态需求，例如每次NFS客户端连接时提供服务器线程。这个过程对应于<code>nfs</code>服务。</p>
</li>
<li><p>门锁配套</p>
<p><code>lockd</code>是在客户端和服务器上运行的内核线程。它实现了<em>网络锁管理器</em>（NLM）协议，它允许NFSv3客户端锁定服务器上的文件。无论何时运行NFS服务器以及挂载NFS文件系统，都会自动启动。</p>
</li>
<li><p>的rpc.statd</p>
<p>此过程实现了<em>网络状态监视器</em>（NSM）RPC协议，该协议在NFS服务器未正常关闭的情况下重新启动时通知NFS客户端。<code>rpc.statd</code>由<code>nfslock</code>服务自动启动，不需要用户配置。这不用于NFSv4。</p>
</li>
<li><p>rpc.rquotad</p>
<p>此过程为远程用户提供用户配额信息。<code>rpc.rquotad</code>由<code>nfs</code>服务自动启动，不需要用户配置。</p>
</li>
<li><p>rpc.idmapd</p>
<p><code>rpc.idmapd</code>提供NFSv4客户端和服务器上线，该上线在线上NFSv4名称（形式为字符串）与本地UID和GID 之间进行映射。为了与NFSv4一起运行，必须配置文件。至少应该指定“Domain”参数，它定义了NFSv4映射域。如果NFSv4映射域与DNS域名相同，则可以跳过此参数。客户端和服务器必须同意NFSv4映射域的ID映射才能正常工作。 <code>*user*@*domain*``idmapd``/etc/idmapd.conf</code><strong>注意</strong>在红帽企业版Linux 7中，只有NFSv4服务器使用<code>rpc.idmapd</code>。NFSv4客户端使用基于密钥环的idmapper <code>nfsidmap</code>。<code>nfsidmap</code>是由内核按需调用的执行ID映射的独立程序; 这不是一个守护进程。如果客户有问题，<code>nfsidmap</code>可以重新使用<code>rpc.idmapd</code>。有关的更多信息<code>nfsidmap</code>可以在nfsidmap手册页上找到。</p>
</li>
</ul>
<hr>
<h2 id="pNFS"><a href="#pNFS" class="headerlink" title="pNFS"></a>pNFS</h2><p>支持并行NFS（pNFS）作为NFS v4.1标准的一部分，自Red Hat Enterprise Linux 6.4起可用。pNFS体系结构提高了NFS的可扩展性，并可能提高性能。也就是说，当服务器也实现pNFS时，客户端可以同时通过多个服务器访问数据。它支持三种存储协议或布局：文件，对象和块。</p>
<p><strong>注意</strong></p>
<p>该协议允许三种可能的pNFS布局类型：文件，对象和块。虽然红帽企业Linux 6.4客户端只支持文件布局类型，红帽企业版Linux 7支持文件布局类型，对象和块布局类型作为技术预览。</p>
<p>要启用此功能，请在启用了pNFS的服务器上使用以下安装选项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-o v4.1</span><br></pre></td></tr></table></figure>
<p>服务器启用pNFS后，<code>nfs_layout_nfsv41_files</code>内核会自动加载到第一个安装位置。输出中的装载条目应该包含<code>minorversion=1</code>。使用以下命令验证模块是否已加载：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ lsmod | grep nfs_layout_nfsv41_files</span><br></pre></td></tr></table></figure>
<h2 id="配置NFS客户端"><a href="#配置NFS客户端" class="headerlink" title="配置NFS客户端"></a>配置NFS客户端</h2><p>该<code>mount</code>命令在客户端挂载NFS共享。其格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">＃ mount -t nfs -o options server:/remote/<span class="built_in">export</span> /<span class="built_in">local</span>/directory</span><br></pre></td></tr></table></figure>
<p>该命令使用以下变量：</p>
<ul>
<li><p><em>options</em></p>
<p>以逗号分隔的挂载选项列表</p>
</li>
<li><p><em>server</em></p>
<p>输出您希望装载的文件系统的服务器的主机名，IP地址或标准域名</p>
</li>
<li><p><em>/remote/export</em></p>
<p>从<em>服务器</em>中导出的文件系统或目录，即要安装的目录</p>
</li>
<li><p><em>/local/directory</em></p>
<p>其中客户端位置<em>/远程/出口</em>被安装</p>
</li>
</ul>
<p>红帽企业版Linux 7中使用的NFS协议版本由<code>mount</code>选项<code>nfsvers</code>或<code>vers</code>。默认情况下，<code>mount</code>将使用NFSv4 <code>mount -t nfs</code>。如果服务器不支持NFSv4，客户端将自动下载到服务器支持的版本。如果<code>nfsvers</code>/ <code>vers</code>选项用于传递服务器不支持的特定版本，则挂载将失败。由于传统原因，文件系统类型nfs4也是可用的; 这相当于跑步。<code>mount -t nfs -o nfsvers=4 *host*:*/remote/export**/local/directory*</code></p>
<p>更多细节参考<code>man mount</code>。</p>
<p>如果手动挂载NFS共享，那么在重新引导时，共享将不会自动挂载。红帽企业Linux提供了两种在启动时自动安装远程文件系统的方法：<code>/etc/fstab</code>文件和<code>autofs</code>服务.</p>
<h4 id="使用安装NFS文件系统-etc-fstab"><a href="#使用安装NFS文件系统-etc-fstab" class="headerlink" title="使用安装NFS文件系统/etc/fstab"></a>使用安装NFS文件系统<code>/etc/fstab</code></h4><p>从另一台机器上挂载NFS共享的另一种方法是在<code>/etc/fstab</code>文件中添加一行。该行必须声明NFS服务器的主机名，要导出的服务器上的目录，以及要装载NFS共享的本地计算机上的目录。您必须是root用户才能修改<code>/etc/fstab</code>文件。</p>
<p><strong>语法示例</strong></p>
<p><code>/etc/fstab</code>的一般语法如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server:/usr/<span class="built_in">local</span>/pub    /pub   nfs    defaults 0 0</span><br></pre></td></tr></table></figure>
<p><code>/pub</code>在执行此命令之前，客户机上必须存在 安装点。在<code>/etc/fstab</code>客户端系统上添加此行后，使用该命令<code>mount /pub</code>，并<code>/pub</code>从服务器挂载安装点。</p>
<p><code>/etc/fstab</code>挂载NFS导出的 有效条目应包含以下信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server:/remote/<span class="built_in">export</span> /<span class="built_in">local</span>/directory nfs options 0 0</span><br></pre></td></tr></table></figure>
<p>变量<em>server</em>，<em>/remote/export</em>，<em>/local/directory</em>和*options与手动挂载NFS共享时使用的是相同的</p>
<p><strong>Note</strong></p>
<p>在读取之前 ，挂载点  <em>/local/directory</em> 必须存在于客户端上<code>/etc/fstab</code>。否则，挂载将失败。</p>
<p>有关更多信息<code>/etc/fstab</code>，请参阅<code>man fstab</code>。</p>
<h2 id="autofs"><a href="#autofs" class="headerlink" title="autofs"></a><code>autofs</code></h2><p>使用的一个缺点<code>/etc/fstab</code>是，无论用户访问挂载的NFS文件系统的频率如何，系统都必须投入资源来保持挂载的文件系统。这对于一个或两个坐骑来说不是问题，但是当系统一次维护到多个系统时，整个系统的性能可能会受到影响。另一种方法<code>/etc/fstab</code>是使用基于内核的<code>automount</code>实用程序。自动挂载器由两部分组成：</p>
<ul>
<li>一个实现文件系统的内核模块</li>
<li>一个执行所有其他功能的用户空间守护进程。</li>
</ul>
<p>该<code>automount</code>实用程序可以自动安装和卸载NFS文件系统（按需安装），从而节省系统资源。它可以用来安装其他文件系统，包括AFS，SMBFS，CIFS和本地文件系统</p>
<p><strong>重要</strong></p>
<p>nfs-utils软件包现在是“NFS文件服务器”和“网络文件系统客户端”组的一部分。因此，默认情况下，基本组不会默认安装。确保在尝试自动挂载NFS共享之前，先在系统上安装nfs-utils。</p>
<p>autofs也是“网络文件系统客户端”组的一部分。</p>
<p><code>autofs</code>使用<code>/etc/auto.master</code>（主映射）作为其默认主配置文件。这可以更改为使用名称服务交换机制（NSS）机制中的<code>autofs</code>配置（in <code>/etc/sysconfig/autofs</code>）使用其他支持的网络源和名称。<code>autofs</code>针对主映射中配置的每个安装点运行版本4守护程序的实例，因此可以从命令行手动运行任何给定安装点。这是不可能的<code>autofs</code>版本5，因为它使用单个守护程序来管理所有配置的挂载点; 因此，必须在主映射中配置所有自动装载。这符合其他行业标准自动加载器的通常要求。挂载点，主机名，导出目录和选项都可以在一组文件（或其他支持的网络源）中指定，而不是为每个主机手动配置它们。</p>
<h4 id="autofs版本5比版本4改进"><a href="#autofs版本5比版本4改进" class="headerlink" title="autofs版本5比版本4改进"></a>autofs版本5比版本4改进</h4><p><code>autofs</code> 与版本4相比，版本5具有以下增强功能：</p>
<ul>
<li><p>直接映射支持</p>
<p>直接映射<code>autofs</code>提供了在文件系统层次结构中的任意点自动挂载文件系统的机制。直接映射由<code>/-</code>主映射中的挂载点表示。直接映射中的条目包含绝对路径名称作为键（而不是间接映射中使用的相对路径名）。</p>
<p>懒惰安装和卸载支持</p>
<p>多安装映射条目描述了单个密钥下的安装点层次结构。一个很好的例子就是<code>-hosts</code>地图，通常用于自动挂载主机下的所有导出，作为多装入映射条目。当使用地图，一个的将安装<em>的autofs</em>触发器安装用于从每个出口<em>主机</em>。这些会在访问时挂载和过期。这可以大大减少访问具有大量导出的服务器时所需的活动坐标的数量。<code>/net/*host*``-hosts``ls``/net/*host*</code><em>**</em></p>
<p>增强的LDAP支持</p>
<p>的<code>autofs</code>配置文件（<code>/etc/sysconfig/autofs</code>）提供了一种机制，以指定<code>autofs</code>一个站点执行的模式，从而排除，需要通过在应用程序本身试错法来确定这一点。另外，现在支持通过LDAP服务器认证的绑定，并使用通用LDAP服务器实现支持的大多数机制。为此支持添加了新的配置文件：<code>/etc/autofs_ldap_auth.conf</code>。默认配置文件是自我记录的，并使用XML格式。</p>
<p>正确使用名称服务Switch（<code>nsswitch</code>）配置。</p>
<p>名称服务交换机配置文件的存在是为了提供一种确定特定配置数据来自何处的方法。这种配置的原因是允许管理员灵活地使用所选择的后端数据库，同时保持统一的软件接口来访问数据。虽然版本4自动挂载机在处理NSS配置方面越来越好，但它仍然不完整。另一方面，Autofs版本5是一个完整的实现。</p>
<p>请参阅<code>man nsswitch.conf</code>此文件的支持语法的更多信息。并非所有的NSS数据库都是有效的地图源，解析器将会拒绝那些无效的地图源。合法来源的文件，<code>yp</code>，<code>nis</code>，<code>nisplus</code>，<code>ldap</code>，和<code>hesiod</code>。</p>
<p>每个autofs安装点有多个主映射条目</p>
<p>有一件经常使用但尚未提及的事情是处理直接安装点的多个主映射条目<code>/-</code>。每个条目的地图键合并，并作为一个映射。</p>
<p>​</p>
<p><strong>每个自动安装点的多个主映射条目</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/- /tmp/auto_dcthon</span><br><span class="line">/- /tmp/auto_test3_direct</span><br><span class="line">/- /tmp/auto_test4_direct</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
<h3 id="配置autofs"><a href="#配置autofs" class="headerlink" title="配置autofs"></a>配置autofs</h3><p>自动挂载程序的主要配置文件<code>/etc/auto.master</code>也称为主映射，主映射列出<code>autofs</code>了系统上的控制挂载点以及相应的配置文件或称为自动挂载映射的网络源。主图的格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount-point map-name options</span><br></pre></td></tr></table></figure>
<p>这种格式使用的变量是：</p>
<ul>
<li><p><em>mount-point</em></p>
<p>该<code>autofs</code>安装点，<code>/home</code>等。</p>
</li>
<li><p><em>map-name</em></p>
<p>包含挂载点列表的映射源的名称以及应该从中挂载这些挂载点的文件系统位置。地图条目的语法如下所述。</p>
</li>
<li><p><em>options</em></p>
<p>如果提供，这些将适用于给定的地图中的所有条目，只要它们本身没有指定的选项。此行为与<code>autofs</code>选项累积的版本4 不同。这已经被改变以实现混合的环境兼容性。</p>
</li>
</ul>
<p><strong>/etc/auto.master文件</strong></p>
<p>以下是来自<code>/etc/auto.master</code>文件（显示<code>cat /etc/auto.master</code>）的示例行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home /etc/auto.misc</span><br></pre></td></tr></table></figure>
<p>地图的一般格式类似于主地图，但是“选项”出现在装载点和位置之间，而不是在主地图的入口末尾：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount-point   [options]   location</span><br></pre></td></tr></table></figure>
<p>这种格式使用的变量是：</p>
<ul>
<li><p><em>mount-point</em></p>
<p>这是指<code>autofs</code>安装点。这可以是间接装入的单个目录名称，也可以是直接装入的装入点的完整路径。每个直接和间接映射条目键（<code>*mount-point*</code>上面）后面都可以跟一个以空格分隔的偏移目录列表（每个以“/”开头的子目录名称），使它们成为所谓的多装入条目。</p>
</li>
<li><p><em>options</em></p>
<p>无论何时提供，这些是没有指定自己的选项的地图项的装载选项。</p>
</li>
<li><p><em>location</em></p>
<p>这指的是文件系统位置，例如本地文件系统路径（以“/”开头的映射名称以太阳映射格式转义符“：”开头），NFS文件系统或其他有效的文件系统位置。</p>
</li>
</ul>
<p>以下是地图文件中的内容示例（例如<code>/etc/auto.misc</code>）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payroll -fstype=nfs personnel:/dev/hda3</span><br><span class="line">sales -fstype=ext3 :/dev/hda4</span><br></pre></td></tr></table></figure>
<p>映射文件中的第一列指示<code>autofs</code>安装点（<code>sales</code>并<code>payroll</code>从调用的服务器<code>personnel</code>）。第二列表示<code>autofs</code>安装选项，第三列表示安装源。按照上述配置，autofs挂载点会<code>/home/payroll</code>和<code>/home/sales</code>。该<code>-fstype=</code>选项通常被忽略，通常不需要正确的操作。</p>
<p>自动挂载程序将创建目录，如果它们不存在。如果目录在启动自动挂载程序之前存在，则自动挂载程序在退出时不会将其删除。您可以通过发出以下两个命令来启动或重新启动automount守护进程：</p>
<ul>
<li>如果自动挂载服务已停止：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl start autofs</span></span><br></pre></td></tr></table></figure>
<ul>
<li>如果服务正在运行：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl restart autofs</span></span><br></pre></td></tr></table></figure>
<p>使用上述配置，如果进程需要访问<code>autofs</code>卸载的目录（例如<code>/home/payroll/2006/July.sxc</code>，automount守护进程），则会自动挂载目录。如果指定超时，如果目录在超时期间未被访问，则目录将自动被卸载。</p>
<p>您可以通过发出以下命令来查看automount守护进程的状态：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl status autofs</span></span><br></pre></td></tr></table></figure>
<h3 id="覆盖或增加站点配置文件"><a href="#覆盖或增加站点配置文件" class="headerlink" title="覆盖或增加站点配置文件"></a>覆盖或增加站点配置文件</h3><p>覆盖客户端系统上特定挂载点的站点默认值可能很有用。例如，考虑以下条件：</p>
<ul>
<li><p>Automounter地图存储在NIS中，<code>/etc/nsswitch.conf</code>文件具有以下指令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">automount:    files nis</span><br></pre></td></tr></table></figure></li>
<li><p><code>auto.master</code>文件包含以下内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+auto.master</span><br></pre></td></tr></table></figure>
</li>
<li><p>NIS <code>auto.master</code>映射文件包含以下内容:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home auto.home</span><br></pre></td></tr></table></figure>
</li>
<li><p>NIS <code>auto.home</code>地图包含以下内容:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">beth        fileserver.example.com:/<span class="built_in">export</span>/home/beth</span><br><span class="line">joe        fileserver.example.com:/<span class="built_in">export</span>/home/joe</span><br><span class="line">*       fileserver.example.com:/<span class="built_in">export</span>/home/&amp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>文件映射<code>/etc/auto.home</code>不存在。</p>
</li>
</ul>
<p>给定这些条件，让我们假设客户端系统需要重写NIS映射<code>auto.home</code>并从不同的服务器挂载主目录。在这种情况下，客户端将需要使用以下<code>/etc/auto.master</code>映射：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/home /etc/auto.home</span><br><span class="line">+auto.master</span><br></pre></td></tr></table></figure>
<p><code>/etc/auto.home</code>地图包含的条目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*    labserver.example.com:/<span class="built_in">export</span>/home/&amp;</span><br></pre></td></tr></table></figure>
<p>由于自动挂载程序仅处理挂载点的首次出现，<code>/home</code>将包含<code>/etc/auto.home</code>NIS <code>auto.home</code>映射的内容。</p>
<p>另外，为了增加<code>auto.home</code>只有几个条目的站点范围的地图，创建一个<code>/etc/auto.home</code>文件地图，并在其中放入新的条目。最后，包括NIS <code>auto.home</code>地图。然后<code>/etc/auto.home</code>文件映射将看起来类似于：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mydir someserver:/<span class="built_in">export</span>/mydir</span><br><span class="line">+auto.home</span><br></pre></td></tr></table></figure>
<p>鉴于<code>auto.home</code>上面列出的NIS 地图，<code>ls /home</code>现在将输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">beth joe mydir</span><br></pre></td></tr></table></figure>
<p>这最后一个示例按预期方式工作，因为<code>autofs</code>不包含与正在读取的同名文件映射的内容。因此，<code>autofs</code>移到<code>nsswitch</code>配置中的下一个映射源。</p>
<h3 id="使用LDAP存储自动更新映射表"><a href="#使用LDAP存储自动更新映射表" class="headerlink" title="使用LDAP存储自动更新映射表"></a>使用LDAP存储自动更新映射表</h3><p>必须在配置为从LDAP中检索自动安装程序映射的所有系统上安装LDAP客户端库。在Red Hat Enterprise Linux上，<code>openldap</code>软件包应该作为依赖项自动安装<code>automounter</code>。要配置LDAP访问，请修改<code>/etc/openldap/ldap.conf</code>。确保为您的网站适当地设置BASE，URI和架构。</p>
<p>最近建立的用于在LDAP中存储自动安装映射的模式描述如下<code>rfc2307bis</code>。要使用这个模式，有必要通过从模式定义中删除注释字符来将其设置在<code>autofs</code>configuration（<code>/etc/sysconfig/autofs</code>）中。例如：</p>
<p><strong>设置autofs配置</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DEFAULT_MAP_OBJECT_CLASS=<span class="string">"automountMap"</span></span><br><span class="line">DEFAULT_ENTRY_OBJECT_CLASS=<span class="string">"automount"</span></span><br><span class="line">DEFAULT_MAP_ATTRIBUTE=<span class="string">"automountMapName"</span></span><br><span class="line">DEFAULT_ENTRY_ATTRIBUTE=<span class="string">"automountKey"</span></span><br><span class="line">DEFAULT_VALUE_ATTRIBUTE=<span class="string">"automountInformation"</span></span><br></pre></td></tr></table></figure>
<p>确保这些是在配置中未注释的唯一模式条目。该<code>automountKey</code>替换<code>cn</code>的属性<code>rfc2307bis</code>架构。一个<code>LDIF</code>样品的配置的描述如下：</p>
<p><strong>LDF配置</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># extended LDIF</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># LDAPv3</span></span><br><span class="line"><span class="comment"># base &lt;&gt; with scope subtree</span></span><br><span class="line"><span class="comment"># filter: (&amp;(objectclass=automountMap)(automountMapName=auto.master))</span></span><br><span class="line"><span class="comment"># requesting: ALL</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># auto.master, example.com</span></span><br><span class="line">dn: automountMapName=auto.master,dc=example,dc=com</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: automountMap</span><br><span class="line">automountMapName: auto.master</span><br><span class="line"></span><br><span class="line"><span class="comment"># extended LDIF</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># LDAPv3</span></span><br><span class="line"><span class="comment"># base &lt;automountMapName=auto.master,dc=example,dc=com&gt; with scope subtree</span></span><br><span class="line"><span class="comment"># filter: (objectclass=automount)</span></span><br><span class="line"><span class="comment"># requesting: ALL</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># /home, auto.master, example.com</span></span><br><span class="line">dn: automountMapName=auto.master,dc=example,dc=com</span><br><span class="line">objectClass: automount</span><br><span class="line">cn: /home</span><br><span class="line"></span><br><span class="line">automountKey: /home</span><br><span class="line">automountInformation: auto.home</span><br><span class="line"></span><br><span class="line"><span class="comment"># extended LDIF</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># LDAPv3</span></span><br><span class="line"><span class="comment"># base &lt;&gt; with scope subtree</span></span><br><span class="line"><span class="comment"># filter: (&amp;(objectclass=automountMap)(automountMapName=auto.home))</span></span><br><span class="line"><span class="comment"># requesting: ALL</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># auto.home, example.com</span></span><br><span class="line">dn: automountMapName=auto.home,dc=example,dc=com</span><br><span class="line">objectClass: automountMap</span><br><span class="line">automountMapName: auto.home</span><br><span class="line"></span><br><span class="line"><span class="comment"># extended LDIF</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># LDAPv3</span></span><br><span class="line"><span class="comment"># base &lt;automountMapName=auto.home,dc=example,dc=com&gt; with scope subtree</span></span><br><span class="line"><span class="comment"># filter: (objectclass=automount)</span></span><br><span class="line"><span class="comment"># requesting: ALL</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># foo, auto.home, example.com</span></span><br><span class="line">dn: automountKey=foo,automountMapName=auto.home,dc=example,dc=com</span><br><span class="line">objectClass: automount</span><br><span class="line">automountKey: foo</span><br><span class="line">automountInformation: filer.example.com:/<span class="built_in">export</span>/foo</span><br><span class="line"></span><br><span class="line"><span class="comment"># /, auto.home, example.com</span></span><br><span class="line">dn: automountKey=/,automountMapName=auto.home,dc=example,dc=com</span><br><span class="line">objectClass: automount</span><br><span class="line">automountKey: /</span><br><span class="line">automountInformation: filer.example.com:/<span class="built_in">export</span>/&amp;</span><br></pre></td></tr></table></figure>
<h2 id="常见的NFS挂载选项"><a href="#常见的NFS挂载选项" class="headerlink" title="常见的NFS挂载选项"></a>常见的NFS挂载选项</h2><p>除了在远程主机上使用NFS挂载文件系统之外，还可以在挂载时指定其他选项，以使挂载的共享更易于使用。这些选项可用于手动<code>mount</code>命令，<code>/etc/fstab</code>设置和<code>autofs</code>。</p>
<p>以下是NFS安装常用的选项：</p>
<ul>
<li><p>intr</p>
<p>如果服务器关闭或无法访问，则允许NFS请求中断。</p>
</li>
<li><p>lookupcache=<em>mode</em></p>
<p>指定内核如何管理给定挂载点的目录条目的缓存。为有效参数<em>模式</em>是<code>all</code>，<code>none</code>或<code>pos</code>/ <code>positive</code>。</p>
</li>
<li><p>nfsvers=<em>version</em></p>
<p>指定<em>版本</em>为3或4 的NFS协议的<em>版本</em>。对于运行多个NFS服务器的主机很有用。如果未指定版本，则NFS使用内核和<code>mount</code>命令支持的最高版本。</p>
<p>该选项<code>vers</code>与<code>nfsvers</code>此版本相同，并且出于兼容性原因包含在此版本中。</p>
</li>
<li><p>noacl</p>
<p>关闭所有ACL处理。当与旧版本的Red Hat Enterprise Linux，Red Hat Linux或Solaris接口连接时，这可能是需要的，因为最新的ACL技术与旧系统不兼容。</p>
</li>
<li><p>nolock</p>
<p>禁用文件锁定。连接到较旧的NFS服务器时偶尔需要此设置。</p>
</li>
<li><p>noexec</p>
<p>防止在挂载的文件系统上执行二进制文件。如果系统挂载包含不兼容的二进制文件的非Linux文件系统，这非常有用。</p>
</li>
<li><p>nosuid</p>
<p>禁用<code>set-user-identifier</code>或<code>set-group-identifier</code>位。这可以防止远程用户通过运行<code>setuid</code>程序获得更高的权限。</p>
</li>
<li><p>port=<em>num</em></p>
<p>禁用<code>set-user-identifier</code>或<code>set-group-identifier</code>位。这可以防止远程用户通过运行<code>setuid</code>程序获得更高的权限。</p>
</li>
<li><p>rsize=<em>num</em> and wsize=<em>num</em></p>
<p>这些设置加快NFS通信为读（<code>rsize</code>）和写入（<code>wsize</code>）通过设定较大的数据块的大小（<em>NUM</em>，以字节为单位），在同一时间进行传输。更改这些值时要小心; 一些较旧的Linux内核和网卡在较大的块大小下不能正常工作。对于NFSv3，两个参数的默认值均设置为8192.对于NFSv4，两个参数的默认值均设置为32768。</p>
</li>
<li><p>sec=<em>mode</em></p>
<p>它的默认设置是<code>sec=sys</code>使用本地UNIX UID和GID。这些用于<code>AUTH_SYS</code>验证NFS操作。</p>
<p><code>sec=krb5</code> 使用Kerberos V5而不是本地UNIX UID和GID来认证用户。</p>
<p><code>sec=krb5i</code> 使用Kerberos V5进行用户身份验证，并使用安全校验和来执行NFS操作的完整性检查，以防止数据被篡改。</p>
<p><code>sec=krb5p</code>使用Kerberos V5进行用户验证，完整性检查以及加密NFS流量以防止流量嗅探。这是最安全的设置，但它也涉及最高的性能开销。</p>
</li>
<li><p>tcp</p>
<p>指示NFS挂载使用TCP协议。</p>
</li>
<li><p>udp</p>
<p>指示NFS挂载使用UDP协议。</p>
</li>
</ul>
<p>有关选项的完整列表和更详细的信息，请参阅<code>man mount</code>和<code>man nfs</code>。</p>
<h2 id="启动和停止NFS服务器"><a href="#启动和停止NFS服务器" class="headerlink" title="启动和停止NFS服务器"></a>启动和停止NFS服务器</h2><p>要运行未配置为仅使用NFSv4的NFS服务器，<code>rpcbind</code>服务必须正在运行。要验证它<code>rpcbind</code>是否处于活动状态，请使用以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">＃ systemctl status rpcbind</span><br></pre></td></tr></table></figure>
<p>如果<code>rpcbind</code>服务正在运行，则<code>nfs</code>服务可以启动。要启动NFS服务器，请使用以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">＃ systemctl start nfs</span><br></pre></td></tr></table></figure>
<p>要使NFS在引导时启动，请使用以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">＃ systemctl <span class="built_in">enable</span> nfs-server</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong></p>
<p>对于NFSv3，如果NFS设置为在引导时启动，则<code>nfs-lock</code>需要启用该服务。在红帽企业版Linux 7.1及更高版本上，<code>nfs-lock</code>如果需要自动启动，并尝试手动启用它将失败。在Red Hat Enterprise Linux 7.0上，运行检查状态<code>systemctl status nfs-lock</code>。如果<code>nfs-lock</code>未启用，请运行<code>systemctl start nfs-lock</code>。要设置<code>nfs-lock</code>为在Red Hat Enterprise Linux 7.0上自动启动，请运行<code>systemctl enable nfs-lock</code>。</p>
<p>要停止服务器，请使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">＃ systemctl stop nfs</span><br></pre></td></tr></table></figure>
<p>该<code>restart</code>选项是停止然后启动NFS的简写方式。在编辑NFS配置文件后，这是使配置更改生效的最有效的方法。重新启动服务器类型：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">＃ systemctl restart nfs</span><br></pre></td></tr></table></figure>
<p>编辑</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/sysconfig/nfs</span><br></pre></td></tr></table></figure>
<p>文件后，通过运行以下命令重新启动nfs-config服务以使新值生效：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">＃ systemctl restart nfs-config</span><br></pre></td></tr></table></figure>
<p>该<code>try-restart</code>命令仅<code>nfs</code>在当前正在运行时才开始。这个命令相当于红帽init脚本中的<code>condrestart</code>（<em>条件重启</em>），并且非常有用，因为如果NFS没有运行，它不会启动守护进程。</p>
<p>要有条件地重新启动服务器类型：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">＃ systemctl try-restart nfs</span><br></pre></td></tr></table></figure>
<p>重新加载NFS服务器配置文件而不重新启动服务类型：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">＃ systemctl reload nfs</span><br></pre></td></tr></table></figure>
<h2 id="配置NFS服务器"><a href="#配置NFS服务器" class="headerlink" title="配置NFS服务器"></a>配置NFS服务器</h2><ul>
<li>方法可以在NFS服务器上配置导出：<ul>
<li>手动编辑NFS配置文件，即<code>/etc/exports</code>，和</li>
<li>通过命令行，即通过使用该命令 <code>exportfs</code></li>
</ul>
</li>
</ul>
<h3 id="etc-exports配置文件"><a href="#etc-exports配置文件" class="headerlink" title="/etc/exports配置文件"></a><code>/etc/exports</code>配置文件</h3><p>该<code>/etc/exports</code>文件控制将哪个文件系统导出到远程主机并指定选项。它遵循以下语法规则：</p>
<ul>
<li>空白行被忽略。</li>
<li>要添加评论，请使用散列标记（<code>#</code>）开始一行。</li>
<li>你可以用一个反斜杠（<code>\</code>）包住长长的一行。</li>
<li>每个导出的文件系统应该在自己的行中。</li>
<li>在导出的文件系统之后放置的任何授权主机列表必须用空格字符分隔。</li>
<li>每个主机的选项都必须放在主机标识符后面的括号中，而主机和第一个括号之间没有任何空格。</li>
</ul>
<p>导出文件系统的每个条目具有以下结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> host(options)</span><br></pre></td></tr></table></figure>
<p>上述结构使用以下变量：</p>
<ul>
<li><p><em>export</em></p>
<p>正在导出的目录</p>
</li>
<li><p><em>host</em></p>
<p>要共享导出的主机或网络</p>
</li>
<li><p><em>options</em></p>
<p>要用于<em>主机</em>的选项</p>
</li>
</ul>
<p>可以指定多个主机，以及每个主机的特定选项。为此，请将它们列在空格分隔的列表的同一行上，每个主机名后跟其各自的选项（括号），如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> host1(options1) host2(options2) host3(options3)</span><br></pre></td></tr></table></figure>
<p>最简单的形式是<code>/etc/exports</code>文件只指定导出的目录和允许访问的主机，如下例所示：</p>
<p><strong>/etc/exports文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/exported/directory bob.example.com</span><br></pre></td></tr></table></figure>
<p>在这里，<code>bob.example.com</code>可以<code>/exported/directory/</code>从NFS服务器上挂载。由于在本例中没有指定选项，NFS将使用<em>默认</em>设置。</p>
<p>默认设置是：</p>
<ul>
<li><p>ro</p>
<p>导出的文件系统是只读的。远程主机不能更改在文件系统上共享的数据。要允许主机对文件系统进行更改（即读/写），请指定该<code>rw</code>选项。</p>
</li>
<li><p>sync</p>
<p>在将先前的请求所做的更改写入磁盘之前，NFS服务器不会回应请求。要启用异步写入，请指定该选项<code>async</code>。</p>
</li>
<li><p>wdelay</p>
<p>如果怀疑另一个写入请求即将发生，NFS服务器将延迟写入磁盘。这可以提高性能，因为它减少了磁盘必须通过单独的写入命令访问的次数，从而减少了写入开销。要禁用此功能，请指定<code>no_wdelay</code>。<code>no_wdelay</code>仅在<code>sync</code>还指定了默认选项时才可用。</p>
</li>
<li><p>root_squash</p>
<p>这防止<em>远程</em>连接的root用户（与本地相反）拥有root权限; 相反，NFS服务器将为其分配用户标识<code>nfsnobody</code>。这有效地将远程root用户的权限“压缩”到最低的本地用户，从而防止在远程服务器上可能的未经授权的写入。要禁用root压缩，请指定<code>no_root_squash</code>。</p>
</li>
</ul>
<p>要压缩每个远程用户（包括root），请使用<code>all_squash</code>。要指定NFS服务器应从特定主机分配给远程用户的用户和组ID ，请分别使用<code>anonuid</code>和<code>anongid</code>选项，如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> host(anonuid=uid,anongid=gid)</span><br></pre></td></tr></table></figure>
<p>在这里，<em>uid</em>和<em>gid</em>分别是用户ID号和组ID号。在<code>anonuid</code>和<code>anongid</code>选项允许您创建远程NFS用户共享一个特殊的用户和组帐户。</p>
<p>默认情况下，红帽企业版Linux支持<em>访问控制列表</em>（<em>ACL</em>）。要禁用此功能，请<code>no_acl</code>在导出文件系统时指定该选项。</p>
<p>每个导出的文件系统的每个默认值必须被显式覆盖。例如，如果<code>rw</code>未指定该选项，则导出的文件系统将以只读方式共享。以下是<code>/etc/exports</code>覆盖两个默认选项的示例行：</p>
<p><code>/another/exported/directory 192.168.0.3(rw,async)</code></p>
<p>在这个例子中，<code>192.168.0.3</code>可以挂载<code>/another/exported/directory/</code>读/写，并且所有写入磁盘都是异步的。有关导出选项的更多信息，请参阅<code>man exportfs</code>。</p>
<p>其他选项在没有指定默认值的情况下可用。其中包括禁用子树检查，允许从不安全的端口访问，以及允许不安全的文件锁定（对于某些早期的NFS客户端实现是必需的）。请参阅<code>man exports</code>这些较少使用的选项的详细信息。</p>
<p><strong>重要</strong></p>
<p><code>/etc/exports</code>文件 的格式非常精确，特别是在使用空格字符方面。请记住始终使用空格字符将导出的文件系统与主机和主机相互隔离。但是，除了注释行之外，文件中不应该有其他空格字符。</p>
<p>例如，以下两行并不意味着同一件事：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/home bob.example.com(rw) </span><br><span class="line">/home bob.example.com (rw)</span><br></pre></td></tr></table></figure>
<p>第一行只允许用户<code>bob.example.com</code>读/写访问<code>/home</code>目录。第二行允许用户<code>bob.example.com</code>将目录挂载为只读（默认），而世界其他地方可以挂载它的读/写。</p>
<h3 id="exportfs命令"><a href="#exportfs命令" class="headerlink" title="exportfs命令"></a><code>exportfs</code>命令</h3><p>文件中列出了每个使用NFS导出到远程用户的文件系统以及这些文件系统的访问级别<code>/etc/exports</code>。当<code>nfs</code>服务启动时，<code>/usr/sbin/exportfs</code>命令将启动并读取此文件，将控制权交给<code>rpc.mountd</code>（如果NFSv3）实际的安装过程，然后传递<code>rpc.nfsd</code>到远程用户可以使用的文件系统的位置。</p>
<p>当手动发布时，该<code>/usr/sbin/exportfs</code>命令允许root用户有选择地导出或取消导出目录，而无需重新启动NFS服务。当给出正确的选项时，该<code>/usr/sbin/exportfs</code>命令将导出的文件系统写入<code>/var/lib/nfs/xtab</code>。由于在决定对文件系统的访问权限时<code>rpc.mountd</code>引用<code>xtab</code>文件，对导出的文件系统列表的更改立即生效。</p>
<p>以下是可供选择的常用选项列表<code>/usr/sbin/exportfs</code>：</p>
<ul>
<li><p>-r</p>
<p><code>/etc/exports</code>通过在中构建新的导出列表， 导致列出的所有目录被导出<code>/etc/lib/nfs/xtab</code>。此选项可以有效地刷新导出列表并进行任何更改<code>/etc/exports</code>。</p>
</li>
<li><p>-a</p>
<p>导致所有目录被导出或取消导出，具体取决于传递到的其他选项<code>/usr/sbin/exportfs</code>。如果没有指定其他选项，则<code>/usr/sbin/exportfs</code>导出在中指定的所有文件系统<code>/etc/exports</code>。</p>
</li>
<li><p>-o <em>file-systems</em></p>
<p>指定未列入的要导出的目录<code>/etc/exports</code>。将<em>文件系统</em>替换为要导出的其他文件系统。这些文件系统必须按照指定的相同方式进行格式化<code>/etc/exports</code>。此选项通常用于测试导出的文件系统，然后将其永久添加到要导出的文件系统列表中。</p>
</li>
<li><p>-i</p>
<p>忽略<code>/etc/exports</code>; 只有从命令行给出的选项用于定义导出的文件系统。</p>
</li>
<li><p>-u</p>
<p>取消导出所有共享目录。该命令<code>/usr/sbin/exportfs -ua</code>挂起NFS文件共享，同时保持所有的NFS守护进程。要重新启用NFS共享，请使用<code>exportfs -r</code>。</p>
</li>
<li><p>-v</p>
<p>详细操作，<code>exportfs</code>执行该命令时将更详细地显示正在导出或未导出的文件系统。</p>
</li>
</ul>
<p>如果没有选项传递给<code>exportfs</code>命令，则会显示当前导出的文件系统的列表。有关该<code>exportfs</code>命令的更多信息，请参阅<code>man exportfs</code>。</p>
<h3 id="exportfs与NFSv4一起使用"><a href="#exportfs与NFSv4一起使用" class="headerlink" title="exportfs与NFSv4一起使用"></a><code>exportfs</code>与NFSv4一起使用</h3><p>在红帽企业版Linux 7中，不需要额外的步骤来配置NFSv4导出，因为所提及的任何文件系统都可以自动使用相同路径的NFSv3和NFSv4客户端。以前的版本并非如此。</p>
<p>为了防止客户端使用的NFSv4，通过设置将其关闭<code>RPCNFSDARGS= -N 4</code>在<code>/etc/sysconfig/nfs</code>。</p>
<h3 id="在防火墙后面运行NFS"><a href="#在防火墙后面运行NFS" class="headerlink" title="在防火墙后面运行NFS"></a>在防火墙后面运行NFS</h3><p>NFS要求<code>rpcbind</code>为RPC服务动态分配端口，并可能导致配置防火墙规则的问题。要允许客户端访问防火墙后面的NFS共享，请编辑该<code>/etc/sysconfig/nfs</code>文件以设置运行RPC服务的端口。</p>
<p>该<code>/etc/sysconfig/nfs</code>文件在所有系统上默认情况下不存在。如果<code>/etc/sysconfig/nfs</code>不存在，请创建它并指定以下内容：</p>
<ul>
<li><p>RPCMOUNTDOPTS=”-p <em>port</em>“</p>
<p>这将“-p <em>port</em> ” 添加到rpc.mount命令行：。 <code>rpc.mount -p *port*</code></p>
</li>
</ul>
<p>To specify the ports to be used by the <code>nlockmgr</code> service, set the port number for the <em>nlm_tcpport</em> and <em>nlm_udpport</em> options in the <code>/etc/modprobe.d/lockd.conf</code> file.</p>
<p>要指定<code>nlockmgr</code>服务使用的端口，请为文件中的<em>nlm_tcpport</em>和<em>nlm_udpport</em>选项设置端口号<code>/etc/modprobe.d/lockd.conf</code>。</p>
<p>如果NFS无法启动，请检查<code>/var/log/messages</code>。通常，如果您指定了一个已经在使用的端口号，NFS将无法启动。编辑之后<code>/etc/sysconfig/nfs</code>，您需要重新启动<code>nfs-config</code>服务以使新值在红帽企业版Linux 7.2及更高版本中生效，方法是运行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">＃systemctl restart nfs-config</span><br></pre></td></tr></table></figure>
<p>然后，重新启动NFS服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">＃systemctl restart nfs-server</span><br></pre></td></tr></table></figure>
<p>运行<code>rpcinfo -p</code>确认更改已生效。</p>
<p><strong>注意</strong></p>
<p>许NFSv4.0回调通过防火墙设置，<code>/proc/sys/fs/nfs/nfs_callback_tcpport</code>并允许服务器连接到客户端的端口。</p>
<p>不需要用于的NFSv4.1或更高，而对于其他端口这个过程<code>mountd</code>，<code>statd</code>和<code>lockd</code>不以纯的NFSv4环境必需的。</p>
<h3 id="发现NFS导出"><a href="#发现NFS导出" class="headerlink" title="发现NFS导出"></a>发现NFS导出</h3><p>有两种方法可以发现NFS服务器导出的文件系统。</p>
<p>首先，在任何支持NFSv3的服务器上，使用以下<code>showmount</code>命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ showmount -e myserver</span><br><span class="line">Export list <span class="keyword">for</span> mysever</span><br><span class="line">/exports/foo</span><br><span class="line">/exports/bar</span><br></pre></td></tr></table></figure>
<p>其次，在任何支持NFSv4的服务器上，挂载<code>/</code>并浏览。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount myserver:/ /mnt/</span></span><br><span class="line"><span class="comment">#cd /mnt/</span></span><br><span class="line">exports</span><br><span class="line"><span class="comment"># ls exports</span></span><br><span class="line">foo</span><br><span class="line">bar</span><br></pre></td></tr></table></figure>
<p>在同时支持NFSv4和NFSv3的服务器上，这两种方法都可以工作，并得到相同的结果。</p>
<p><strong>注意</strong></p>
<p>在旧版NFS服务器上的红帽企业版Linux 6之前，根据配置方式，可以将文件系统导出到不同路径的NFSv4客户端。由于这些服务器默认情况下不启用NFSv4，因此通常不会造成问题。</p>
<h3 id="通过防火墙访问RPC配额"><a href="#通过防火墙访问RPC配额" class="headerlink" title="通过防火墙访问RPC配额"></a>通过防火墙访问RPC配额</h3><p>如果导出使用磁盘配额的文件系统，则可以使用配额远程过程调用（RPC）服务向NFS客户端提供磁盘配额数据。</p>
<p><strong>使RPC配额可以在防火墙后面访问</strong></p>
<ol>
<li><p>要启用<code>rpc-rquotad</code>服务，请输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl enable rpc-rquotad</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>要启动<code>rpc-rquotad</code>服务，请输入：</p>
<p>​</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl start rpc-rquotad</span></span><br></pre></td></tr></table></figure>
<p>请注意<code>rpc-rquotad</code>，如果启用，启动<code>nfs-server</code>服务后自动启动。</p>
<p>​</p>
</li>
<li><p>要使配额RPC服务在防火墙后可访问，<code>875</code>需要打开UDP或TCP端口。默认的端口号是在<code>/etc/services</code>文件中定义的。</p>
<p>您可以通过附加到文件中的变量来覆盖默认的端口号。 <code>-p *port-number*``RPCRQUOTADOPTS``/etc/sysconfig/rpc-rquotad</code></p>
</li>
<li><p>重新启动<code>rpc-rquotad</code>了在改变<code>/etc/sysconfig/rpc-rquotad</code>文件生效：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl restart rpc-rquotad</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="从远程主机设置配额"><a href="#从远程主机设置配额" class="headerlink" title="从远程主机设置配额"></a>从远程主机设置配额</h3><p>默认情况下，配额只能被远程主机读取。要允许设置配额，请将该<code>-S</code>选项附加到文件中的<code>RPCRQUOTADOPTS</code>变量<code>/etc/sysconfig/rpc-rquotad</code>。</p>
<p>重新启动<code>rpc-rquotad</code>了在改变<code>/etc/sysconfig/rpc-rquotad</code>文件生效：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl restart rpc-rquotad</span></span><br></pre></td></tr></table></figure>
<h3 id="主机名格式"><a href="#主机名格式" class="headerlink" title="主机名格式"></a>主机名格式</h3><p>host(s)可以采用以下形式：</p>
<ul>
<li><p>Single machine</p>
<p>一个完全合格的域名（可由服务器解析），主机名（可由服务器解析）或IP地址。</p>
</li>
<li><p>Series of machines specified with wildcards</p>
<p>使用<code>*</code>或<code>?</code>字符来指定一个字符串匹配。通配符不能与IP地址一起使用; 但是，如果反向DNS查找失败，他们可能会意外地工作。在完全限定的域名中指定通配符时，通配符中<code>.</code>不包含dots（）。例如，<code>*.example.com</code>包括<code>one.example.com</code>但不是<code>include one.two.example.com</code>。</p>
</li>
<li><p>IP networks</p>
<p>使用<em>abcd / **z</em>，其中<em>abcd</em>是网络，<em>z</em>是网络掩码中的位数（例如192.168.0.0/24）。另一种可接受的格式是<em>abcd / **netmask</em>，其中<em>abcd</em>是网络，<em>netmask</em>是网络掩码（例如，192.168.100.8/255.255.255.0）。</p>
</li>
<li><p>Netgroups</p>
<p>使用格式@ <em>group-name</em>，其中<em>group-name</em>是NIS网络组的名称。</p>
</li>
</ul>
<h3 id="通过RDMA启用NFS（NFSoRDMA）"><a href="#通过RDMA启用NFS（NFSoRDMA）" class="headerlink" title="通过RDMA启用NFS（NFSoRDMA）"></a>通过RDMA启用NFS（NFSoRDMA）</h3><p>如果RDMA支持硬件，则远程直接内存访问（RDMA）服务将在Red Hat Enterprise Linux 7中自动运行。</p>
<p>安装rdma软件包。该<code>/etc/rdma/rdma.conf</code>文件包含一条<em>XPRTRDMA_LOAD=yes</em>默认设置的行，它要求<code>rdma</code>服务加载NFSoRDMA <em>客户端</em>模块。</p>
<p>要启用NFSoRDMA <em>服务器</em>模块的自动加载，请添加<em>SVCRDMA_LOAD=yes</em>一个新行<code>/etc/rdma/rdma.conf</code>。</p>
<p><em>RPCNFSDARGS=”—rdma=20049”</em>在该<code>/etc/sysconfig/nfs</code>文件中指定NFSoRDMA服务侦听客户端的端口号。<a href="https://tools.ietf.org/html/rfc5667" target="_blank" rel="noopener"><em>RFC 5667</em></a>指定在<code>20049</code>通过RDMA提供NFSv4服务时，服务器必须侦听端口。</p>
<p><code>nfs</code>编辑<code>/etc/rdma/rdma.conf</code>文件后 重新启动服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">＃service nfs restart</span><br></pre></td></tr></table></figure>
<p>请注意，对于较早的内核版本，编辑后需要重新启动系统才能<code>/etc/rdma/rdma.conf</code>使更改生效。</p>
<h2 id="保护NFS"><a href="#保护NFS" class="headerlink" title="保护NFS"></a>保护NFS</h2><p>NFS适用于大量已知主机透明共享整个文件系统。但是，易用性带来了各种潜在的安全问题。要最大限度地降低NFS安全风险并保护服务器上的数据，请在将NFS文件系统导出到服务器上或挂载到客户机上时考虑以下几节。</p>
<h3 id="使用AUTH-SYS和导出控件的NFS安全性"><a href="#使用AUTH-SYS和导出控件的NFS安全性" class="headerlink" title="使用AUTH_SYS和导出控件的NFS安全性"></a>使用AUTH_SYS和导出控件的NFS安全性</h3><p>传统上，NFS提供了两个选项来控制对导出文件的访问。</p>
<p>首先，服务器限制哪些主机可以通过IP地址或主机名来安装哪些文件系统。</p>
<p>其次，服务器以与本地用户相同的方式为NFS客户端上的用户强制执行文件系统权限。传统上，它使用<code>AUTH_SYS</code>（也称为<code>AUTH_UNIX</code>）依赖于客户端来声明用户的UID和GID。请注意，这意味着恶意或错误配置的客户端可能很容易出错，并允许用户访问不应该访问的文件。</p>
<p>为了限制潜在的风险，管理员经常允许只读访问权限或压缩用户权限到普通用户和组ID。不幸的是，这些解决方案阻止了NFS共享的使用方式。</p>
<p>此外，如果攻击者获得对导出NFS文件系统的系统使用的DNS服务器的控制，则可以将与特定主机名或完全限定的域名关联的系统指向未授权的机器。此时，未经授权的机器<em>是</em>允许安装NFS共享的系统，因为没有交换用户名或密码信息来为NFS安装提供额外的安全性。</p>
<p>在通过NFS导出目录时，应该谨慎使用通配符，因为通配符的范围可能包含比预期更多的系统。</p>
<p>也可以通过TCP封装来限制对<code>rpcbind</code>服务的访问。与创建规则<code>iptables</code>还可以限制访问由使用的端口<code>rpcbind</code>，<code>rpc.mountd</code>和<code>rpc.nfsd</code>。</p>
<p>有关保护NFS的更多信息<code>rpcbind</code>，请参阅<code>man iptables</code>。</p>
<h3 id="NFS安全与AUTH-GSS"><a href="#NFS安全与AUTH-GSS" class="headerlink" title="NFS安全与AUTH_GSS"></a>NFS安全与<code>AUTH_GSS</code></h3><p>NFSv4通过强制实施RPCSEC_GSS和Kerberos版本5 GSS-API机制，彻底改变了NFS的安全性。但是，RPCSEC_GSS和Kerberos机制也适用于所有版本的NFS。在FIPS模式下，只能使用FIPS认可的算法。</p>
<p>与AUTH_SYS不同，使用RPCSEC_GSS Kerberos机制，服务器不依赖于客户端来正确表示哪个用户正在访问该文件。而是使用加密技术来向服务器验证用户身份，从而防止恶意客户端在没有该用户的Kerberos凭据的情况下冒充用户。使用RPCSEC_GSS Kerberos机制是保护安装最直接的方式，因为在配置Kerberos之后，不需要额外的安装。</p>
<h3 id="配置Kerberos"><a href="#配置Kerberos" class="headerlink" title="配置Kerberos"></a>配置Kerberos</h3><p>在配置支持NFSv4 Kerberos的服务器之前，您需要安装并配置Kerberos密钥分发中心（KDC）。Kerberos是一个网络认证系统，它允许客户端和服务器通过使用对称加密和可信的第三方KDC相互认证。红帽推荐使用身份管理（IdM）来设置Kerberos。</p>
<p><strong>程序8.2。为IdM配置NFS服务器和客户端以使用RPCSEC_GSS</strong></p>
<ol>
<li><ul>
<li>在NFS服务器端 创建主体。<code>nfs/hostname.*domain@REALM*</code></li>
<li>在服务器和客户端都 创建主体。<code>host/hostname.*domain@REALM*</code></li>
<li>将相应的密钥添加到客户端和服务器的密钥表中。</li>
</ul>
<p>​</p>
</li>
<li><p>在服务器端，使用<code>sec=</code>选项来启用所需的安全风格。要启用所有的安全风格以及非加密安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/<span class="built_in">export</span> *（sec=sys:krb5:krb5i:krb5p）</span><br></pre></td></tr></table></figure>
<p>与该<code>sec=</code>选项一起使用的有效安全风格是：</p>
<ul>
<li><code>sys</code>：没有密码保护，默认</li>
<li><code>krb5</code>：只有身份验证</li>
<li><code>krb5i</code>：完整性保护</li>
<li><code>krb5p</code>： 隐私保护</li>
</ul>
</li>
<li><p>在客户端，添加<code>sec=krb5</code>（或<code>sec=krb5i</code>，或者<code>sec=krb5p</code>，取决于设置）到挂载选项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">＃mount -o sec=krb5 server:/<span class="built_in">export</span> / mnt</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>尽管红帽建议使用IdM，但也支持Active Directory（AD）Kerberos服务器。</p>
<h3 id="使用NFSv4的NFS安全性"><a href="#使用NFSv4的NFS安全性" class="headerlink" title="使用NFSv4的NFS安全性"></a>使用NFSv4的NFS安全性</h3><p>NFSv4包含基于Microsoft Windows NT模型的ACL支持，而不是POSIX模型，因为Microsoft Windows NT模型的功能和广泛的部署。</p>
<p>NFSv4的另一个重要安全功能是删除使用<code>MOUNT</code>协议来安装文件系统。<code>MOUNT</code>由于协议处理文件处理的方式，该协议带来了安全风险。</p>
<h3 id="文件权限"><a href="#文件权限" class="headerlink" title="文件权限"></a>文件权限</h3><p>一旦NFS文件系统被远程主机读取/写入，每个共享文件的唯一保护就是其权限。如果共享相同用户标识值的两个用户安装相同的NFS文件系统，则可以修改彼此的文件。另外，以root身份登录到客户端系统的任何人都可以使用该<code>su -</code>命令访问具有NFS共享的任何文件。</p>
<p>默认情况下，红帽企业版Linux支持访问控制列表（ACL）。红帽建议保持启用此功能。</p>
<p>默认情况下，NFS 在导出文件系统时使用<em>root</em>压缩。这将在本地计算机上以root用户身份设置访问NFS共享的任何用户的用户标识<code>nobody</code>。</p>
<p>以只读方式导出NFS共享时，请考虑使用该<code>all_squash</code>选项。此选项使每个访问导出的文件系统的用户都可以获取用户的用户标识<code>nfsnobody</code>。</p>
<h2 id="NFS-AND-RPCBIND"><a href="#NFS-AND-RPCBIND" class="headerlink" title="NFS AND RPCBIND"></a>NFS AND RPCBIND</h2><p><strong>注意</strong></p>
<p>以下部分仅适用于需要<code>rpcbind</code>向后兼容服务的NFSv3实现。</p>
<p>在<code>rpcbind</code>实用的地图RPC服务上，他们听的端口。RPC进程<code>rpcbind</code>在启动时进行通知，注册他们正在监听的端口以及他们期望提供的RPC程序编号。客户端系统然后<code>rpcbind</code>用特定的RPC程序号在服务器上联系。该<code>rpcbind</code>服务将客户端重定向到正确的端口号，以便与请求的服务进行通信。</p>
<p>因为基于RPC的服务依赖<code>rpcbind</code>与传入的客户端请求进行所有连接，所以<code>rpcbind</code>必须在这些服务中的任何一个启动之前可用。</p>
<p>该<code>rpcbind</code>服务使用TCP包装进行访问控制，并使用访问控制规则来<code>rpcbind</code>影响<em>所有</em>基于RPC的服务。或者，可以为每个NFS RPC守护进程指定访问控制规则。这些规则的<code>man</code>页面<code>rpc.mountd</code>和<code>rpc.statd</code>包含有关这些规则的精确语法的信息。</p>
<h3 id="NFS和rpcbind故障排除"><a href="#NFS和rpcbind故障排除" class="headerlink" title="NFS和rpcbind故障排除"></a>NFS和<code>rpcbind</code>故障排除</h3><p>因为<code>rpcbind</code>提供了RPC服务和用于与之通信的端口号之间的协调，所以<code>rpcbind</code>在排除故障时查看当前RPC服务的状态是非常有用的。该<code>rpcinfo</code>命令用端口号，RPC程序号，版本号和IP协议类型（TCP或UDP）显示每个基于RPC的服务。</p>
<p>要确保启用适当的基于NFS RPC的服务<code>rpcbind</code>，请发出以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpcinfo -p</span></span><br></pre></td></tr></table></figure>
<p><strong>rpcinfo -p命令输出</strong></p>
<p>以下是此命令的输出示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">program vers proto  port service</span><br><span class="line">      100021    1   udp  32774  nlockmgr</span><br><span class="line">      100021    3   udp  32774  nlockmgr</span><br><span class="line">      100021    4   udp  32774  nlockmgr</span><br><span class="line">      100021    1   tcp  34437  nlockmgr</span><br><span class="line">      100021    3   tcp  34437  nlockmgr</span><br><span class="line">      100021    4   tcp  34437  nlockmgr</span><br><span class="line">      100011    1   udp    819  rquotad</span><br><span class="line">      100011    2   udp    819  rquotad</span><br><span class="line">      100011    1   tcp    822  rquotad</span><br><span class="line">      100011    2   tcp    822  rquotad</span><br><span class="line">      100003    2   udp   2049  nfs</span><br><span class="line">      100003    3   udp   2049  nfs</span><br><span class="line">      100003    2   tcp   2049  nfs</span><br><span class="line">      100003    3   tcp   2049  nfs</span><br><span class="line">      100005    1   udp    836  mountd</span><br><span class="line">      100005    1   tcp    839  mountd</span><br><span class="line">      100005    2   udp    836  mountd</span><br><span class="line">      100005    2   tcp    839  mountd</span><br><span class="line">      100005    3   udp    836  mountd</span><br><span class="line">      100005    3   tcp    839  mountd</span><br></pre></td></tr></table></figure>
<p>如果其中一个NFS服务启动不正确，<code>rpcbind</code>将无法将来自该服务的客户端的RPC请求映射到正确的端口。在许多情况下，如果<code>rpcinfo</code>输出中不存在NFS，则重新启动NFS会使服务正确注册<code>rpcbind</code>并开始工作。</p>
<p>有关更多信息和选项列表<code>rpcinfo</code>，请参阅其<code>man</code>页面。</p>
<h2 id="NFS参考"><a href="#NFS参考" class="headerlink" title="NFS参考"></a>NFS参考</h2><p>管理NFS服务器可能是一个挑战。许多选项（包括本章中未提及的许多选项）都可用于导出或装载NFS共享。有关更多信息，请参阅以下资源。</p>
<h2 id="已安装的文档"><a href="#已安装的文档" class="headerlink" title="已安装的文档"></a>已安装的文档</h2><ul>
<li><code>man mount</code> - 全面了解NFS服务器和客户端配置的安装选项。</li>
<li><code>man fstab</code>- 提供<code>/etc/fstab</code>在启动时用于装入文件系统的文件格式的详细信息。</li>
<li><code>man nfs</code> - 提供有关NFS特定的文件系统导出和安装选项的详细信息。</li>
<li><code>man exports</code>- 显示<code>/etc/exports</code>导出NFS文件系统时在文件中使用的常用选项。</li>
</ul>
<h1 id="FS缓存"><a href="#FS缓存" class="headerlink" title="FS缓存"></a>FS缓存</h1><p>FS-Cache是一个持久的本地缓存，可以被文件系统用来从网络上获取数据并将其缓存在本地磁盘上。这有助于最大限度地减少从网络上安装的文件系统（例如NFS）访问数据的用户的网络流量。</p>
<p>下图是FS-Cache工作原理的高级示例：</p>
<p><img src="https://blog-image.nos-eastchina1.126.net/bB9d6a5FD8.png?imageslim" alt="FS高速缓存概述"></p>
<p>FS-Cache被设计为尽可能透明的系统的用户和管理员。与<code>cachefs</code>Solaris 不同，FS-Cache允许服务器上的文件系统直接与客户端的本地缓存进行交互，而无需创建超量安装的文件系统。通过NFS，挂载选项指示客户端挂载启用FS缓存的NFS共享。</p>
<p>FS-Cache不会改变在网络上工作的文件系统的基本操作 - 它只是为文件系统提供一个可以缓存数据的永久位置。例如，无论是否启用FS-Cache，客户端仍可以挂载NFS共享。另外，缓存的NFS可以处理不适合缓存的文件（无论是单独的还是整体的），因为文件可以被部分缓存，并且不需要在前面完整地读取。FS-Cache还隐藏了客户端文件系统驱动程序中发生在缓存中的所有I / O错误。</p>
<p>为了提供缓存服务，FS-Cache需要一个<em>缓存后端</em>。高速缓存后端是配置为提供高速缓存服务（即<code>cachefiles</code>）的存储驱动程序。在这种情况下，FS-Cache需要一个挂载的基于块的文件系统，支持<code>bmap</code>和扩展属性（例如ext3）作为其缓存后端。</p>
<p>FS-Cache不能随意缓存任何文件系统，无论是通过网络还是以其他方式：共享文件系统的驱动程序必须进行更改以允许与FS-Cache进行交互，数据存储/检索以及元数据设置和验证。FS-Cache需要<em>对</em>来自缓存文件系统的<em>密钥</em>和<em>一致性数据</em>进行索引以支持持久性：索引键将文件系统对象与缓存对象进行匹配，以及通过一致性数据确定缓存对象是否仍然有效。</p>
<p><strong>注意</strong></p>
<p>在红帽企业版Linux 7中，<code>cachefilesd</code>默认情况下不安装，需要手动安装。</p>
<h2 id="履约担保"><a href="#履约担保" class="headerlink" title="履约担保"></a>履约担保</h2><p>FS-Cache并<em>不能</em>保证性能的提高，但是通过避免网络拥塞来保证一致的性能。使用高速缓存后端会导致性能降低：例如，高速缓存的NFS共享将磁盘访问添加到跨网络查找。尽管FS-Cache尝试尽可能异步，但在不可能的地方存在同步路径（例如读取）。</p>
<p>例如，使用FS-Cache在两台计算机之间缓存非共享GigE网络的NFS共享，将不会显示文件访问方面的任何性能改进。相反，NFS请求将从服务器内存而不是从本地磁盘得到满足。</p>
<p>因此FS-Cache的使用是各种因素之间的<em>妥协</em>。例如，如果正在使用FS-Cache来缓存NFS流量，则可能会稍微降低客户端的速度，但通过在本地满足读取请求而大幅减少网络和服务器负载，而不消耗网络带宽。</p>
<h2 id="设置一个缓存"><a href="#设置一个缓存" class="headerlink" title="设置一个缓存"></a>设置一个缓存</h2><p>目前，红帽企业Linux 7只提供<code>cachefiles</code>缓存后端。该<code>cachefilesd</code>守护程序启动和管理<code>cachefiles</code>。该<code>/etc/cachefilesd.conf</code>文件控制如何<code>cachefiles</code>提供缓存服务。要配置此类型的缓存后端，<code>cachefilesd</code>必须安装该包。</p>
<p>在缓存后端配置的第一个设置是将哪个目录用作缓存。要配置它，请使用以下参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dir /path/to/cache</span><br></pre></td></tr></table></figure>
<p>通常，高速缓存后端目录设置<code>/etc/cachefilesd.conf</code>为<code>/var/cache/fscache</code>，如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dir /var/cache/fscache</span><br></pre></td></tr></table></figure>
<p>FS-Cache将缓存存储在主机的文件系统中<code>*/path/to/cache*</code>。在笔记本电脑上，建议使用根文件系统（<code>/</code>）作为主机文件系统，但对于桌面计算机来说，将特别为高速缓存装入磁盘分区将更为谨慎。</p>
<p>支持FS-Cache缓存后端所需功能的文件系统包括以下文件系统的Red Hat Enterprise Linux 7实施：</p>
<ul>
<li>ext3（启用扩展属性）</li>
<li>EXT4</li>
<li>BTRFS</li>
<li>XFS</li>
</ul>
<p>主机文件系统必须支持用户定义的扩展属性; FS-Cache使用这些属性来存储一致性维护信息。要为ext3文件系统（即<code>*device*</code>）启用用户定义的扩展属性，请使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">＃ tune2fs -o user_xattr /dev/device</span><br></pre></td></tr></table></figure>
<p>或者，可以在挂载时启用文件系统的扩展属性，如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">＃ mount /dev/device /path/to/cache -o user_xattr</span><br></pre></td></tr></table></figure>
<p>缓存后端通过在托管缓存的分区上维持一定量的可用空间来工作。它使用可用空间来响应系统的其他元素来增长和缩小缓存，使其可以安全地用于根文件系统（例如，在笔记本电脑上）。FS-Cache设置此行为的默认值，可以通过<em>高速缓存剔除限制</em>进行配置。</p>
<p>一旦配置文件就位，启动该<code>cachefilesd</code>服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start cachefilesd</span><br></pre></td></tr></table></figure>
<p>要配置<code>cachefilesd</code>为在引导时启动，请以root身份执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> cachefilesd</span><br></pre></td></tr></table></figure>
<h2 id="通过NFS使用高速缓存"><a href="#通过NFS使用高速缓存" class="headerlink" title="通过NFS使用高速缓存"></a>通过NFS使用高速缓存</h2><p>除非明确指示，否则NFS不会使用缓存。要将NFS挂载配置为使用FS高速缓存，请<code>-o fsc</code>在<code>mount</code>命令中包含以下选项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">＃ mount nfs-share:/ /mount/point -o fsc</span><br></pre></td></tr></table></figure>
<p>对文件的所有访问<code>*/mount/point*</code>都将通过缓存，除非打开文件直接I / O或写入。NFS使用NFS文件句柄索引缓存内容，<em>而不是</em>文件名; 这意味着硬链接文件正确共享缓存。</p>
<p>NFS的版本2,3和4支持缓存。但是，每个版本使用不同的分支进行缓存。</p>
<h3 id="缓存共享"><a href="#缓存共享" class="headerlink" title="缓存共享"></a>缓存共享</h3><p>NFS缓存共享有几个潜在的问题。由于缓存是持久的，因此缓存中的数据块将按照四个键的顺序进行索引：</p>
<ul>
<li>级别1：服务器详细信息</li>
<li>等级2：一些安装选项; 安全类型; FSID; 唯一标志</li>
<li>等级3：文件句柄</li>
<li>级别4：文件中的页码</li>
</ul>
<p>为了避免超级块之间的一致性管理问题，所有希望缓存数据的NFS超级块都有唯一的2级密钥。通常情况下，两个具有相同源卷和选项的NFS安装将共享一个超级块，并共享缓存，即使它们在该卷内安装不同的目录。</p>
<p><strong>缓存共享</strong></p>
<p>采取以下两个<code>mount</code>命令：</p>
<p><code>mount home0:/disk0/fred /home/fred -o fsc</code></p>
<p><code>mount home0:/disk0/jim /home/jim -o fsc</code></p>
<p>在这里，<code>/home/fred</code>并且<code>/home/jim</code>很可能会分享超级因为他们有同样的选择，特别是如果他们来自同一个卷/分区NFS服务器上（<code>home0</code>）。现在考虑接下来的两个安装命令：</p>
<p><code>mount home0:/disk0/fred /home/fred -o fsc,rsize=230</code></p>
<p><code>mount home0:/disk0/jim /home/jim -o fsc,rsize=231</code></p>
<p>在这种情况下，<code>/home/fred</code>并<code>/home/jim</code>不会因为他们有不同的网络接入参数，这是二级键的一部分共享超级块。以下装载顺序也是如此：</p>
<p><code>mount home0:/disk0/fred /home/fred1 -o fsc,rsize=230</code></p>
<p><code>mount home0:/disk0/fred /home/fred2 -o fsc,rsize=231</code></p>
<p>这里，两个子树（<code>/home/fred1</code>和<code>/home/fred2</code>）的内容将被缓存<em>两次</em>。</p>
<p>避免超级数据块共享的另一种方法是用<code>nosharecache</code>参数明确地禁止它。使用相同的例子：</p>
<p><code>mount home0:/disk0/fred /home/fred -o nosharecache,fsc</code></p>
<p><code>mount home0:/disk0/jim /home/jim -o nosharecache,fsc</code></p>
<p>然而，在这种情况下，只有超级块中的一个将被允许使用高速缓存，因为没有什么区分等级的2键<code>home0:/disk0/fred</code>和<code>home0:/disk0/jim</code>。为了解决这个问题，添加一个<em>唯一的标识符</em>对安装件中的至少一个，即，。例如： <code>fsc=*unique-identifier*</code></p>
<p><code>mount home0:/disk0/fred /home/fred -o nosharecache,fsc</code></p>
<p><code>mount home0:/disk0/jim /home/jim -o nosharecache,fsc=jim</code></p>
<p>这里，唯一标识符<code>jim</code>将被添加到缓存中使用的级别2密钥中<code>/home/jim</code>。</p>
<h3 id="使用NFS缓存限制"><a href="#使用NFS缓存限制" class="headerlink" title="使用NFS缓存限制"></a>使用NFS缓存限制</h3><p>从共享文件系统中打开直接I / O文件将自动绕过缓存。这是因为这种访问类型必须直接连接到服务器。</p>
<p>从共享文件系统中打开文件以进行写入在NFS版本2和3上将不起作用。这些版本的协议不能为客户端提供足够的一致性管理信息，以检测来自另一个客户端的同一文件的并发写入。</p>
<p>因此，从共享文件系统中为直接I / O或写入打开文件将刷新文件的缓存副本。FS-Cache将不会再次缓存文件，直到不再为直接I / O或写入而打开。</p>
<p>而且，这个FS-Cache的版本只缓存常规的NFS文件。FS-Cache <em>不会</em>缓存目录，符号链接，设备文件，FIFO和套接字。</p>
<h2 id="设置高速缓存限制"><a href="#设置高速缓存限制" class="headerlink" title="设置高速缓存限制"></a>设置高速缓存限制</h2><p>该<code>cachefilesd</code>守护程序的工作原理是从共享文件系统的远程数据缓存到磁盘上的可用空间。这可能会消耗所有可用的可用空间，如果该磁盘也容纳了根分区，则这可能是不好的。为了控制这一点，<code>cachefilesd</code>通过从缓存中丢弃旧对象（即，最近访问较少）来尝试保持一定量的可用空间。这种行为被称为<em>高速缓存剔除</em>。</p>
<p>高速缓存剔除是根据块的百分比和底层文件系统中可用文件的百分比来完成的。有六个限制由以下设置控制<code>/etc/cachefilesd.conf</code>：</p>
<ul>
<li><p>brun <em>N</em>％（块的百分比），frun <em>N</em>％（文件的百分比）</p>
<p>如果可用空间量和缓存中可用文件的数量超过这两个限制，则关闭剔除。</p>
</li>
<li><p>bcull <em>N</em>％（块的百分比），fcull <em>N</em>％（文件的百分比）</p>
<p>如果可用空间量或缓存中的文件数量低于这些限制中的任何一个，则将开始剔除。</p>
</li>
<li><p>bstop <em>N</em>％（块的百分比），brun<code>/</code>frun`- 10％</p>
</li>
</ul>
<ul>
<li><code>bcull</code>/ <code>fcull</code>- 7％</li>
<li><code>bstop</code>/ <code>fstop</code>- 3％</li>
</ul>
<p>配置这些设置时，必须满足以下条件：</p>
<p>0 &lt;= <code>bstop</code>&lt; <code>bcull</code>&lt; <code>brun</code>&lt;100</p>
<p>0 &lt;= <code>fstop</code>&lt; <code>fcull</code>&lt; <code>frun</code>&lt;100</p>
<p>这些是可用空间和可用文件的百分比，并不显示为100减去<code>df</code>程序显示的百分比。</p>
<p><strong>重要</strong></p>
<p>剔除同时取决于b <em>xxx</em>和f <em>xxx</em>对; 他们不能分开处理。</p>
<h2 id="统计信息"><a href="#统计信息" class="headerlink" title="统计信息"></a>统计信息</h2><p>FS-Cache也跟踪一般的统计信息。要查看此信息，请使用：</p>
<p><code>cat /proc/fs/fscache/stats</code></p>
<p>FS-Cache统计信息包括有关决策点和对象计数器的信息。有关FS-Cache提供的统计信息的更多细节，请参阅以下内核文档：</p>
<p><code>/usr/share/doc/kernel-doc-*version*/Documentation/filesystems/caching/fscache.txt</code></p>
<h2 id="FS-高速缓存引用"><a href="#FS-高速缓存引用" class="headerlink" title="FS-高速缓存引用"></a>FS-高速缓存引用</h2><p>有关<code>cachefilesd</code>如何配置的更多信息，请参阅<code>man cachefilesd</code>和<code>man cachefilesd.conf</code>。以下内核文档还提供了附加信息：</p>
<ul>
<li><code>/usr/share/doc/cachefilesd-*version-number*/README</code></li>
<li><code>/usr/share/man/man5/cachefilesd.conf.5.gz</code></li>
<li><code>/usr/share/man/man8/cachefilesd.8.gz</code></li>
</ul>
<p>有关FS-Cache的一般信息，包括其设计约束，可用统计信息和功能的详细信息，请参阅以下内核文档：</p>
<p><code>/usr/share/doc/kernel-doc-*version*/Documentation/filesystems/caching/fscache.txt</code></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Goooo
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://www.sysctl.me/2017/12/10/Linux/storage/filesystem/" title="Linux文件系统管理">https://www.sysctl.me/2017/12/10/Linux/storage/filesystem/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Linux/" rel="tag"># Linux</a>
              <a href="/tags/Filesystem/" rel="tag"># Filesystem</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/11/11/ubuntu/" rel="prev" title="Ubuntu 安装">
      <i class="fa fa-chevron-left"></i> Ubuntu 安装
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/12/30/Linux/storage/LocalStorage/" rel="next" title="Linux存储管理">
      Linux存储管理 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#文件系统的结构和维护"><span class="nav-number">1.</span> <span class="nav-text">文件系统的结构和维护</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#文件系统层次结构标准（FHS）概述"><span class="nav-number">1.1.</span> <span class="nav-text">文件系统层次结构标准（FHS）概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#FHS-组织"><span class="nav-number">1.1.1.</span> <span class="nav-text">FHS 组织</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#boot-目录"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">&#x2F;boot&#x2F; 目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dev-目录"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">&#x2F;dev&#x2F; 目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#etc-目录"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">&#x2F;etc&#x2F; 目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mnt-目录"><span class="nav-number">1.1.1.4.</span> <span class="nav-text">&#x2F;mnt&#x2F; 目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#opt-目录"><span class="nav-number">1.1.1.5.</span> <span class="nav-text">&#x2F;opt&#x2F; 目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#proc-目录"><span class="nav-number">1.1.1.6.</span> <span class="nav-text">&#x2F;proc&#x2F; 目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#srv-目录"><span class="nav-number">1.1.1.7.</span> <span class="nav-text">&#x2F;srv&#x2F; 目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sys-目录"><span class="nav-number">1.1.1.8.</span> <span class="nav-text">&#x2F;sys&#x2F; 目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#usr-目录"><span class="nav-number">1.1.1.9.</span> <span class="nav-text">&#x2F;usr&#x2F; 目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#var-目录"><span class="nav-number">1.1.1.10.</span> <span class="nav-text">&#x2F;var&#x2F; 目录</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#特殊的红帽企业Linux文件位置"><span class="nav-number">1.2.</span> <span class="nav-text">特殊的红帽企业Linux文件位置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#proc-虚拟文件系统"><span class="nav-number">1.2.1.</span> <span class="nav-text">&#x2F;proc 虚拟文件系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Discard-Unused-Blocks"><span class="nav-number">1.2.2.</span> <span class="nav-text">Discard Unused Blocks</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#XFS-文件系统"><span class="nav-number">2.</span> <span class="nav-text">XFS 文件系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建一个XFS文件系统"><span class="nav-number">2.1.</span> <span class="nav-text">创建一个XFS文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#挂载-XFS-文件系统"><span class="nav-number">2.2.</span> <span class="nav-text">挂载  XFS 文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Write-Barriers"><span class="nav-number">2.3.</span> <span class="nav-text">Write Barriers</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Direct-Access-技术预览"><span class="nav-number">2.3.1.</span> <span class="nav-text">Direct Access 技术预览</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XFS配额管理"><span class="nav-number">2.4.</span> <span class="nav-text">XFS配额管理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置项目限制"><span class="nav-number">2.5.</span> <span class="nav-text">设置项目限制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#增加XFS文件系统的大小"><span class="nav-number">2.6.</span> <span class="nav-text">增加XFS文件系统的大小</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修复XFS文件系统"><span class="nav-number">2.7.</span> <span class="nav-text">修复XFS文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#暂停XFS文件系统"><span class="nav-number">2.8.</span> <span class="nav-text">暂停XFS文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XFS文件系统的备份和恢复"><span class="nav-number">2.9.</span> <span class="nav-text">XFS文件系统的备份和恢复</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简单模式-xfsrestore"><span class="nav-number">2.10.</span> <span class="nav-text">简单模式 xfsrestore</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#累计模式-xfsrestore"><span class="nav-number">2.11.</span> <span class="nav-text">累计模式 xfsrestore</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#交互式操作"><span class="nav-number">2.12.</span> <span class="nav-text">交互式操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#从磁带恢复备份时的信息性消息"><span class="nav-number">2.13.</span> <span class="nav-text">从磁带恢复备份时的信息性消息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置错误行为"><span class="nav-number">2.14.</span> <span class="nav-text">配置错误行为</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#特定和未定义条件的配置文件"><span class="nav-number">2.14.1.</span> <span class="nav-text">特定和未定义条件的配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置特定和未定义条件的文件系统行为"><span class="nav-number">2.14.2.</span> <span class="nav-text">设置特定和未定义条件的文件系统行为</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置卸载行为"><span class="nav-number">2.14.3.</span> <span class="nav-text">设置卸载行为</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他XFS文件系统实用程序"><span class="nav-number">2.15.</span> <span class="nav-text">其他XFS文件系统实用程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#从-XFS迁移到EXT4"><span class="nav-number">2.15.1.</span> <span class="nav-text">从 XFS迁移到EXT4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ext3-4-与XFS的区别"><span class="nav-number">2.15.2.</span> <span class="nav-text">Ext3&#x2F;4 与XFS的区别</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#EXT3文件系统"><span class="nav-number">3.</span> <span class="nav-text">EXT3文件系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建-Ext3-文件系统"><span class="nav-number">3.1.</span> <span class="nav-text">创建 Ext3 文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#转换为EXT3文件系统"><span class="nav-number">3.2.</span> <span class="nav-text">转换为EXT3文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#恢复到EXT2文件系统"><span class="nav-number">3.3.</span> <span class="nav-text">恢复到EXT2文件系统</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#EXT4文件系统"><span class="nav-number">4.</span> <span class="nav-text">EXT4文件系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建一个Ext4文件系统"><span class="nav-number">4.1.</span> <span class="nav-text">创建一个Ext4文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#挂载EXT4文件系统"><span class="nav-number">4.2.</span> <span class="nav-text">挂载EXT4文件系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#写屏障"><span class="nav-number">4.2.1.</span> <span class="nav-text">写屏障</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#直接访问"><span class="nav-number">4.3.</span> <span class="nav-text">直接访问</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#调整EXT4文件系统的大小"><span class="nav-number">4.4.</span> <span class="nav-text">调整EXT4文件系统的大小</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#备份-ext2-3-4-文件系统"><span class="nav-number">4.5.</span> <span class="nav-text">备份 ext2&#x2F;3&#x2F;4 文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#恢复ext2-3-4-文件系统"><span class="nav-number">4.6.</span> <span class="nav-text">恢复ext2&#x2F;3&#x2F;4 文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他EXT4文件系统工具"><span class="nav-number">4.7.</span> <span class="nav-text">其他EXT4文件系统工具</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BTRFS（技术预览）"><span class="nav-number">5.</span> <span class="nav-text">BTRFS（技术预览）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建一个btrfs文件系统"><span class="nav-number">5.1.</span> <span class="nav-text">创建一个btrfs文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#挂载一个BTRFS文件系统"><span class="nav-number">5.2.</span> <span class="nav-text">挂载一个BTRFS文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#调整BTRFS文件系统的大小"><span class="nav-number">5.3.</span> <span class="nav-text">调整BTRFS文件系统的大小</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#扩大btrfs文件系统"><span class="nav-number">5.4.</span> <span class="nav-text">扩大btrfs文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缩小btrfs文件系统"><span class="nav-number">5.5.</span> <span class="nav-text">缩小btrfs文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置文件系统大小"><span class="nav-number">5.6.</span> <span class="nav-text">设置文件系统大小</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多个设备的集成卷管理"><span class="nav-number">5.7.</span> <span class="nav-text">多个设备的集成卷管理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用多个设备创建文件系统"><span class="nav-number">5.8.</span> <span class="nav-text">使用多个设备创建文件系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#扫描btrfs设备"><span class="nav-number">5.8.1.</span> <span class="nav-text">扫描btrfs设备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将新设备添加到btrfs文件系统"><span class="nav-number">5.8.2.</span> <span class="nav-text">将新设备添加到btrfs文件系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#转换一个btrfs文件系统"><span class="nav-number">5.8.3.</span> <span class="nav-text">转换一个btrfs文件系统</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#删除btrfs设备"><span class="nav-number">5.8.3.1.</span> <span class="nav-text">删除btrfs设备</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#替换btrfs文件系统上的失败设备"><span class="nav-number">5.8.3.2.</span> <span class="nav-text">替换btrfs文件系统上的失败设备</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在-etc-fstab文件中注册一个btrfs文件系统"><span class="nav-number">5.8.4.</span> <span class="nav-text">在 &#x2F;etc&#x2F;fstab文件中注册一个btrfs文件系统</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSD优化"><span class="nav-number">5.9.</span> <span class="nav-text">SSD优化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BTRFS参考"><span class="nav-number">5.10.</span> <span class="nav-text">BTRFS参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#GFS2"><span class="nav-number">6.</span> <span class="nav-text">GFS2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#网络文件系统（NFS）"><span class="nav-number">7.</span> <span class="nav-text">网络文件系统（NFS）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#NFS简介"><span class="nav-number">7.1.</span> <span class="nav-text">NFS简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#必需的服务"><span class="nav-number">7.1.1.</span> <span class="nav-text">必需的服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pNFS"><span class="nav-number">7.2.</span> <span class="nav-text">pNFS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置NFS客户端"><span class="nav-number">7.3.</span> <span class="nav-text">配置NFS客户端</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用安装NFS文件系统-etc-fstab"><span class="nav-number">7.3.0.1.</span> <span class="nav-text">使用安装NFS文件系统&#x2F;etc&#x2F;fstab</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#autofs"><span class="nav-number">7.4.</span> <span class="nav-text">autofs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#autofs版本5比版本4改进"><span class="nav-number">7.4.0.1.</span> <span class="nav-text">autofs版本5比版本4改进</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置autofs"><span class="nav-number">7.4.1.</span> <span class="nav-text">配置autofs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#覆盖或增加站点配置文件"><span class="nav-number">7.4.2.</span> <span class="nav-text">覆盖或增加站点配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用LDAP存储自动更新映射表"><span class="nav-number">7.4.3.</span> <span class="nav-text">使用LDAP存储自动更新映射表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常见的NFS挂载选项"><span class="nav-number">7.5.</span> <span class="nav-text">常见的NFS挂载选项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启动和停止NFS服务器"><span class="nav-number">7.6.</span> <span class="nav-text">启动和停止NFS服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置NFS服务器"><span class="nav-number">7.7.</span> <span class="nav-text">配置NFS服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#etc-exports配置文件"><span class="nav-number">7.7.1.</span> <span class="nav-text">&#x2F;etc&#x2F;exports配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exportfs命令"><span class="nav-number">7.7.2.</span> <span class="nav-text">exportfs命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exportfs与NFSv4一起使用"><span class="nav-number">7.7.3.</span> <span class="nav-text">exportfs与NFSv4一起使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在防火墙后面运行NFS"><span class="nav-number">7.7.4.</span> <span class="nav-text">在防火墙后面运行NFS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#发现NFS导出"><span class="nav-number">7.7.5.</span> <span class="nav-text">发现NFS导出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通过防火墙访问RPC配额"><span class="nav-number">7.7.6.</span> <span class="nav-text">通过防火墙访问RPC配额</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#从远程主机设置配额"><span class="nav-number">7.7.7.</span> <span class="nav-text">从远程主机设置配额</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#主机名格式"><span class="nav-number">7.7.8.</span> <span class="nav-text">主机名格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通过RDMA启用NFS（NFSoRDMA）"><span class="nav-number">7.7.9.</span> <span class="nav-text">通过RDMA启用NFS（NFSoRDMA）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#保护NFS"><span class="nav-number">7.8.</span> <span class="nav-text">保护NFS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用AUTH-SYS和导出控件的NFS安全性"><span class="nav-number">7.8.1.</span> <span class="nav-text">使用AUTH_SYS和导出控件的NFS安全性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NFS安全与AUTH-GSS"><span class="nav-number">7.8.2.</span> <span class="nav-text">NFS安全与AUTH_GSS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置Kerberos"><span class="nav-number">7.8.3.</span> <span class="nav-text">配置Kerberos</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用NFSv4的NFS安全性"><span class="nav-number">7.8.4.</span> <span class="nav-text">使用NFSv4的NFS安全性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#文件权限"><span class="nav-number">7.8.5.</span> <span class="nav-text">文件权限</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NFS-AND-RPCBIND"><span class="nav-number">7.9.</span> <span class="nav-text">NFS AND RPCBIND</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#NFS和rpcbind故障排除"><span class="nav-number">7.9.1.</span> <span class="nav-text">NFS和rpcbind故障排除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NFS参考"><span class="nav-number">7.10.</span> <span class="nav-text">NFS参考</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#已安装的文档"><span class="nav-number">7.11.</span> <span class="nav-text">已安装的文档</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#FS缓存"><span class="nav-number">8.</span> <span class="nav-text">FS缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#履约担保"><span class="nav-number">8.1.</span> <span class="nav-text">履约担保</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置一个缓存"><span class="nav-number">8.2.</span> <span class="nav-text">设置一个缓存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通过NFS使用高速缓存"><span class="nav-number">8.3.</span> <span class="nav-text">通过NFS使用高速缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#缓存共享"><span class="nav-number">8.3.1.</span> <span class="nav-text">缓存共享</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用NFS缓存限制"><span class="nav-number">8.3.2.</span> <span class="nav-text">使用NFS缓存限制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置高速缓存限制"><span class="nav-number">8.4.</span> <span class="nav-text">设置高速缓存限制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#统计信息"><span class="nav-number">8.5.</span> <span class="nav-text">统计信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FS-高速缓存引用"><span class="nav-number">8.6.</span> <span class="nav-text">FS-高速缓存引用</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Goooo"
      src="/images/img.png">
  <p class="site-author-name" itemprop="name">Goooo</p>
  <div class="site-description" itemprop="description">真正的粉丝</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">111</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xth0331" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xth0331" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:xietianhao0331@gmail.com" title="E-Mail → mailto:xietianhao0331@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
        
        <script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
        <script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
        <div class="widget-wrap">
            <h3 class="widget-title">标签们</h3>
            <div id="myCanvasContainer" class="widget tagcloud">
                <canvas width="250" height="250" id="resCanvas" style="width=100%">
                    <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ansible/" rel="tag">Ansible</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Backup/" rel="tag">Backup</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bond/" rel="tag">Bond</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CPU/" rel="tag">CPU</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ceph/" rel="tag">Ceph</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cobbler/" rel="tag">Cobbler</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Coffee/" rel="tag">Coffee</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Corosync/" rel="tag">Corosync</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cyclic-invariant/" rel="tag">Cyclic invariant</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Effectiveness/" rel="tag">Effectiveness</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Exhaustion/" rel="tag">Exhaustion</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Filesystem/" rel="tag">Filesystem</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HAProxy/" rel="tag">HAProxy</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hardware/" rel="tag">Hardware</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Https/" rel="tag">Https</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ICMP/" rel="tag">ICMP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDK/" rel="tag">JDK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JunOS/" rel="tag">JunOS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KEEPALIVED/" rel="tag">KEEPALIVED</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Keepalived/" rel="tag">Keepalived</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Log/" rel="tag">Log</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/" rel="tag">Markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Modular-Programming/" rel="tag">Modular Programming</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Monitoring/" rel="tag">Monitoring</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Netconf/" rel="tag">Netconf</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Network/" rel="tag">Network</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Networking/" rel="tag">Networking</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OS/" rel="tag">OS</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenStack/" rel="tag">OpenStack</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Package-Manager/" rel="tag">Package Manager</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Partition/" rel="tag">Partition</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Programming/" rel="tag">Programming</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RAM/" rel="tag">RAM</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RHCS/" rel="tag">RHCS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RPM/" rel="tag">RPM</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Recursion/" rel="tag">Recursion</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Recursive/" rel="tag">Recursive</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redirect/" rel="tag">Redirect</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Route/" rel="tag">Route</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSH/" rel="tag">SSH</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Storage/" rel="tag">Storage</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Storage-and-Filesystem/" rel="tag">Storage and Filesystem</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swap/" rel="tag">Swap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sys/" rel="tag">Sys</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Systemd/" rel="tag">Systemd</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Terminal/" rel="tag">Terminal</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Terraform/" rel="tag">Terraform</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tools/" rel="tag">Tools</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Veeam/" rel="tag">Veeam</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vim/" rel="tag">Vim</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Virtualization/" rel="tag">Virtualization</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vmware/" rel="tag">Vmware</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vsphere/" rel="tag">Vsphere</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/" rel="tag">Windows</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Yum/" rel="tag">Yum</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apple/" rel="tag">apple</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/complaints/" rel="tag">complaints</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch/" rel="tag">elasticsearch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iteration/" rel="tag">iteration</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logs/" rel="tag">logs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oop/" rel="tag">oop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/talking/" rel="tag">talking</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/" rel="tag">tools</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E6%B2%BB/" rel="tag">分治</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9/" rel="tag">数据压缩</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%84%99%E8%A7%86%E9%93%BE/" rel="tag">鄙视链</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE%E5%88%A0%E9%99%A4/" rel="tag">重复数据删除</a><span class="tag-list-count">1</span></li></ul>
                </canvas>
            </div>
        </div>
        
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Goooo</span>
</div>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.7.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://www-sysctl-me-1.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://www.sysctl.me/2017/12/10/Linux/storage/filesystem/";
    this.page.identifier = "2017/12/10/Linux/storage/filesystem/";
    this.page.title = "Linux文件系统管理";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://www-sysctl-me-1.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":300,"height":600},"mobile":{"show":false},"react":{"opacity":0.7}});</script></body>
</html>
